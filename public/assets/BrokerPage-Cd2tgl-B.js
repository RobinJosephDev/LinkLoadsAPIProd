import{r as d,j as e,S as k,b as N}from"./index-CZ9Kvx3V.js";import{b as G,R as H,a as J,T as K,M as R}from"./Modal-CC9O_okn.js";import{z as b,P as W}from"./Pagination-O6ZxpL-l.js";/* empty css             */import{u as Y}from"./useGoogleAutocomplete-BVymW36F.js";import X from"./purify.es-Ci5xwkH_.js";import{o as ee,R as re}from"./EyeOutlined-D8Ivf9Pr.js";import{R as te}from"./MailOutlined-BQUUGXtp.js";const ae=b.object({broker_name:b.string().min(1,"Name is required").max(200,"Name cannot exceed 200 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed"),broker_address:b.string().max(255,"Street cannot be more than 255 characters").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),broker_city:b.string().max(200,"City cannot be more than 200 characters").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),broker_state:b.string().max(200,"State cannot be more than 200 characters").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),broker_country:b.string().max(100,"Country cannot be more than 100 characters").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),broker_postal:b.string().max(20,"Postal Code cannot be more than 20 characters").regex(/^[0-9a-zA-Z\s-]*$/,"Invalid postal code format").optional(),broker_email:b.string().max(255,"Email cannot be more than 255 characters").email("Invalid email format").optional(),broker_phone:b.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),broker_ext:b.string().regex(/^\+?[0-9]{0,10}$/,"Invalid extension").optional(),broker_fax:b.string().max(20,"Fax exceed 20 characters").regex(/^[0-9-+()\s]*$/,"Invalid fax format").optional()}),se=({broker:r,setBroker:c})=>{const[l,i]=d.useState({}),f=Y(o=>{const t=n=>{var p,m;return((m=(p=o.address_components)==null?void 0:p.find(u=>u.types.includes(n)))==null?void 0:m.long_name)||""};c(n=>({...n,broker_address:`${t("street_number")} ${t("route")}`.trim(),broker_city:t("locality"),broker_state:t("administrative_area_level_1"),broker_country:t("country"),broker_postal:t("postal_code")}))}),x=(o,t)=>{let n="";const p={...r,[o]:t},m=ae.safeParse(p);if(!m.success){const u=m.error.errors.find(g=>g.path[0]===o);n=u?u.message:""}i(u=>({...u,[o]:n})),c(p)},y=[{label:"Name",key:"broker_name",placeholder:"Enter broker name"},{label:"Street",key:"broker_address",placeholder:"123 Main St"},{label:"City",key:"broker_city",placeholder:"Enter city"},{label:"State",key:"broker_state",placeholder:"Enter state"},{label:"Country",key:"broker_country",placeholder:"Enter country"},{label:"Postal Code",key:"broker_postal",placeholder:"12345"},{label:"Email",key:"broker_email",type:"email",placeholder:"example@email.com"},{label:"Phone",key:"broker_phone",placeholder:"(123) 456-7890"},{label:"Ext",key:"broker_ext",placeholder:"Enter extension"},{label:"Fax",key:"broker_fax",placeholder:"(123) 456-7890"}];return e.jsx("fieldset",{children:e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:y.map(({label:o,key:t,type:n,placeholder:p})=>e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:t,children:[o," ",t==="broker_name"&&e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:t,type:n||"text",value:r[t]||"",onChange:m=>x(t,m.target.value),ref:t==="broker_address"?f:void 0,placeholder:p}),l[t]&&e.jsx("span",{className:"error",style:{color:"red"},children:l[t]})]},t))})})},q="https://linkloadsapiprod.onrender.com/api",oe=(r,c)=>{const[l,i]=d.useState({id:0,broker_name:"",broker_address:"",broker_city:"",broker_state:"",broker_country:"",broker_postal:"",broker_email:"",broker_phone:"",broker_ext:"",broker_fax:"",created_at:"",updated_at:""}),_=()=>!!l.broker_name,f=async y=>{if(y.preventDefault(),!_()){k.fire("Validation Error","Please fill in all required fields.","error");return}try{let o;const t=localStorage.getItem("token");if(!t){k.fire("Error","No token found","error");return}const n={Authorization:`Bearer ${t}`};l.id?(o=await N.put(`${q}/broker/${l.id}`,l,{headers:n}),k.fire("Success!","Broker details updated.","success")):(o=await N.post(`${q}/broker`,l,{headers:n}),k.fire("Success!","Broker added successfully.","success")),x(),c()}catch(o){console.error("Error saving/updating broker:",o.response?o.response.data:o.message),k.fire("Error","An error occurred while saving/updating the broker.","error")}},x=()=>{i({id:0,broker_name:"",broker_address:"",broker_city:"",broker_state:"",broker_country:"",broker_postal:"",broker_email:"",broker_phone:"",broker_ext:"",broker_fax:"",created_at:"",updated_at:""})};return{broker:l,setBroker:i,handleSubmit:f}},ne=({onClose:r,onSuccess:c})=>{const{broker:l,setBroker:i,handleSubmit:_}=oe(r,c);return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:_,className:"form-main",children:[e.jsx(se,{broker:l,setBroker:i}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Add Broker"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:r,children:"Cancel"})]})]})})},le=({broker:r,onUpdate:c,onClose:l})=>{const[i,_]=d.useState({id:0,broker_name:"",broker_address:"",broker_city:"",broker_state:"",broker_country:"",broker_postal:"",broker_email:"",broker_phone:"",broker_ext:"",broker_fax:"",created_at:"",updated_at:""}),f="https://linkloadsapiprod.onrender.com/api";d.useEffect(()=>{r&&_({id:r.id||0,broker_name:r.broker_name||"",broker_address:r.broker_address||"",broker_city:r.broker_city||"",broker_state:r.broker_state||"",broker_country:r.broker_country||"",broker_postal:r.broker_postal||"",broker_email:r.broker_email||"",broker_phone:r.broker_phone||"",broker_ext:r.broker_ext||"",broker_fax:r.broker_fax||"",created_at:r.created_at||"",updated_at:r.updated_at||""})},[r]);const x=()=>!!i.broker_name;return{formBroker:i,setFormBroker:_,updateBroker:async()=>{var o;if(!x()){k.fire("Validation Error","Please fill in all required fields.","error");return}try{const t=localStorage.getItem("token");if(!t){k.fire({icon:"error",title:"Unauthorized",text:"You are not logged in. Please log in again."});return}const n=await N.put(`${f}/broker/${i.id}`,i,{headers:{Authorization:`Bearer ${t}`}});k.fire({icon:"success",title:"Success!",text:"Broker details updated."}),c(n.data),l()}catch(t){console.error("Error updating broker:",t),k.fire({icon:"error",title:"Oops...",text:((o=t.response)==null?void 0:o.status)===401?"Unauthorized. Please log in again.":"Failed to update broker."})}}}},ie=b.object({broker_name:b.string().min(1,"Name is required").max(200).regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed"),broker_address:b.string().max(255,"Street cannot be more than 255 characters").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),broker_city:b.string().max(200,"City cannot be more than 200 characters").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),broker_state:b.string().max(200,"State cannot be more than 200 characters").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),broker_country:b.string().max(100,"Country cannot be more than 100 characters").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),broker_postal:b.string().max(20,"Postal Code cannot be more than 20 characters").regex(/^[0-9a-zA-Z\s-]*$/,"Invalid postal code format").optional(),broker_email:b.string().max(255,"Email cannot be more than 255 characters").email("Invalid email format").optional(),broker_phone:b.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),broker_ext:b.string().regex(/^\+?[0-9]{0,10}$/,"Invalid extension").optional(),broker_fax:b.string().max(20,"Fax exceed 20 characters").regex(/^[0-9-+()\s]*$/,"Invalid fax format").optional()}),ce=({formBroker:r,setFormBroker:c})=>{const[l,i]=d.useState({}),f=Y(o=>{const t=n=>{var p,m;return((m=(p=o.address_components)==null?void 0:p.find(u=>u.types.includes(n)))==null?void 0:m.long_name)||""};c(n=>({...n,broker_address:`${t("street_number")} ${t("route")}`.trim(),broker_city:t("locality"),broker_state:t("administrative_area_level_1"),broker_country:t("country"),broker_postal:t("postal_code")}))}),x=(o,t)=>{var m;const n=X.sanitize(t.trim());c(u=>({...u,[o]:n}));const p=ie.safeParse({...r,[o]:n});if(p.success)i(u=>({...u,[o]:""}));else{const u=((m=p.error.errors.find(g=>g.path[0]===o))==null?void 0:m.message)||"";i(g=>({...g,[o]:u}))}},y=[{label:"Name",key:"broker_name"},{label:"Street",key:"broker_address"},{label:"City",key:"broker_city"},{label:"State",key:"broker_state"},{label:"Country",key:"broker_country"},{label:"Postal Code",key:"broker_postal"},{label:"Email",key:"broker_email",type:"email"},{label:"Phone",key:"broker_phone"},{label:"Ext",key:"broker_ext"},{label:"Fax",key:"broker_fax"}];return e.jsx("fieldset",{children:e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:y.map(({label:o,key:t,type:n})=>e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:t,children:[o," ",t==="broker_name"&&e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:t,type:n||"text",value:r[t]||"",onChange:p=>x(t,p.target.value),ref:t==="broker_address"?f:void 0}),l[t]&&e.jsx("span",{className:"error",style:{color:"red"},children:l[t]})]},t))})})},de=({broker:r,onClose:c,onUpdate:l})=>{const{formBroker:i,setFormBroker:_,updateBroker:f}=le({broker:r,onUpdate:l,onClose:c});return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:x=>{x.preventDefault(),f()},className:"form-main",children:[e.jsx(ce,{formBroker:i,setFormBroker:_}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Save Changes"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:c,children:"Cancel"})]})]})})},be=({formBroker:r})=>e.jsxs("fieldset",{children:[e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Name"}),e.jsx("span",{children:(r==null?void 0:r.broker_name)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Street"}),e.jsx("span",{children:(r==null?void 0:r.broker_address)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"City"}),e.jsx("span",{children:(r==null?void 0:r.broker_city)||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"State"}),e.jsx("span",{children:(r==null?void 0:r.broker_state)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Country"}),e.jsx("span",{children:(r==null?void 0:r.broker_country)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Postal Code"}),e.jsx("span",{children:(r==null?void 0:r.broker_postal)||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Email"}),e.jsx("span",{children:(r==null?void 0:r.broker_email)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Phone"}),e.jsx("span",{children:(r==null?void 0:r.broker_phone)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Phone Extension"}),e.jsx("span",{children:(r==null?void 0:r.broker_ext)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Fax"}),e.jsx("span",{children:(r==null?void 0:r.broker_fax)||"N/A"})]})]})]}),Q={id:0,broker_name:"",broker_address:"",broker_city:"",broker_state:"",broker_country:"",broker_postal:"",broker_email:"",broker_phone:"",broker_ext:"",broker_fax:"",created_at:"",updated_at:""},pe=({broker:r,onClose:c})=>{const[l,i]=d.useState(Q);return d.useEffect(()=>{i(r??Q)},[r]),e.jsx("div",{className:"form-container",children:e.jsxs("form",{className:"form-main",children:[e.jsx(be,{formBroker:l}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"button",className:"btn-cancel",onClick:c,style:{padding:"9px 15px"},children:"Cancel"})})]})})},L="https://linkloadsapiprod.onrender.com/api",he=()=>{const[r,c]=d.useState([]),[l,i]=d.useState(!0),[_,f]=d.useState(""),[x,y]=d.useState("created_at"),[o,t]=d.useState(!0),[n,p]=d.useState(1),[m,u]=d.useState(null),[g,v]=d.useState([]),[V,w]=d.useState(!1),[Z,T]=d.useState(!1),[I,S]=d.useState(!1),[F,C]=d.useState(!1),[E,M]=d.useState(null),[A,$]=d.useState(10),O=async()=>{try{const a=localStorage.getItem("token");if(!a)throw new Error("No token found");i(!0);const{data:h}=await N.get(`${L}/broker`,{headers:{Authorization:`Bearer ${a}`}});c(h)}catch(a){console.error("Error loading brokers:",a),B(a)}finally{i(!1)}};d.useEffect(()=>{O()},[]);const B=a=>{var h;((h=a.response)==null?void 0:h.status)===401&&k.fire({icon:"error",title:"Unauthorized",text:"You need to log in to access this resource."})},z=r.filter(a=>Object.values(a).some(h=>h&&h.toString().toLowerCase().includes(_.toLowerCase()))),P=z.sort((a,h)=>{let j=a[x]||"",D=h[x]||"";return o?D.toString().localeCompare(j.toString()):j.toString().localeCompare(D.toString())}).slice((n-1)*A,n*A),s=Math.ceil(z.length/A);return{fetchBrokers:O,brokers:r,setSelectedBrokers:v,loading:l,searchQuery:_,setSearchQuery:f,sortBy:x,sortDesc:o,paginatedData:P,totalPages:s,currentPage:n,handlePageChange:a=>{p(a)},handleSort:a=>{x===a?t(!o):(y(a),t(!1))},selectedBrokers:g,toggleSelectAll:()=>{g.length===P.length?v([]):v(P.map(a=>a.id).filter(a=>a!==void 0))},toggleSelect:a=>{v(h=>h.includes(a)?h.filter(j=>j!==a):[...h,a])},deleteSelected:async()=>{if(!g.length){k.fire({icon:"warning",title:"No record selected",text:"Please select a record to delete."});return}if((await k.fire({title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete selected!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const h=localStorage.getItem("token");if(!h)throw new Error("No token found");await Promise.all(g.map(j=>N.delete(`${L}/broker/${j}`,{headers:{Authorization:`Bearer ${h}`}}))),c(j=>j.filter(D=>!g.includes(D.id))),v([]),k.fire("Deleted!","The selected brokers have been removed.","success")}catch(h){console.error("Error deleting selected brokers:",h),k.fire({icon:"error",title:"Error!",text:"Failed to delete selected brokers."})}},isEditModalOpen:V,isAddModalOpen:Z,isViewModalOpen:I,isEmailModalOpen:F,setEditModalOpen:w,setAddModalOpen:T,setViewModalOpen:S,setEmailModalOpen:C,emailData:E,setEmailData:M,sendEmails:async()=>{if(g.length===0){k.fire({icon:"warning",title:"No brokers selected",text:"Please select a broker to send an email to."});return}try{const a=localStorage.getItem("token");if(!a)throw new Error("No token found");await N.post(`${L}/email`,{ids:g,...E,module:"brokers"},{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}),k.fire("Success!","Email sent.","success"),C(!1),v([])}catch(a){console.error("Error sending email:",a),k.fire("Error!","Failed to send email.","error")}},selectedBroker:m,openEditModal:a=>{u(a),w(!0)},openViewModal:a=>{u(a),S(!0)},updateBroker:a=>{c(h=>h.map(j=>j.id===a.id?{...j,...a}:j))}}},me=()=>{const{fetchBrokers:r,brokers:c,loading:l,searchQuery:i,setSearchQuery:_,sortBy:f,sortDesc:x,paginatedData:y,totalPages:o,currentPage:t,handlePageChange:n,handleSort:p,selectedBrokers:m,toggleSelectAll:u,toggleSelect:g,deleteSelected:v,isEditModalOpen:V,isAddModalOpen:w,isViewModalOpen:Z,isEmailModalOpen:T,setEditModalOpen:I,setAddModalOpen:S,setViewModalOpen:F,setEmailModalOpen:C,emailData:E,setEmailData:M,sendEmails:A,selectedBroker:$,openEditModal:O,openViewModal:B,updateBroker:z}=he(),U=s=>s.key==="checkbox"||s.key==="actions"?s.label:e.jsxs("div",{className:"sortable-header",onClick:()=>p(s.key),children:[s.label,e.jsx("span",{className:"sort-icon",children:f===s.key?x?"▼":"▲":"▼"})]}),P=[{key:"checkbox",label:e.jsx("input",{type:"checkbox",onChange:u,checked:m.length===y.length&&y.length>0}),render:s=>e.jsx("input",{type:"checkbox",checked:m.includes(s.id),onChange:()=>g(s.id)})},{key:"broker_name",label:"Name",render:s=>s.broker_name||e.jsx("span",{children:"-"})},{key:"broker_city",label:"City",render:s=>s.broker_city||e.jsx("span",{children:"-"})},{key:"broker_state",label:"State",render:s=>s.broker_state||e.jsx("span",{children:"-"})},{key:"broker_email",label:"Email",render:s=>s.broker_email||e.jsx("span",{children:"-"})},{key:"broker_phone",label:"Phone",render:s=>s.broker_phone||e.jsx("span",{children:"-"})},{key:"broker_fax",label:"Fax",render:s=>s.broker_fax||e.jsx("span",{children:"-"})},{key:"actions",label:"",render:s=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>B(s),className:"btn-view",children:e.jsx(ee,{})}),e.jsx("button",{onClick:()=>O(s),className:"btn-edit",children:e.jsx(G,{})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{className:"header-container",children:[e.jsx("div",{className:"header-container-left",children:e.jsx("h1",{className:"page-heading",children:"Brokers"})}),e.jsxs("div",{className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(re,{className:"search-icon"}),e.jsx("input",{className:"search-bar",value:i,onChange:s=>_(s.target.value)})]}),e.jsx("button",{onClick:()=>S(!0),className:"add-button",children:e.jsx(H,{})}),e.jsx("button",{onClick:()=>C(!0),className:"send-email-button",disabled:m.length===0,children:e.jsx(te,{})}),e.jsx("button",{onClick:v,className:"delete-button",children:e.jsx(J,{})})]})]}),l?e.jsx("div",{children:"Loading..."}):c.length===0?e.jsx("div",{className:"no-record",children:"No records found"}):e.jsx(K,{data:y,headers:P.map(s=>({...s,label:U(s)})),handleSort:p,sortBy:f,sortDesc:x}),e.jsx(W,{currentPage:t,totalPages:o,onPageChange:n}),e.jsx(R,{isOpen:V,title:"Edit Broker",onClose:()=>I(!1),children:$&&e.jsx(de,{broker:$,onUpdate:z,onClose:()=>I(!1)})}),e.jsxs(R,{isOpen:w,onClose:()=>S(!1),title:"Add Broker",children:[e.jsx(ne,{onClose:()=>S(!1),onSuccess:r})," "]}),e.jsx(R,{isOpen:T,onClose:()=>C(!1),title:"Send Email",children:e.jsxs("div",{className:"email-modal",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"subject",children:"Subject:"}),e.jsx("input",{type:"text",placeholder:"Subject",onChange:s=>M({...E,subject:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",children:"Content:"}),e.jsx("textarea",{placeholder:"Content",onChange:s=>M({...E,content:s.target.value})})]}),e.jsx("button",{type:"submit",onClick:A,children:"Send"})]})}),e.jsx(R,{isOpen:Z,onClose:()=>F(!1),title:"Broker Details",children:$&&e.jsx(pe,{broker:$,onClose:()=>F(!1)})})]})},Ie=()=>e.jsx("div",{children:e.jsx(me,{})});export{Ie as default};

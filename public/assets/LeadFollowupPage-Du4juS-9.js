import{r as y,j as e,S as A,b as E}from"./index-CShLHsUt.js";import{z as g,R as I,a as z,b as G,T as K,P as W,M as R}from"./Pagination-2Q04ZmxJ.js";/* empty css             */import $ from"./purify.es-Ci5xwkH_.js";import{u as X}from"./useGoogleAutocomplete-C2ALqIRo.js";import{o as ee,R as se}from"./EyeOutlined-B28M-sP9.js";const te=g.object({address:g.string().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),city:g.string().max(200,"City name is too long").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),state:g.string().max(200,"Invalid state").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),country:g.string().max(100,"Invalid country").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),postal_code:g.string().max(20,"Postal code cannot exceed 20 characters").regex(/^[a-zA-Z0-9-\s ]*$/,"Invalid postal code").optional(),unit_no:g.string().max(20,"Unit no. cannot exceed 20 characters").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid unit no. format").optional()}),ae=({followupEdit:s,setFollowupEdit:i})=>{const[n,m]=y.useState({}),h=X(r=>{const a=c=>{var o,x;return((x=(o=r.address_components)==null?void 0:o.find(t=>t.types.includes(c)))==null?void 0:x.long_name)||""};i(c=>({...c,address:`${a("street_number")} ${a("route")}`.trim(),city:a("locality"),state:a("administrative_area_level_1"),country:a("country"),postal_code:a("postal_code")}))}),l=(r,a)=>{const c=$.sanitize(a);let o="";const x={...s,[r]:c},t=te.safeParse(x);if(!t.success){const d=t.error.errors.find(u=>u.path[0]===r);o=d?d.message:""}m(d=>({...d,[r]:o})),i(x)},j=[{label:"Address",key:"address",placeholder:"Enter street address"},{label:"City",key:"city",placeholder:"Enter city name"},{label:"State",key:"state",placeholder:"Enter state"},{label:"Country",key:"country",placeholder:"Enter country"},{label:"Postal Code",key:"postal_cide",placeholder:"Enter postal code"},{label:"Unit No.",key:"unit_no",placeholder:"Enter unit number"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Address Details"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:j.map(({label:r,key:a,placeholder:c})=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:a,children:r}),e.jsx("input",{type:"text",id:a,placeholder:c,value:s[a]||"",onChange:o=>l(a,o.target.value),ref:a==="address"?h:void 0}),n[a]&&e.jsx("span",{className:"error",style:{color:"red"},children:n[a]})]},a))})]})},re=g.object({next_follow_up_date:g.string().regex(/^\d{2}-\d{2}-\d{4}$/,{message:"Date must be in DD-MM-YYYY format"}).optional(),contact_person:g.string().max(200,"Contact name must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),equipment:g.enum(["Van","Reefer","Flatbed","Triaxle","Maxi","Btrain","Roll tite"],{errorMap:()=>({message:"Invalid equipment type"})}).optional(),notes:g.string().max(500,"Notes must be at most 500 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional()}),le=({followupEdit:s,setFollowupEdit:i})=>{const[n,m]=y.useState({}),p=(l,j)=>{const r=$.sanitize(j);let a="",c=r;if(l==="next_follow_up_date"&&/^\d{4}-\d{2}-\d{2}$/.test(r)){const[t,d,u]=r.split("-");c=`${u}-${d}-${t}`}const o={...s,[l]:c},x=re.safeParse(o);if(!x.success){const t=x.error.errors.find(d=>d.path[0]===l);a=t?t.message:""}m(t=>({...t,[l]:a})),i(t=>({...t,[l]:r}))},h=[{label:"Next Follow-Up Date",key:"next_follow_up_date",type:"date",placeholder:"Enter follow-up date"},{label:"Contact Person",key:"contact_person",type:"text",placeholder:"Enter contact person"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Additional Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[h.map(({label:l,key:j,type:r,placeholder:a})=>e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:j,children:l}),e.jsx("input",{type:r,id:j,placeholder:a,value:s[j]||"",onChange:c=>p(j,c.target.value)}),n[j]&&e.jsx("span",{className:"error",style:{color:"red"},children:n[j]})]},j)),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"equipmentType",children:"Equipment Type"}),e.jsxs("select",{id:"equipmentType",value:s.equipment||"",onChange:l=>i(j=>({...j,equipment:l.target.value})),children:[e.jsx("option",{value:"",children:"Select Equipment Type"}),e.jsx("option",{value:"Van",children:"Van"}),e.jsx("option",{value:"Reefer",children:"Reefer"}),e.jsx("option",{value:"Flatbed",children:"Flatbed"}),e.jsx("option",{value:"Triaxle",children:"Triaxle"}),e.jsx("option",{value:"Maxi",children:"Maxi"}),e.jsx("option",{value:"Btrain",children:"Btrain"}),e.jsx("option",{value:"Roll tite",children:"Roll tite"})]}),n.equipment&&e.jsx("span",{className:"error",style:{color:"red"},children:n.equipment})]})]}),e.jsx("div",{className:"form-row",style:{display:"flex"},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",placeholder:"Enter notes",value:s.notes||"",onChange:l=>p("notes",l.target.value),style:{width:"100%",minHeight:"100px"}}),n.notes&&e.jsx("span",{className:"error",style:{color:"red"},children:n.notes})]})})]})},oe=g.object({name:g.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]*$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),phone:g.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),email:g.string().max(255,"Email must be at most 255 characters").email("Invalid email format").optional()}),ne=({contacts:s,index:i,handleContactChange:n,handleRemoveContact:m,onAddContact:p})=>{const h=s[i]??{},[l,j]=y.useState({}),r=y.useCallback((c,o)=>{const x=$.sanitize(o);let t="";const d={...h,[c]:x},u=oe.safeParse(d);if(!u.success){const b=u.error.errors.find(C=>C.path[0]===c);t=b?b.message:""}j(b=>({...b,[c]:t})),n(i,d)},[h,n,i]),a=[{label:"Name",key:"name",type:"text",placeholder:"Enter name"},{label:"Phone",key:"phone",type:"tel",placeholder:"Enter phone"},{label:"Email",key:"email",type:"email",placeholder:"Enter email"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[a.map(({label:c,key:o,type:x,placeholder:t})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${o}-${i}`,children:c}),e.jsx("input",{id:`${o}-${i}`,type:x,name:o,value:h[o]||"",onChange:d=>r(o,d.target.value),placeholder:t}),l[o]&&e.jsx("span",{className:"error",style:{color:"red"},children:l[o]})]},o)),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:p,className:"add-button",children:e.jsx(I,{})}),e.jsx("button",{type:"button",onClick:()=>m(i),className:"delete-button",children:e.jsx(z,{})})]})]})},ce=g.object({name:g.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]+$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),quantity:g.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional()}),de=({products:s,index:i,handleProductChange:n,handleRemoveProduct:m,onAddProduct:p})=>{const h=s[i]??{},[l,j]=y.useState({}),r=y.useCallback((c,o)=>{const x=$.sanitize(o);let t="";const d={...h,[c]:x},u=ce.safeParse(d);if(!u.success){const b=u.error.errors.find(C=>C.path[0]===c);t=b?b.message:""}j(b=>({...b,[c]:t})),n(i,d)},[h,n,i]),a=[{label:"Name",key:"name",type:"text",placeholder:"Enter name"},{label:"Quantity",key:"phone",type:"text",placeholder:"Enter quantity"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[a.map(({label:c,key:o,type:x,placeholder:t})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${o}-${i}`,children:c}),e.jsx("input",{id:`${o}-${i}`,type:x,name:o,value:h[o]||"",onChange:d=>r(o,d.target.value),placeholder:t}),l[o]&&e.jsx("span",{className:"error",style:{color:"red"},children:l[o]})]},o)),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:p,className:"add-button",children:e.jsx(I,{})}),e.jsx("button",{type:"button",onClick:()=>m(i),className:"delete-button",children:e.jsx(z,{})})]})]})},ie="http://127.0.0.1:8000/api",me=(s,i,n)=>{const[m,p]=y.useState({id:0,lead_no:"",lead_date:"",customer_name:"",phone:"",email:"",address:"",city:"",state:"",country:"",postal_code:"",unit_no:"",lead_type:"",contact_person:"",notes:"",next_follow_up_date:"",followup_type:"",lead_status:"",remarks:"",equipment:"",contacts:[],products:[],created_at:"",updated_at:""});y.useEffect(()=>{if(s){const t=Array.isArray(s.contacts)?s.contacts:JSON.parse(s.contacts||"[]"),d=Array.isArray(s.products)?s.products:JSON.parse(s.products||"[]"),u={...s,contacts:t.length>0?t:[],products:d.length>0?d:[]};p(u)}},[s]);const h=()=>!!m.lead_no&&!!m.lead_date&&!!m.lead_type&&!!m.lead_status;return{followupEdit:m,setFollowupEdit:p,handleAddContact:()=>{p(t=>({...t,contacts:[...t.contacts,{id:"",name:"",phone:"",email:""}]}))},handleAddProduct:()=>{p(t=>({...t,products:[...t.products,{id:"",name:"",quantity:0}]}))},handleContactChange:(t,d)=>{p(u=>({...u,contacts:u.contacts.map(b=>b.id===t?d:b)}))},handleRemoveContact:t=>{p(d=>({...d,contacts:d.contacts.filter(u=>u.id!==t)}))},handleProductChange:(t,d)=>{p(u=>({...u,products:u.products.map(b=>b.id===t?d:b)}))},handleRemoveProduct:t=>{p(d=>({...d,products:d.products.filter(u=>u.id!==t)}))},updateFollowup:async()=>{if(!h()){A.fire("Validation Error","Please fill in all required fields.","error");return}try{const t=localStorage.getItem("token");if(!t){A.fire({icon:"error",title:"Unauthorized",text:"You are not logged in. Please log in again."});return}const d=await E.put(`${ie}/lead-followup/${m.id}`,m,{headers:{Authorization:`Bearer ${t}`}});A.fire({icon:"success",title:"Updated!",text:"Follow-up data has been updated successfully."}),n(d.data),i()}catch(t){console.error("Error updating follow-up:",t),A.fire({icon:"error",title:"Oops...",text:"Failed to update follow-up."})}}}},ue=g.object({lead_no:g.string().min(1,"Lead No is required").max(100,"Lead No must be at most 100 characters long").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed"),lead_date:g.string().min(1,"Lead Date is required").regex(/^\d{2}-\d{2}-\d{4}$/,{message:"Date must be in DD-MM-YYYY format"}).optional(),customer_name:g.string().max(200,"Customer Name must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),phone:g.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),email:g.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),lead_type:g.enum(["AB","BC","BDS","CA","DPD MAGMA","MB","ON","Super Leads","TBAB","USA"],{errorMap:()=>({message:"Invalid lead type"})}),lead_status:g.enum(["New","In Progress","Completed","On Hold","Lost"],{errorMap:()=>({message:"Invalid lead status"})})}),pe=({followupEdit:s,setFollowupEdit:i})=>{const[n,m]=y.useState({}),p=["AB","BC","BDS","CA","DPD MAGMA","MB","ON","Super Leads","TBAB","USA"],h=["New","In Progress","Completed","On Hold","Lost"],l=(r,a)=>{const c=$.sanitize(a);let o="",x=c;if(r==="lead_date"&&/^\d{4}-\d{2}-\d{2}$/.test(c)){const[u,b,C]=c.split("-");x=`${C}-${b}-${u}`}const t={...s,[r]:x},d=ue.safeParse(t);if(!d.success){const u=d.error.errors.find(b=>b.path[0]===r);o=u?u.message:""}m(u=>({...u,[r]:o})),i(u=>({...u,[r]:c}))},j=[{label:"Lead#",key:"lead_no",type:"text",placeholder:"Enter lead#",required:!0},{label:"Lead Date",key:"lead_date",type:"date",placeholder:"Enter lead date",required:!0},{label:"Customer Name",key:"customer_name",placeholder:"Enter customer name"},{label:"Phone",key:"phone",type:"text",placeholder:"Enter phone number"},{label:"Email",key:"email",type:"text",placeholder:"Enter email"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Lead Info"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[j.map(({label:r,key:a,type:c,placeholder:o,required:x})=>e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:a,children:[r," ",x&&e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsx("input",{type:c,id:a,placeholder:o,value:s[a]||"",onChange:t=>l(a,t.target.value)}),n[a]&&e.jsx("span",{className:"error",style:{color:"red"},children:n[a]})]},a)),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"lead_type",children:["Lead Type ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"lead_type",value:s.lead_type||"",onChange:r=>i(a=>({...a,lead_type:r.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Lead Type"}),p.map(r=>e.jsx("option",{value:r,children:r},r))]}),n.lead_type&&e.jsx("span",{className:"error",style:{color:"red"},children:n.lead_type})]}),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"lead_status",children:["Lead Status ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"lead_status",value:s.lead_status||"",onChange:r=>i(a=>({...a,lead_status:r.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Lead Status"}),h.map(r=>e.jsx("option",{value:r,children:r},r))]}),n.lead_status&&e.jsx("span",{className:"error",style:{color:"red"},children:n.lead_status})]})]})]})},he=({followup:s,onClose:i,onUpdate:n})=>{const{followupEdit:m,setFollowupEdit:p,handleAddContact:h,handleAddProduct:l,handleContactChange:j,handleRemoveContact:r,handleProductChange:a,handleRemoveProduct:c,updateFollowup:o}=me(s,i,n);return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:x=>{x.preventDefault(),o()},className:"form-main",children:[e.jsx(pe,{followupEdit:m,setFollowupEdit:p}),e.jsx(ae,{followupEdit:m,setFollowupEdit:p}),e.jsx(le,{followupEdit:m,setFollowupEdit:p}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:m.contacts.map((x,t)=>e.jsx(ne,{contacts:m.contacts,index:t,onAddContact:h,handleContactChange:j,handleRemoveContact:r},t))}),m.contacts.length===0&&e.jsx("button",{type:"button",onClick:h,className:"add-button",children:e.jsx(I,{})})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Products"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:m.products.map((x,t)=>e.jsx(de,{products:m.products,index:t,onAddProduct:l,handleProductChange:a,handleRemoveProduct:c},t))}),m.products.length===0&&e.jsx("button",{type:"button",onClick:l,className:"add-button",children:e.jsx(I,{})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Save"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:i,children:"Cancel"})]})]})})},xe=({followupEdit:s})=>{const[i,n]=y.useState([]),m="http://127.0.0.1:8000/api";return y.useEffect(()=>{(async()=>{try{const h=localStorage.getItem("token"),{data:l}=await E.get(`${m}/lead`,{headers:{Authorization:`Bearer ${h}`}});console.log("Fetched leads:",l);const j=(Array.isArray(l),l);if(!Array.isArray(j)){console.error("Unexpected API response format:",l);return}const r=j.map(a=>({value:a.customer_name,label:a.customer_name}));n(r)}catch(h){console.error("Error fetching leads:",h)}})()},[]),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Follow-up Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Lead No"}),e.jsx("div",{children:s.lead_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Lead Date"}),e.jsx("div",{children:s.lead_date||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Lead"}),e.jsx("div",{children:s.customer_name||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:s.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:s.email||"N/A"})]})]})]})},je=({followupEdit:s})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Address Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:s.address})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Unit No"}),e.jsx("div",{children:s.unit_no})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"City"}),e.jsx("div",{children:s.city})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"State"}),e.jsx("div",{children:s.state})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Country"}),e.jsx("div",{children:s.country})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Postal Code"}),e.jsx("div",{children:s.postal_code})]})]})]}),fe=({followupEdit:s})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Lead Type and Contact"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Lead Type"}),e.jsx("div",{children:s.lead_type||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Contact Person"}),e.jsx("div",{children:s.contact_person||"N/A"})]})]})]}),ge=({followupEdit:s})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Additional Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Equipment"}),e.jsx("div",{children:s.equipment})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Remarks"}),e.jsx("div",{children:s.remarks})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Notes"}),e.jsx("div",{children:s.notes})]})]})]}),ye=({followupEdit:s})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Follow Up Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Next Follow-Up Date"}),e.jsx("div",{children:s.next_follow_up_date||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Lead Status"}),e.jsx("div",{children:s.lead_status||"N/A"})]})]})]}),be=({contact:s})=>e.jsxs("div",{className:"contact-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:s.name||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:s.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:s.email||"N/A"})]})]}),ve=({product:s})=>e.jsx("fieldset",{children:e.jsxs("div",{className:"contact-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:s.name||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity"}),e.jsx("div",{children:s.quantity??"N/A"})]})]})}),Ne=({followUp:s,onClose:i})=>{var p;const[n,m]=y.useState({id:0,lead_no:"",lead_date:"",customer_name:"",phone:"",email:"",address:"",city:"",state:"",country:"",postal_code:"",unit_no:"",lead_type:"",contact_person:"",notes:"",next_follow_up_date:"",followup_type:"",products:[],lead_status:"",remarks:"",equipment:"",contacts:[],created_at:"",updated_at:""});return y.useEffect(()=>{if(s){const h=Array.isArray(s.contacts)?s.contacts:JSON.parse(s.contacts||"[]"),l=Array.isArray(s.products)?s.products:JSON.parse(s.products||"[]");m({...s,contacts:h.length>0?h:[],products:l.length>0?l:[]})}},[s]),e.jsx("div",{className:"form-container",children:e.jsxs("form",{className:"form-main",children:[e.jsx(xe,{followupEdit:n}),e.jsx(je,{followupEdit:n}),e.jsx(fe,{followupEdit:n}),e.jsx(ye,{followupEdit:n}),e.jsx(ge,{followupEdit:n}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),e.jsx("hr",{}),n.contacts.map((h,l)=>e.jsx(be,{contact:h},l))]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Products"}),e.jsx("hr",{}),(p=n.products)==null?void 0:p.map((h,l)=>e.jsx(ve,{product:h},l))]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"button",className:"btn-cancel",onClick:i,style:{padding:"9px 15px"},children:"Cancel"})})]})})},T="http://127.0.0.1:8000/api",_e=()=>{const[s,i]=y.useState([]),[n,m]=y.useState(!0),[p,h]=y.useState(""),[l,j]=y.useState("created_at"),[r,a]=y.useState(!0),[c,o]=y.useState(1),[x,t]=y.useState(null),[d,u]=y.useState(!1),[b,C]=y.useState(!1),[w,F]=y.useState([]),[P,O]=y.useState(10);y.useEffect(()=>{(async()=>{try{const _=localStorage.getItem("token");if(!_)throw new Error("No token found");m(!0);const{data:N}=await E.get(`${T}/lead-followup`,{headers:{Authorization:`Bearer ${_}`}});console.log("Fetched Leads:",N),i(N)}catch(_){console.error("Error loading leads:",_),L(_)}finally{m(!1)}})()},[]);const L=f=>{f.response&&f.response.status===401&&A.fire({icon:"error",title:"Unauthorized",text:"You need to log in to access this resource."})},M=f=>{o(f)},D=f=>{t(f),u(!0)},k=()=>{u(!1),t(null)},v=f=>{t(f),C(!0)},V=()=>{C(!1),t(null)},q=f=>{i(_=>_.map(N=>N.id===f.id?{...N,...f}:N))},U=()=>{w.length===s.length?F([]):F(s.map(f=>f.id))},Z=f=>{F(_=>_.includes(f)?_.filter(N=>N!==f):[..._,f])},Y=async()=>{if(w.length===0){A.fire({icon:"warning",title:"No record selected",text:"Please select a record to delete."});return}if((await A.fire({title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete selected!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const _=localStorage.getItem("token");if(!_)throw new Error("No token found");await Promise.all(w.map(N=>E.delete(`${T}/lead-followup/${N}`,{headers:{Authorization:`Bearer ${_}`}}))),i(N=>N.filter(S=>!w.includes(S.id))),F([]),A.fire("Deleted!","Selected follow-ups have been deleted.","success")}catch(_){console.error("Error deleting follow-ups:",_),A.fire({icon:"error",title:"Error!",text:"Failed to delete selected follow-ups."})}},Q=f=>{l===f?a(!r):(j(f),a(!1))},B=s.filter(f=>f.customer_name.toLowerCase().includes(p.toLowerCase())||f.phone.toLowerCase().includes(p.toLowerCase())||f.email.toLowerCase().includes(p.toLowerCase())),H=B.sort((f,_)=>{let N=f[l]??"",S=_[l]??"";return typeof N=="string"&&typeof S=="string"?r?S.localeCompare(N):N.localeCompare(S):typeof N=="number"&&typeof S=="number"?r?S-N:N-S:0}).slice((c-1)*P,c*P),J=Math.ceil(B.length/P);return{followUps:s,loading:n,searchQuery:p,setSearchQuery:h,sortBy:l,sortDesc:r,selectedIds:w,setSelectedIds:F,selectedFollowup:x,paginatedData:H,totalPages:J,currentPage:c,setCurrentPage:o,isEditModalOpen:d,isViewModalOpen:b,setEditModalOpen:u,setViewModalOpen:C,openEditModal:D,closeEditModal:k,openViewModal:v,closeViewModal:V,toggleSelectAll:U,toggleSelect:Z,deleteSelected:Y,handleSort:Q,updateFollowup:q,handlePageChange:M}},Ce=()=>{const{followUps:s,loading:i,searchQuery:n,setSearchQuery:m,sortBy:p,sortDesc:h,selectedIds:l,paginatedData:j,totalPages:r,currentPage:a,isEditModalOpen:c,isViewModalOpen:o,selectedFollowup:x,setEditModalOpen:t,openEditModal:d,openViewModal:u,closeViewModal:b,toggleSelectAll:C,toggleSelect:w,deleteSelected:F,handleSort:P,updateFollowup:O,handlePageChange:L}=_e(),M=v=>v.key==="checkbox"||v.key==="actions"?v.label:e.jsxs("div",{className:"sortable-header",onClick:()=>P(v.key),children:[v.label,e.jsx("span",{className:"sort-icon",children:p===v.key?h?"▼":"▲":"▼"})]}),D=[{key:"checkbox",label:e.jsx("input",{type:"checkbox",onChange:C,checked:l.length===j.length&&j.length>0}),render:v=>e.jsx("input",{type:"checkbox",checked:l.includes(v.id),onChange:()=>w(v.id)})},{key:"lead_no",label:"Lead#"},{key:"lead_date",label:"Date"},{key:"customer_name",label:"Customer Name"},{key:"phone",label:"Phone"},{key:"email",label:"Email"},{key:"lead_type",label:"Lead Type"},{key:"lead_status",label:"Status",render:v=>e.jsx("span",{className:`badge ${k(v.lead_status)}`,children:v.lead_status})},{key:"actions",label:"",render:v=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u(v),className:"btn-view",children:e.jsx(ee,{})}),e.jsx("button",{onClick:()=>d(v),className:"btn-edit",children:e.jsx(G,{})})]})}],k=v=>{switch(v){case"New":return"badge-new";case"In Progress":return"badge-in-progress";case"Completed":return"badge-completed";case"On Hold":return"badge-on-hold";case"Lost":return"badge-lost";default:return"badge-default"}};return e.jsxs("div",{children:[e.jsxs("div",{className:"header-container",children:[e.jsx("h1",{className:"page-heading",children:"Lead Follow-ups"}),e.jsxs("div",{className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(se,{className:"search-icon"}),e.jsx("input",{className:"search-bar",value:n,onChange:v=>m(v.target.value)})]}),e.jsx("button",{onClick:F,className:"delete-button",children:e.jsx(z,{})})]})]}),i?e.jsx("div",{children:"Loading..."}):s.length===0?e.jsx("div",{children:"No records found"}):e.jsx(K,{data:j,headers:D.map(v=>({...v,label:M(v)})),handleSort:P,sortBy:p,sortDesc:h}),e.jsx(W,{currentPage:a,totalPages:r,onPageChange:L}),e.jsx(R,{isOpen:c,onClose:()=>t(!1),title:"Edit Followup",children:x&&e.jsx(he,{followup:x,onClose:()=>t(!1),onUpdate:O})}),e.jsx(R,{isOpen:o,onClose:b,title:"Follow-up Details",children:x&&e.jsx(Ne,{followUp:x,onClose:b})})]})},Ie=()=>e.jsx("div",{children:e.jsx(Ce,{})});export{Ie as default};

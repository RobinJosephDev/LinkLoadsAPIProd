import{r as v,j as e,b as C,S as N}from"./index-DIkLPauo.js";import{R as E,a as I,b as O,T as Y,M as w}from"./Modal-eCOdHaLv.js";import{z as c,P as Z}from"./Pagination-CBj8D3Ir.js";import A from"./purify.es-Ci5xwkH_.js";import{u as M}from"./useGoogleAutocomplete-prBrAP6L.js";import{u as H,d as $}from"./useEditLead-CkdTO6fW.js";/* empty css             */import{u as Q}from"./useLeadTable-C4rYuWbp.js";import{R as P}from"./CalendarOutlined-BLMOJr8f.js";import{o as G,R as W}from"./EyeOutlined-w7sh7xlH.js";const J=c.object({name:c.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]+$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),phone:c.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),email:c.string().max(255,"Email must be at most 255 characters").email("Invalid email format").optional()}),L=({contacts:a,index:m,handleContactChange:l,handleRemoveContact:u,onAddContact:x})=>{const j=a[m]??{},[d,o]=v.useState({}),p=v.useCallback((t,r)=>{const n=A.sanitize(r);let i="";const h={...j,[t]:n},f=J.safeParse(h);if(!f.success){const y=f.error.errors.find(b=>b.path[0]===t);i=y?y.message:""}o(y=>({...y,[t]:i})),l(m,h)},[j,l,m]),s=[{label:"Name",key:"name",type:"text",placeholder:"Enter name"},{label:"Phone",key:"phone",type:"tel",placeholder:"Enter phone"},{label:"Email",key:"email",type:"email",placeholder:"Enter email"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[s.map(({label:t,key:r,type:n,placeholder:i})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${r}-${m}`,children:t}),e.jsx("input",{id:`${r}-${m}`,type:n,name:r,value:j[r]||"",onChange:h=>p(r,h.target.value),placeholder:i}),d[r]&&e.jsx("span",{className:"error",style:{color:"red"},children:d[r]})]},r)),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:x,className:"add-button",children:e.jsx(E,{})}),e.jsx("button",{type:"button",onClick:()=>u(m),className:"delete-button",children:e.jsx(I,{})})]})]})},K=c.object({lead_no:c.string().max(200,"Legal No must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),lead_date:c.string().min(1,"Lead Date is required").regex(/^\d{2}-\d{2}-\d{4}$/,{message:"Date must be in DD-MM-YYYY format"}).optional(),customer_name:c.string().max(200,"Customer Name must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),phone:c.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),email:c.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),website:c.string().max(255,"Website must be at most 255 characters long").url("Invalid website URL").optional(),lead_type:c.enum(["AB","BC","BDS","CA","DPD MAGMA","MB","ON","Super Leads","TBAB","USA"],{errorMap:()=>({message:"Invalid lead type"})}),lead_status:c.enum(["Prospect","Lanes discussed","Prod/Equip noted","E-mail sent","Portal registration","Quotations","Fob/Have broker","VM/No answer","Diff Dept.","No reply","Not Int.","Asset based"],{errorMap:()=>({message:"Invalid lead status"})})}),X=({formLead:a,setFormLead:m})=>{const[l,u]=v.useState({}),x=(d,o)=>{const p=A.sanitize(o);let s="",t=p;if(d==="lead_date"&&/^\d{4}-\d{2}-\d{2}$/.test(p)){const[i,h,f]=p.split("-");t=`${f}-${h}-${i}`}const r={...a,[d]:t},n=K.safeParse(r);if(!n.success){const i=n.error.errors.find(h=>h.path[0]===d);s=i?i.message:""}u(i=>({...i,[d]:s})),m(i=>({...i,[d]:p}))},j=[{label:"Lead#",key:"lead_no",type:"text",placeholder:"Enter lead#",required:!0},{label:"Lead Date",key:"lead_date",type:"date",placeholder:"Enter lead date",required:!0},{label:"Customer Name",key:"customer_name",placeholder:"Enter customer name"},{label:"Phone",key:"phone",type:"text",placeholder:"Enter phone number"},{label:"Email",key:"email",type:"text",placeholder:"Enter email"},{label:"Website",key:"website",type:"text",placeholder:"Enter website URL"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Lead Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[j.map(({label:d,key:o,type:p,placeholder:s,required:t})=>e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:o,children:[d," ",t&&e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsx("input",{type:p,id:o,placeholder:s,value:a[o]||"",onChange:r=>x(o,r.target.value)}),l[o]&&e.jsx("span",{className:"error",style:{color:"red"},children:l[o]})]},o)),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"lead_type",children:["Lead Type ",e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsxs("select",{id:"lead_type",value:a.lead_type||"",onChange:d=>m(o=>({...o,lead_type:d.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Lead Type"}),e.jsx("option",{value:"AB",children:"AB"}),e.jsx("option",{value:"BC",children:"BC"}),e.jsx("option",{value:"BDS",children:"BDS"}),e.jsx("option",{value:"CA",children:"CA"}),e.jsx("option",{value:"DPD MAGMA",children:"DPD MAGMA"}),e.jsx("option",{value:"MB",children:"MB"}),e.jsx("option",{value:"ON",children:"ON"}),e.jsx("option",{value:"Super Leads",children:"Super Leads"}),e.jsx("option",{value:"TBAB",children:"TBAB"}),e.jsx("option",{value:"USA",children:"USA"})]}),l.lead_type&&e.jsx("span",{className:"error",style:{color:"red"},children:l.lead_type})]}),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"lead_status",children:["Lead Status ",e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsxs("select",{id:"lead_status",value:a.lead_status||"",onChange:d=>m(o=>({...o,lead_status:d.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Lead Status"}),e.jsx("option",{value:"Prospect",children:"Prospect"}),e.jsx("option",{value:"Lanes discussed",children:"Lanes discussed"}),e.jsx("option",{value:"Prod/Equip noted",children:"Prod/Equip noted"}),e.jsx("option",{value:"E-mail sent",children:"E-mail sent"}),e.jsx("option",{value:"Portal registration",children:"Portal registration"}),e.jsx("option",{value:"Quotations",children:"Quotations"}),e.jsx("option",{value:"Fob/Have broker",children:"Fob/Have broker"}),e.jsx("option",{value:"VM/No answer",children:"VM/No answer"}),e.jsx("option",{value:"Diff Dept.",children:"Diff Dept."}),e.jsx("option",{value:"No reply",children:"No reply"}),e.jsx("option",{value:"Not Int.",children:"Not Int."}),e.jsx("option",{value:"Asset based",children:"Asset based"})]}),l.lead_status&&e.jsx("span",{className:"error",style:{color:"red"},children:l.lead_status})]})]})]})},ee=c.object({address:c.string().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),city:c.string().max(200,"City name is too long").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),state:c.string().max(200,"Invalid state").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),country:c.string().max(100,"Invalid country").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),postal_code:c.string().max(20,"Postal code cannot exceed 20 characters").regex(/^[a-zA-Z0-9-\s ]*$/,"Invalid postal code").optional(),unit_no:c.string().max(20,"Unit no. cannot exceed 20 characters").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid unit no. format").optional()}),se=({formLead:a,setFormLead:m})=>{const[l,u]=v.useState({}),j=M(p=>{const s=t=>{var r,n;return((n=(r=p.address_components)==null?void 0:r.find(i=>i.types.includes(t)))==null?void 0:n.long_name)||""};m(t=>({...t,address:`${s("street_number")} ${s("route")}`.trim(),city:s("locality"),state:s("administrative_area_level_1"),country:s("country"),postal_code:s("postal_code")}))}),d=(p,s)=>{const t=A.sanitize(s);let r="";const n={...a,[p]:t},i=ee.safeParse(n);if(!i.success){const h=i.error.errors.find(f=>f.path[0]===p);r=h?h.message:""}u(h=>({...h,[p]:r})),m(n)},o=[{label:"Address",key:"address",placeholder:"Enter street address"},{label:"City",key:"city",placeholder:"Enter city name"},{label:"State",key:"state",placeholder:"Enter state"},{label:"Country",key:"country",placeholder:"Enter country"},{label:"Postal Code",key:"postal_code",placeholder:"Enter postal code"},{label:"Unit No.",key:"unit_no",placeholder:"Enter unit number"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Address Details"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:o.map(({label:p,key:s,placeholder:t})=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:s,children:p}),e.jsx("input",{type:"text",id:s,placeholder:t,value:a[s]||"",onChange:r=>d(s,r.target.value),ref:s==="address"?j:void 0}),l[s]&&e.jsx("span",{className:"error",style:{color:"red"},children:l[s]})]},s))})]})},te=c.object({follow_up_date:c.string().regex(/^\d{2}-\d{2}-\d{4}$/,{message:"Date must be in DD-MM-YYYY format"}).optional(),contact_person:c.string().max(200,"Contact name must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),equipment_type:c.enum(["Van","Reefer","Flatbed","Triaxle","Maxi","Btrain","Roll tite"],{errorMap:()=>({message:"Invalid equipment type"})}).optional(),assigned_to:c.string().min(1,"Assigned To is required").max(200,"Assigned To must be at most 200 characters long").regex(/^[a-zA-Z\s'-]+$/,"Only letters, spaces, apostrophes, and hyphens allowed"),notes:c.string().max(500,"Notes must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional()}),ae=({formLead:a,setFormLead:m})=>{const[l,u]=v.useState({}),x="https://linkloadsapiprod.onrender.com/api",[j,d]=v.useState([]);v.useEffect(()=>{(async()=>{var t,r;try{const n=localStorage.getItem("token");if(!n)throw new Error("No token found. Please log in.");const h=(await C.get(`${x}/user`,{headers:{Authorization:`Bearer ${n}`}})).data.filter(f=>f.role==="employee");d(h)}catch(n){console.error("Error fetching users:",n),N.fire({icon:"error",title:((t=n.response)==null?void 0:t.status)===401?"Unauthorized":"Error",text:((r=n.response)==null?void 0:r.status)===401?"You are not authorized to view this data. Please log in again.":"An error occurred while fetching users. Please try again."})}})()},[x]);const o=(s,t)=>{const r=A.sanitize(t);let n="",i=r;if(s==="follow_up_date"&&/^\d{4}-\d{2}-\d{2}$/.test(r)){const[y,b,_]=r.split("-");i=`${_}-${b}-${y}`}const h={...a,[s]:i},f=te.safeParse(h);if(!f.success){const y=f.error.errors.find(b=>b.path[0]===s);n=y?y.message:""}u(y=>({...y,[s]:n})),m(y=>({...y,[s]:r}))},p=[{label:"Next Follow-Up Date",key:"follow_up_date",type:"date",placeholder:"Enter follow-up date"},{label:"Contact Person",key:"contact_person",type:"text",placeholder:"Enter contact person"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Additional Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[p.map(({label:s,key:t,type:r,placeholder:n})=>e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:t,children:s}),e.jsx("input",{type:r,id:t,placeholder:n,value:a[t]||"",onChange:i=>o(t,i.target.value)}),l[t]&&e.jsx("span",{className:"error",style:{color:"red"},children:l[t]})]},t)),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"equipmentType",children:"Equipment Type"}),e.jsxs("select",{id:"equipmentType",value:a.equipment_type||"",onChange:s=>m(t=>({...t,equipment_type:s.target.value})),children:[e.jsx("option",{value:"",children:"Select Equipment Type"}),e.jsx("option",{value:"Van",children:"Van"}),e.jsx("option",{value:"Reefer",children:"Reefer"}),e.jsx("option",{value:"Flatbed",children:"Flatbed"}),e.jsx("option",{value:"Triaxle",children:"Triaxle"}),e.jsx("option",{value:"Maxi",children:"Maxi"}),e.jsx("option",{value:"Btrain",children:"Btrain"}),e.jsx("option",{value:"Roll tite",children:"Roll tite"})]}),l.equipment_type&&e.jsx("span",{className:"error",style:{color:"red"},children:l.equipment_type})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"assignedTo",children:"Assigned To"}),e.jsxs("select",{id:"assignedTo",value:a.assigned_to,onChange:s=>o("assigned_to",s.target.value),children:[e.jsx("option",{value:"",children:"Select Employee"}),j.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),l.assigned_to&&e.jsx("span",{className:"error",style:{color:"red"},children:l.assigned_to})]})]}),e.jsx("div",{className:"form-row",style:{display:"flex"},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",placeholder:"Enter notes",value:a.notes||"",onChange:s=>o("notes",s.target.value),style:{width:"100%",minHeight:"100px"}}),l.notes&&e.jsx("span",{className:"error",style:{color:"red"},children:l.notes})]})})]})},le=({lead:a,onClose:m,onUpdate:l})=>{const{formLead:u,setFormLead:x,updateLead:j,handleAddContact:d,handleRemoveContact:o,handleContactChange:p}=H(a,m,l);return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),j()},className:"form-main",children:[e.jsx(X,{formLead:u,setFormLead:x}),e.jsx(se,{formLead:u,setFormLead:x}),e.jsx(ae,{formLead:u,setFormLead:x}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",children:[u.contacts.map((s,t)=>e.jsx(L,{contacts:u.contacts,index:t,onAddContact:d,handleContactChange:p,handleRemoveContact:o},t)),u.contacts.length===0&&e.jsx("button",{type:"button",onClick:d,className:"add-button",children:e.jsx(E,{})})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Save"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:m,children:"Cancel"})]})]})})},re=c.object({lead_no:c.string().min(1,"Lead No is required").max(100,"Lead No must be at most 100 characters long").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed"),lead_date:c.string().min(1,"Lead Date is required").regex(/^\d{2}-\d{2}-\d{4}$/,{message:"Date must be in DD-MM-YYYY format"}).optional(),customer_name:c.string().max(200,"Customer Name must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),phone:c.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),email:c.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),website:c.string().max(255,"Website must be at most 255 characters long").url("Invalid website URL").optional(),lead_type:c.enum(["AB","BC","BDS","CA","DPD MAGMA","MB","ON","Super Leads","TBAB","USA"],{errorMap:()=>({message:"Invalid lead type"})}),lead_status:c.enum(["Prospect","Lanes discussed","Prod/Equip noted","E-mail sent","Portal registration","Quotations","Fob/Have broker","VM/No answer","Diff Dept.","No reply","Not Int.","Asset based"],{errorMap:()=>({message:"Invalid lead status"})})}),oe=({lead:a,setLead:m})=>{const[l,u]=v.useState({}),x=(d,o)=>{const p=A.sanitize(o);let s="",t=p;if(d==="lead_date"&&/^\d{4}-\d{2}-\d{2}$/.test(p)){const[i,h,f]=p.split("-");t=`${f}-${h}-${i}`}const r={...a,[d]:t},n=re.safeParse(r);if(!n.success){const i=n.error.errors.find(h=>h.path[0]===d);s=i?i.message:""}u(i=>({...i,[d]:s})),m(i=>({...i,[d]:p}))},j=[{label:"Lead#",key:"lead_no",type:"text",placeholder:"Enter lead#",required:!0},{label:"Lead Date",key:"lead_date",type:"date",placeholder:"Enter lead date",required:!0},{label:"Customer Name",key:"customer_name",placeholder:"Enter customer name"},{label:"Phone",key:"phone",type:"text",placeholder:"Enter phone number"},{label:"Email",key:"email",type:"text",placeholder:"Enter email"},{label:"Website",key:"website",type:"text",placeholder:"Enter website URL"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Lead Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[j.map(({label:d,key:o,type:p,placeholder:s,required:t})=>e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:o,children:[d," ",t&&e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsx("input",{type:p,id:o,placeholder:s,value:a[o]||"",onChange:r=>x(o,r.target.value)}),l[o]&&e.jsx("span",{className:"error",style:{color:"red"},children:l[o]})]},o)),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"lead_type",children:["Lead Type ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"lead_type",value:a.lead_type||"",onChange:d=>m(o=>({...o,lead_type:d.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Lead Type"}),e.jsx("option",{value:"AB",children:"AB"}),e.jsx("option",{value:"BC",children:"BC"}),e.jsx("option",{value:"BDS",children:"BDS"}),e.jsx("option",{value:"CA",children:"CA"}),e.jsx("option",{value:"DPD MAGMA",children:"DPD MAGMA"}),e.jsx("option",{value:"MB",children:"MB"}),e.jsx("option",{value:"ON",children:"ON"}),e.jsx("option",{value:"Super Leads",children:"Super Leads"}),e.jsx("option",{value:"TBAB",children:"TBAB"}),e.jsx("option",{value:"USA",children:"USA"})]}),l.lead_type&&e.jsx("span",{className:"error",style:{color:"red"},children:l.lead_type})]}),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"lead_status",children:["Lead Status ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"lead_status",value:a.lead_status||"",onChange:d=>m(o=>({...o,lead_status:d.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Lead Status"}),e.jsx("option",{value:"Prospect",children:"Prospect"}),e.jsx("option",{value:"Lanes discussed",children:"Lanes discussed"}),e.jsx("option",{value:"Prod/Equip noted",children:"Prod/Equip noted"}),e.jsx("option",{value:"E-mail sent",children:"E-mail sent"}),e.jsx("option",{value:"Portal registration",children:"Portal registration"}),e.jsx("option",{value:"Quotations",children:"Quotations"}),e.jsx("option",{value:"Fob/Have broker",children:"Fob/Have broker"}),e.jsx("option",{value:"VM/No answer",children:"VM/No answer"}),e.jsx("option",{value:"Diff Dept.",children:"Diff Dept."}),e.jsx("option",{value:"No reply",children:"No reply"}),e.jsx("option",{value:"Not Int.",children:"Not Int."}),e.jsx("option",{value:"Asset based",children:"Asset based"})]}),l.lead_status&&e.jsx("span",{className:"error",style:{color:"red"},children:l.lead_status})]})]})]})},ne=c.object({address:c.string().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),city:c.string().max(200,"City name is too long").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),state:c.string().max(200,"Invalid state").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),country:c.string().max(100,"Invalid country").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),postal_code:c.string().max(20,"Postal code cannot exceed 20 characters").regex(/^[a-zA-Z0-9-\s ]*$/,"Invalid postal code").optional(),unit_no:c.string().max(20,"Unit no. cannot exceed 20 characters").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid unit no. format").optional()}),ie=({lead:a,setLead:m})=>{const[l,u]=v.useState({}),j=M(p=>{const s=t=>{var r,n;return((n=(r=p.address_components)==null?void 0:r.find(i=>i.types.includes(t)))==null?void 0:n.long_name)||""};m(t=>({...t,address:`${s("street_number")} ${s("route")}`.trim(),city:s("locality"),state:s("administrative_area_level_1"),country:s("country"),postal_code:s("postal_code")}))}),d=(p,s)=>{const t=A.sanitize(s);let r="";const n={...a,[p]:t},i=ne.safeParse(n);if(!i.success){const h=i.error.errors.find(f=>f.path[0]===p);r=h?h.message:""}u(h=>({...h,[p]:r})),m(n)},o=[{label:"Address",key:"address",placeholder:"Enter street address"},{label:"City",key:"city",placeholder:"Enter city name"},{label:"State",key:"state",placeholder:"Enter state"},{label:"Country",key:"country",placeholder:"Enter country"},{label:"Postal Code",key:"postal_cide",placeholder:"Enter postal code"},{label:"Unit No.",key:"unit_no",placeholder:"Enter unit number"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Address Details"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:o.map(({label:p,key:s,placeholder:t})=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:s,children:p}),e.jsx("input",{type:"text",id:s,placeholder:t,value:a[s]||"",onChange:r=>d(s,r.target.value),ref:s==="address"?j:void 0}),l[s]&&e.jsx("span",{className:"error",style:{color:"red"},children:l[s]})]},s))})]})},de=c.object({follow_up_date:c.string().regex(/^\d{2}-\d{2}-\d{4}$/,{message:"Date must be in DD-MM-YYYY format"}).optional(),contact_person:c.string().max(200,"Contact name must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),equipment_type:c.enum(["Van","Reefer","Flatbed","Triaxle","Maxi","Btrain","Roll tite"],{errorMap:()=>({message:"Invalid equipment type"})}).optional(),assigned_to:c.string().max(200,"Assigned To must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),notes:c.string().max(500,"Notes must be at most 500 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional()}),ce=({lead:a,setLead:m})=>{const[l,u]=v.useState({}),x="https://linkloadsapiprod.onrender.com/api",[j,d]=v.useState([]);v.useEffect(()=>{(async()=>{var t,r;try{const n=localStorage.getItem("token");if(!n)throw new Error("No token found. Please log in.");const h=(await C.get(`${x}/user`,{headers:{Authorization:`Bearer ${n}`}})).data.filter(f=>f.role==="employee");d(h)}catch(n){console.error("Error fetching users:",n),N.fire({icon:"error",title:((t=n.response)==null?void 0:t.status)===401?"Unauthorized":"Error",text:((r=n.response)==null?void 0:r.status)===401?"You are not authorized to view this data. Please log in again.":"An error occurred while fetching users. Please try again."})}})()},[x]);const o=(s,t)=>{const r=A.sanitize(t);let n="",i=r;if(s==="follow_up_date"&&/^\d{4}-\d{2}-\d{2}$/.test(r)){const[y,b,_]=r.split("-");i=`${_}-${b}-${y}`}const h={...a,[s]:i},f=de.safeParse(h);if(!f.success){const y=f.error.errors.find(b=>b.path[0]===s);n=y?y.message:""}u(y=>({...y,[s]:n})),m(y=>({...y,[s]:r}))},p=[{label:"Next Follow-Up Date",key:"follow_up_date",type:"date",placeholder:"Enter follow-up date"},{label:"Contact Person",key:"contact_person",type:"text",placeholder:"Enter contact person"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Additional Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[p.map(({label:s,key:t,type:r,placeholder:n})=>e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:t,children:s}),e.jsx("input",{type:r,id:t,placeholder:n,value:a[t]||"",onChange:i=>o(t,i.target.value)}),l[t]&&e.jsx("span",{className:"error",style:{color:"red"},children:l[t]})]},t)),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"equipmentType",children:"Equipment Type"}),e.jsxs("select",{id:"equipmentType",value:a.equipment_type||"",onChange:s=>m(t=>({...t,equipment_type:s.target.value})),children:[e.jsx("option",{value:"",children:"Select Equipment Type"}),e.jsx("option",{value:"Van",children:"Van"}),e.jsx("option",{value:"Reefer",children:"Reefer"}),e.jsx("option",{value:"Flatbed",children:"Flatbed"}),e.jsx("option",{value:"Triaxle",children:"Triaxle"}),e.jsx("option",{value:"Maxi",children:"Maxi"}),e.jsx("option",{value:"Btrain",children:"Btrain"}),e.jsx("option",{value:"Roll tite",children:"Roll tite"})]}),l.equipment_type&&e.jsx("span",{className:"error",style:{color:"red"},children:l.equipment_type})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"assignedTo",children:"Assigned To"}),e.jsxs("select",{id:"assignedTo",value:a.assigned_to,onChange:s=>o("assigned_to",s.target.value),children:[e.jsx("option",{value:"",children:"Select Employee"}),j.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),l.assigned_to&&e.jsx("span",{className:"error",style:{color:"red"},children:l.assigned_to})]})]}),e.jsx("div",{className:"form-row",style:{display:"flex"},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",placeholder:"Enter notes",value:a.notes||"",onChange:s=>o("notes",s.target.value),style:{width:"100%",minHeight:"100px"}}),l.notes&&e.jsx("span",{className:"error",style:{color:"red"},children:l.notes})]})})]})},F="https://linkloadsapiprod.onrender.com/api",pe=(a,m)=>{const[l,u]=v.useState({id:0,lead_no:"",lead_date:"",customer_name:"",phone:"",email:"",website:"",address:"",unit_no:"",city:"",state:"",country:"",postal_code:"",lead_type:"",contact_person:"",notes:"",lead_status:"",follow_up_date:"",equipment_type:"",assigned_to:"",contacts:[],created_at:"",updated_at:""}),x=()=>!!l.lead_no&&!!l.lead_date&&!!l.lead_type&&!!l.lead_status,j=async t=>{if(t.preventDefault(),!x()){N.fire("Validation Error","Please fill in all required fields.","error");return}try{const r=localStorage.getItem("token");if(!r){N.fire("Error","No token found","error");return}const n={Authorization:`Bearer ${r}`},i=l.id?await C.put(`${F}/lead/${l.id}`,l,{headers:n}):await C.post(`${F}/lead`,l,{headers:n});N.fire("Success","Lead data has been saved successfully.","success"),d(),m()}catch(r){console.error("Error saving/updating lead:",r),N.fire("Error","An error occurred while saving/updating the lead.","error")}},d=()=>{u({id:0,lead_no:"",lead_date:"",customer_name:"",phone:"",email:"",website:"",address:"",unit_no:"",city:"",state:"",country:"",postal_code:"",lead_type:"",contact_person:"",notes:"",lead_status:"",follow_up_date:"",equipment_type:"",assigned_to:"",contacts:[],created_at:"",updated_at:""})};return{lead:l,setLead:u,handleAddContact:()=>{u(t=>({...t,contacts:[...t.contacts,{name:"",phone:"",email:"",fax:"",designation:""}]}))},handleRemoveContact:t=>{u(r=>({...r,contacts:r.contacts.filter((n,i)=>i!==t)}))},handleContactChange:(t,r)=>{const n=l.contacts.map((i,h)=>h===t?r:i);u(i=>({...i,contacts:n}))},handleSubmit:j,clearLeadForm:d}},me=({onClose:a,onSuccess:m})=>{const{lead:l,setLead:u,handleAddContact:x,handleRemoveContact:j,handleContactChange:d,handleSubmit:o}=pe(a,m);return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:o,className:"form-main",children:[e.jsx(oe,{lead:l,setLead:u}),e.jsx(ie,{lead:l,setLead:u}),e.jsx(ce,{lead:l,setLead:u}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:l.contacts.map((p,s)=>e.jsx(L,{contacts:l.contacts,index:s,onAddContact:x,handleContactChange:d,handleRemoveContact:j},s))}),l.contacts.length===0&&e.jsx("button",{type:"button",onClick:x,className:"add-button",children:e.jsx(E,{})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Create Lead"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:a,children:"Cancel"})]})]})})},he=({formLead:a})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Lead Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadNo",children:"Lead No"}),e.jsx("div",{children:a.lead_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadDate",children:"Lead Date"}),e.jsx("div",{children:a.lead_date||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"customerName",children:"Customer Name"}),e.jsx("div",{children:a.customer_name||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"phone",children:"Phone"}),e.jsx("div",{children:a.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("div",{children:a.email||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"website",children:"Website"}),e.jsx("div",{children:a.website||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadType",children:"Lead Type"}),e.jsx("div",{children:a.lead_type||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadStatus",children:"Lead Status"}),e.jsx("div",{children:a.lead_status||"N/A"})]})]})]}),ue=({formLead:a})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Address Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"address",children:"Address"}),e.jsx("div",{children:a.address||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"unitNo",children:"Unit No"}),e.jsx("div",{children:a.unit_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"city",children:"City"}),e.jsx("div",{children:a.city||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"state",children:"State"}),e.jsx("div",{children:a.state||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"country",children:"Country"}),e.jsx("div",{children:a.country||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"postalCode",children:"Postal Code"}),e.jsx("div",{children:a.postal_code||"N/A"})]})]})]}),xe=({formLead:a})=>{const m="https://linkloadsapiprod.onrender.com/api",[l,u]=v.useState([]);return v.useEffect(()=>{(async()=>{var j;try{const d=localStorage.getItem("token");if(!d)throw new Error("No token found. Please log in.");const p=(await C.get(`${m}/user`,{headers:{Authorization:`Bearer ${d}`}})).data.filter(s=>s.role==="employee");u(p)}catch(d){console.error("Error fetching users:",d),((j=d.response)==null?void 0:j.status)===401?N.fire({icon:"error",title:"Unauthorized",text:"You are not authorized to view this data. Please log in again."}):N.fire({icon:"error",title:"Error",text:"An error occurred while fetching users. Please try again."})}})()},[]),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Additional Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"follow_up_date",children:"Next Follow-Up Date"}),e.jsx("div",{children:a.follow_up_date||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"equipmentType",children:"Equipment Type"}),e.jsx("div",{children:a.equipment_type||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"assignedTo",children:"Assigned To"}),e.jsx("div",{children:a.assigned_to||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"contactPerson",children:"Contact Person"}),e.jsx("div",{children:a.contact_person||"N/A"})]})]}),e.jsx("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("div",{children:a.notes||"N/A"})]})})]})},je=({contact:a,index:m,onRemove:l})=>e.jsxs("div",{className:"contact-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:a.name||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:a.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:a.email||"N/A"})]})]}),ge=({lead:a,onClose:m})=>{const[l,u]=v.useState({id:0,lead_no:"",lead_date:"",customer_name:"",phone:"",email:"",website:"",address:"",unit_no:"",city:"",state:"",country:"",postal_code:"",equipment_type:"",lead_type:"",lead_status:"",contact_person:"",notes:"",follow_up_date:"",assigned_to:"",contacts:[]});return v.useEffect(()=>{if(a){let x=[];if(Array.isArray(a.contacts))x=a.contacts;else if(typeof a.contacts=="string")try{x=JSON.parse(a.contacts)||[]}catch{x=[]}u({...a,contacts:x.length>0?x:[]})}},[a]),e.jsx("div",{className:"form-container",children:e.jsxs("form",{className:"form-main",children:[e.jsx(he,{formLead:l}),e.jsx(ue,{formLead:l}),e.jsx(xe,{formLead:l}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:l.contacts&&l.contacts.map((x,j)=>e.jsx(je,{contact:x,index:j},j))})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"button",className:"btn-cancel",onClick:m,style:{padding:"9px 15px"},children:"Cancel"})})]})})},ye=()=>{const{fetchLeads:a,leads:m,loading:l,searchQuery:u,setSearchQuery:x,sortBy:j,sortDesc:d,selectedIds:o,paginatedData:p,totalPages:s,currentPage:t,isEditModalOpen:r,isAddModalOpen:n,isViewModalOpen:i,selectedLead:h,openEditModal:f,openViewModal:y,setEditModalOpen:b,setAddModalOpen:_,setViewModalOpen:S,toggleSelectAll:T,toggleSelect:z,deleteSelected:B,handleSort:D,updateLead:k,handlePageChange:q}=Q(),R=g=>g.key==="checkbox"||g.key==="actions"?g.label:e.jsxs("div",{className:"sortable-header",onClick:()=>D(g.key),children:[g.label,e.jsx("span",{className:"sort-icon",children:j===g.key?d?"▼":"▲":"▼"})]}),U=g=>({Prospect:"badge-prospect","Lanes discussed":"badge-lanes","Prod/Equip noted":"badge-product","E-mail sent":"badge-email","Portal registration":"badge-carrier",Quotations:"badge-quotation","Fob/Have broker":"badge-broker","VM/No answer":"badge-voicemail","Diff Dept.":"badge-different","No reply":"badge-callback","Not Int.":"badge-not-interested","Asset based":"badge-asset"})[g]||"badge-default",V=[{key:"checkbox",label:e.jsx("input",{type:"checkbox",onChange:T,checked:o.length===p.length&&p.length>0}),render:g=>e.jsx("input",{type:"checkbox",checked:o.includes(g.id),onChange:()=>z(g.id)})},{key:"lead_no",label:"Lead#"},{key:"customer_name",label:"Name"},{key:"lead_date",label:"Date",render:g=>e.jsxs("div",{className:"date-picker-container-normal",children:[e.jsx(P,{style:{marginRight:5}}),g.lead_date?$(g.lead_date).format("DD MMM, YYYY"):"-"]})},{key:"city",label:"City"},{key:"lead_type",label:"Type"},{key:"assigned_to",label:"Assigned To",render:g=>e.jsx("span",{children:g.assigned_to||"Unassigned"})},{key:"lead_status",label:"Status",render:g=>e.jsx("span",{className:`badge ${U(g.lead_status)}`,children:g.lead_status})},{key:"follow_up_date",label:"Follow Up",render:g=>e.jsxs("div",{className:"date-picker-container",children:[e.jsx(P,{style:{marginRight:5}}),g.follow_up_date?$(g.follow_up_date).format("DD MMM, YYYY"):"-"]})},{key:"actions",label:"",render:g=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>y(g),className:"btn-view",children:e.jsx(G,{})}),e.jsx("button",{onClick:()=>f(g),className:"btn-edit",children:e.jsx(O,{})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{className:"header-container",children:[e.jsx("div",{className:"header-container-left",children:e.jsx("h1",{className:"page-heading",children:"Leads"})}),e.jsxs("div",{className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(W,{className:"search-icon"}),e.jsx("input",{className:"search-bar",value:u,onChange:g=>x(g.target.value)})]}),e.jsxs("button",{onClick:()=>_(!0),className:"add-button",children:[e.jsx(E,{})," New"]})]})]}),o.length>0&&e.jsxs("div",{className:"selection-banner",children:[e.jsxs("span",{children:[o.length," item",o.length>1?"s":""," selected"]}),e.jsxs("button",{className:"text-delete-btn",onClick:B,children:[e.jsx(I,{}),"  Delete"]})]}),l?e.jsx("div",{children:"Loading..."}):m.length===0?e.jsx("div",{className:"no-record",children:"No records found"}):e.jsx(Y,{data:p,headers:V.map(g=>({...g,label:R(g)})),handleSort:D,sortBy:j,sortDesc:d}),e.jsx(Z,{currentPage:t,totalPages:s,onPageChange:q}),e.jsx(w,{isOpen:r,onClose:()=>b(!1),title:"Edit Lead",children:h&&e.jsx(le,{lead:h,onClose:()=>b(!1),onUpdate:k})}),e.jsx(w,{isOpen:n,onClose:()=>_(!1),title:"Add Lead",children:e.jsx(me,{onClose:()=>_(!1),onSuccess:a})}),e.jsx(w,{isOpen:i,onClose:()=>S(!1),title:"Lead Details",children:h&&e.jsx(ge,{lead:h,onClose:()=>S(!1)})})]})},$e=()=>e.jsx("div",{children:e.jsx(ye,{})});export{$e as default};

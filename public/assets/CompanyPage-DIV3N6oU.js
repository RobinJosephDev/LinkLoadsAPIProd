import{r as v,b as O,S as $,j as e,U as re}from"./index-CShLHsUt.js";import{z as x,o as te,d as le,s as w,R as P,a as Z,b as oe,T as ie,P as ce,M as L}from"./Pagination-2Q04ZmxJ.js";import F from"./purify.es-Ci5xwkH_.js";import{u as K}from"./useGoogleAutocomplete-C2ALqIRo.js";/* empty css             */import{o as de,R as me}from"./EyeOutlined-B28M-sP9.js";import{R as pe}from"./MailOutlined-O_E7qy0n.js";const Q="http://127.0.0.1:8000/api",he=()=>{const[a,f]=v.useState([]),[c,s]=v.useState(!0),[p,n]=v.useState(""),[u,o]=v.useState("created_at"),[i,h]=v.useState(!0),[r,t]=v.useState(1),[g,j]=v.useState(null),[C,_]=v.useState(!1),[l,d]=v.useState(!1),[m,y]=v.useState([]),[b,E]=v.useState(!1),[I,z]=v.useState(!1),[R,Y]=v.useState(10),[U,q]=v.useState({subject:"",content:""}),B=async()=>{try{const N=localStorage.getItem("token");if(!N)throw new Error("No token found");s(!0);const{data:A}=await O.get(`${Q}/company`,{headers:{Authorization:`Bearer ${N}`}});f(A)}catch(N){console.error("Error loading companies:",N),M(N)}finally{s(!1)}};v.useEffect(()=>{B()},[]);const M=N=>{var A;((A=N.response)==null?void 0:A.status)===401&&$.fire({icon:"error",title:"Unauthorized",text:"You need to log in to access this resource."})},D=a.filter(N=>Object.values(N).some(A=>A&&A.toString().toLowerCase().includes(p.toLowerCase()))),V=D.sort((N,A)=>{let S=N[u]??"",T=A[u]??"";return typeof S=="string"&&typeof T=="string"?i?T.localeCompare(S):S.localeCompare(T):typeof S=="number"&&typeof T=="number"?i?T-S:S-T:0}).slice((r-1)*R,r*R),ne=Math.ceil(D.length/R);return{fetchCompanies:B,companies:a,loading:c,searchQuery:p,setSearchQuery:n,sortBy:u,sortDesc:i,selectedCompanies:m,setSelectedCompanies:y,paginatedData:V,totalPages:ne,currentPage:r,setCurrentPage:t,isEditModalOpen:C,isAddModalOpen:l,isViewModalOpen:b,isEmailModalOpen:I,selectedCompany:g,setEditModalOpen:_,setAddModalOpen:d,setViewModalOpen:E,setEmailModalOpen:z,toggleSelectAll:()=>{m.length===V.length?y([]):y(V.map(N=>N.id).filter(N=>N!==void 0))},toggleSelect:N=>{y(A=>A.includes(N)?A.filter(S=>S!==N):[...A,N])},deleteSelected:async()=>{if(!m.length){$.fire({icon:"warning",title:"No record selected",text:"Please select a record to delete."});return}if((await $.fire({title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete selected!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const A=localStorage.getItem("token");if(!A)throw new Error("No token found");await Promise.all(m.map(S=>O.delete(`${Q}/company/${S}`,{headers:{Authorization:`Bearer ${A}`}}))),f(S=>S.filter(T=>!m.includes(T.id))),y([]),$.fire("The selected companies have been deleted.","success")}catch(A){console.error("Error deleting companies:",A),$.fire({icon:"error",title:"Error!",text:"Failed to delete selected companies."})}},openEditModal:N=>{j(N),_(!0)},emailData:U,setEmailData:q,sendEmails:async()=>{if(m.length===0){$.fire({icon:"warning",title:"No companies selected",text:"Please select companies to send emails to."});return}try{const N=localStorage.getItem("token");if(!N)throw new Error("No token found");await O.post(`${Q}/email`,{ids:m,...U,module:"carriers"},{headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"}}),$.fire("Success!","Emails have been sent.","success"),z(!1),y([])}catch(N){console.error("Error sending emails:",N),$.fire("Error!","Failed to send emails.","error")}},openViewModal:N=>{j(N),E(!0)},handleSort:N=>{u===N?h(!i):(o(N),h(!1))},updateCompany:N=>{f(A=>A.map(S=>S.id===N.id?{...S,...N}:S))},handlePageChange:N=>{t(N)}}},W="http://127.0.0.1:8000/api",xe=(a,f,c)=>{const[s,p]=v.useState({id:0,name:"",invoice_terms:"",rate_conf_terms:"",quote_terms:"",invoice_reminder:"",address:"",city:"",state:"",country:"",postal:"",email:"",phone:"",cell:"",fax:"",invoice_prefix:"",SCAC:"",docket_no:"",carrier_code:"",gst_hst_no:"",qst_no:"",ca_bond_no:"",website:"",obsolete:!1,us_tax_id:"",payroll_no:"",wcb_no:"",dispatch_email:"",ap_email:"",ar_email:"",cust_comm_email:"",quot_email:"",bank_info:[],cargo_insurance:[],liablility_insurance:[],company_package:"",insurance:"",created_at:"",updated_at:""});v.useEffect(()=>{if(a){const l=Array.isArray(a.bank_info)?a.bank_info:JSON.parse(a.bank_info||"[]"),d=Array.isArray(a.cargo_insurance)?a.cargo_insurance:JSON.parse(a.cargo_insurance||"[]"),m=Array.isArray(a.liablility_insurance)?a.liablility_insurance:JSON.parse(a.liablility_insurance||"[]"),y={...a,bank_info:l.length>0?l:[],cargo_insurance:d.length>0?d:[],liablility_insurance:m.length>0?m:[]};p(y)}},[a]);const n=()=>!!s.name;return{formCompany:s,setFormCompany:p,updateCompany:async()=>{if(!n()){$.fire("Validation Error","Please fill in all required fields.","error");return}try{const l=localStorage.getItem("token");if(!l){$.fire({icon:"error",title:"Unauthorized",text:"You are not logged in. Please log in again."});return}const d={Authorization:`Bearer ${l}`},m=new FormData;Object.keys(s).forEach(b=>{const E=s[b];b==="obsolete"?m.append(b,E?"1":"0"):b!=="company_package"&&b!=="insurance"&&m.append(b,String(E||""))}),s.company_package&&s.company_package instanceof File&&m.append("company_package",s.company_package),s.insurance&&s.insurance instanceof File&&m.append("insurance",s.insurance);const y=s.id?await O.put(`${W}/company/${s.id}`,s,{headers:d}):await O.post(`${W}/company`,s,{headers:d});$.fire(s.id?"Success!":"Saved!","Company updated successfully.","success"),c(y.data),f()}catch(l){console.error("Error saving/updating company:",l.response?l.response.data:l.message),$.fire("Error","An error occurred while processing the company.","error")}},handleAddBank:()=>{p(l=>l&&{...l,bank_info:[...l.bank_info,{name:"",phone:"",email:"",address:"",us_account_no:"",cdn_account_no:""}]})},handleRemoveBank:l=>{p(d=>d&&{...d,bank_info:d.bank_info.filter((m,y)=>y!==l)})},handleBankChange:(l,d)=>{p(m=>m&&{...m,bank_info:m.bank_info.map((y,b)=>b===l?d:y)})},handleAddCargo:()=>{p(l=>({...l,cargo_insurance:[...l.cargo_insurance,{company:"",policy_start:"",policy_end:"",amount:""}]}))},handleRemoveCargo:l=>{p(d=>({...d,cargo_insurance:d.cargo_insurance.filter((m,y)=>y!==l)}))},handleCargoChange:(l,d)=>{const m=s.cargo_insurance.map((y,b)=>b===l?d:y);p(y=>({...y,cargo_insurance:m}))},handleAddLiability:()=>{p(l=>({...l,liablility_insurance:[...l.liablility_insurance,{company:"",policy_start:"",policy_end:"",amount:""}]}))},handleRemoveLiability:l=>{p(d=>({...d,liablility_insurance:d.liablility_insurance.filter((m,y)=>y!==l)}))},handleLiabilityChange:(l,d)=>{const m=s.liablility_insurance.map((y,b)=>b===l?d:y);p(y=>({...y,liablility_insurance:m}))}}},ue=x.object({name:x.string().min(1,"Name is required").max(100,"Name cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed"),invoice_terms:x.string().max(100,"Invoice Terms cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),rate_conf_terms:x.string().max(100,"Rate Conf terms cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),quote_terms:x.string().max(100,"Quote Terms cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),invoice_reminder:x.string().max(100,"Inovice Reminder cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional()}),ge=[{key:"name",label:"Name",placeholder:"Enter Name",type:"text",required:!0},{key:"invoice_terms",label:"Invoice Terms",placeholder:"Enter Invoice Terms",type:"textarea",required:!0},{key:"rate_conf_terms",label:"Rate Conf terms",placeholder:"Enter Rate Conf terms",type:"textarea"},{key:"quote_terms",label:"Quote Terms",placeholder:"Enter Quote Terms",type:"textarea"},{key:"invoice_reminder",label:"Inovice Reminder",placeholder:"Enter Inovice Reminder",type:"textarea"}],fe=({formCompany:a,setFormCompany:f})=>{const[c,s]=v.useState({}),p=(n,u)=>{let o=F.sanitize(u),i="";const h={...a,[n]:o},r=ue.safeParse(h);if(!r.success){const t=r.error.errors.find(g=>g.path[0]===n);i=t?t.message:""}s(t=>({...t,[n]:i})),f(h)};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"General"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:ge.map(({key:n,label:u,placeholder:o,type:i,required:h})=>e.jsx("div",{children:e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:n,children:[u," ",h&&e.jsx("span",{style:{color:"red"},children:"*"})]}),i==="textarea"?e.jsx("textarea",{id:n,placeholder:o,value:String(a[n]||""),onChange:r=>p(n,r.target.value),rows:4,style:{width:"100%"}}):e.jsx("input",{type:"text",id:n,placeholder:o,value:String(a[n]||""),onChange:r=>p(n,r.target.value)}),c[n]&&e.jsx("span",{className:"error",style:{color:"red"},children:c[n]})]},n)},n))})]})},G=te({address:w().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),city:w().max(200,"City name is too long").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),state:w().max(200,"Invalid state").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),country:w().max(100,"Invalid country").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),postal:w().max(20,"Postal code cannot exceed 20 characters").regex(/^[a-zA-Z0-9-\s ]*$/,"Invalid postal code").optional(),phone:w().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),cell:w().max(30,"Cell number cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),fax:w().max(20,"Fax exceed 20 characters").regex(/^[0-9-+()\s]*$/,"Invalid fax format").optional(),invoice_prefix:w().max(10,"Invoice Prefix cannot exceed 10 characters").regex(/^[a-zA-Z0-9-_]*$/,"Only letters, numbers, hyphens, and underscores allowed").optional(),SCAC:w().max(10,"SCAC cannot exceed 10 characters").regex(/^[A-Z0-9-]*$/,"Only uppercase letters, numbers, and dashes allowed").optional(),docket_no:w().max(20,"Docket number cannot exceed 20 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),carrier_code:w().max(30,"Carrier Code cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),gst_hst_no:w().max(30,"GST/HST Number cannot exceed 30 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),qst_no:w().max(30,"QST Number cannot exceed 30 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),ca_bond_no:w().max(30,"CA Bond Number cannot exceed 30 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),website:w().url("Invalid website URL").max(100,"Website URL is too long").optional(),obsolete:le().optional()});function ye({formCompany:a,setFormCompany:f}){const[c,s]=v.useState({});K(o=>{const i=h=>{var r,t;return((t=(r=o.address_components)==null?void 0:r.find(g=>g.types.includes(h)))==null?void 0:t.long_name)||""};f(h=>({...h,address:`${i("street_number")} ${i("route")}`.trim(),city:i("locality"),state:i("administrative_area_level_1"),country:i("country"),postal:i("postal_code")}))});const n=(o,i)=>{let h=typeof i=="boolean"?i:F.sanitize(i),r="";const t={...a,[o]:h};if(o in G.shape){const g=G.safeParse(t);if(!g.success){const j=g.error.errors.find(C=>C.path[0]===o);r=j?j.message:""}}s(g=>({...g,[o]:r})),f(t)},u=[{label:"Street",key:"address",placeholder:"Enter Address",required:!0},{label:"City",key:"city",placeholder:"Enter City"},{label:"State",key:"state",placeholder:"Enter State"},{label:"Country",key:"country",placeholder:"Enter Country"},{label:"Postal Code",key:"postal",placeholder:"Enter postal code"},{label:"Phone",key:"phone",placeholder:"Enter phone number"},{label:"Cell",key:"cell",placeholder:"Enter Cell"},{label:"Fax",key:"fax",placeholder:"Enter Fax"},{label:"Invoice Prefix",key:"invoice_prefix",placeholder:"Enter Invoice Prefix"},{label:"SCAC",key:"SCAC",placeholder:"Enter SCAC"},{label:"Docket#",key:"docket_no",placeholder:"Enter Docket Number"},{label:"Carrier Code",key:"carrier_code",placeholder:"Enter Carrier Code"},{label:"GST/HST#",key:"gst_hst_no",placeholder:"Enter GST/HST Number"},{label:"QST#",key:"qst_no",placeholder:"Enter QST Number"},{label:"CA Bond#",key:"ca_bond_no",placeholder:"Enter CA Bond Number"},{label:"Website",key:"website",placeholder:"Enter Website"},{key:"obsolete",label:"Obsolete",type:"boolean"}];return e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Address"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:u.map(({key:o,label:i,placeholder:h,type:r,required:t})=>e.jsx("div",{children:e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[r==="boolean"?e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",id:o,checked:!!a[o],onChange:g=>n(o,g.target.checked),style:{transform:"scale(1.1)",cursor:"pointer",margin:0}}),e.jsx("label",{htmlFor:o,style:{margin:0,whiteSpace:"nowrap"},children:i})]}):e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:o,children:[i," ",t&&e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsx("input",{type:"text",id:o,placeholder:h,value:String(a[o]||""),onChange:g=>n(o,g.target.value)})]}),c[o]&&e.jsx("span",{className:"error",style:{color:"red"},children:c[o]})]},o)},o))})]})}const be=x.object({us_tax_id:x.string().max(20,"US Tax id cannot exceed 20 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),payroll_no:x.string().max(20,"Payroll Number cannot exceed 20 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),wcb_no:x.string().max(50,"WCB# must be at most 50 characters").regex(/^\d*$/,"WCB# must be numeric").optional(),dispatch_email:x.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),ap_email:x.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),ar_email:x.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),cust_comm_email:x.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),quot_email:x.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional()});function je({formCompany:a,setFormCompany:f}){const[c,s]=v.useState({}),p=(u,o)=>{let i=typeof o=="boolean"?o:F.sanitize(o),h="";const r={...a,[u]:i},t=be.safeParse(r);if(!t.success){const g=t.error.errors.find(j=>j.path[0]===u);h=g?g.message:""}s(g=>({...g,[u]:h})),f(r)},n=[{key:"us_tax_id",label:"US Tax id",placeholder:"Enter US Tax id",type:"text"},{key:"payroll_no",label:"Payroll#",placeholder:"Enter Payroll Number",type:"text"},{key:"wcb_no",label:"WCB#",placeholder:"Enter WCB Number",type:"text"},{key:"dispatch_email",label:"Dispatch Email",placeholder:"Enter Dispatch Email",type:"text"},{key:"ap_email",label:"Account Payable Email",placeholder:"Enter Payable Email",type:"text"},{key:"ar_email",label:"Account Receivable email",placeholder:"Enter Receivable Email",type:"text"},{key:"cust_comm_email",label:"Customer Communication Email",placeholder:"Enter Customer Communication Email",type:"text"},{key:"quot_email",label:"Quotation Email",placeholder:"Enter Quotation Email",type:"text"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Other Info"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:n.map(({key:u,label:o,placeholder:i})=>e.jsx("div",{children:e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsx("label",{htmlFor:u,children:o}),e.jsx("input",{type:"text",id:u,placeholder:i,value:String(a[u]||""),onChange:h=>p(u,h.target.value)}),c[u]&&e.jsx("span",{className:"error",style:{color:"red"},children:c[u]})]},u)},u))})]})}const _e=x.object({name:x.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]+$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),phone:x.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),email:x.string().max(255,"Email must be at most 255 characters").email("Invalid email format").optional(),address:x.string().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),us_account_no:x.string().max(100,"US Account# must be at most 100 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods,commas and hyphens allowed").optional(),cdn_account_no:x.string().max(100,"CAN Account# must be at most 100 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods,commas and hyphens allowed").optional()}),ee=({bank_info:a,index:f,handleBankChange:c,handleRemoveBank:s,onAddBank:p})=>{const n=a[f]??{},[u,o]=v.useState({}),i=v.useCallback((r,t)=>{const g=F.sanitize(t);let j="";const C={...n,[r]:g},_=_e.safeParse(C);if(!_.success){const l=_.error.errors.find(d=>d.path[0]===r);j=l?l.message:""}o(l=>({...l,[r]:j})),c(f,C)},[n,c,f]),h=[{label:"Name",key:"name",type:"text",placeholder:"Enter Name"},{label:"Phone",key:"phone",type:"tel",placeholder:"Enter Phone"},{label:"Email",key:"email",type:"email",placeholder:"Enter Email"},{label:"Address",key:"address",type:"text",placeholder:"Enter Address"},{label:"US Account#",key:"us_account_no",type:"text",placeholder:"Enter US Account#"},{label:"CAN Account#",key:"cdn_account_no",type:"text",placeholder:"Enter CAN Account#"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"10px",gridTemplateColumns:"repeat(5, 1fr)",flex:1},children:h.map(({label:r,key:t,type:g,placeholder:j})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${t}-${f}`,children:r}),e.jsx("input",{id:`${t}-${f}`,type:g,name:t,value:n[t]||"",onChange:C=>i(t,C.target.value),placeholder:j}),u[t]&&e.jsx("span",{className:"error",style:{color:"red"},children:u[t]})]},t))}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:p,className:"add-button",children:e.jsx(P,{})}),e.jsx("button",{type:"button",onClick:()=>s(f),className:"delete-button",children:e.jsx(Z,{})})]})]})},H=a=>new Date(a),Ne=x.object({company:x.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]*$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),policy_start:x.string().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"Start date must be in YYYY-MM-DD format"}).optional(),policy_end:x.string().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"End date must be in YYYY-MM-DD format"}).optional(),amount:x.string().regex(/^\d+(\.\d{1,2})?$/,"Enter a valid amount (e.g., 5.00)").optional()}).refine(a=>!a.policy_start||!a.policy_end||H(a.policy_start)<=H(a.policy_end),{message:"End date must be after or equal to start date",path:["policy_end"]}),ae=({cargo_insurance:a,index:f,handleCargoChange:c,handleRemoveCargo:s,onAddCargo:p})=>{const n=a[f]??{},[u,o]=v.useState({}),i=v.useCallback((r,t)=>{const g=F.sanitize(t);let j="";const C={...n,[r]:g},_=Ne.safeParse(C);if(!_.success){const l=_.error.errors.find(d=>d.path[0]===r);j=l?l.message:""}o(l=>({...l,[r]:j})),c(f,C)},[n,c,f]),h=[{label:"Company",key:"company",type:"text",placeholder:"Enter Company Name"},{label:"Policy Start",key:"policy_start",type:"date"},{label:"Policy End",key:"policy_end",type:"date"},{label:"Amount",key:"amount",type:"text",placeholder:"Enter Amount"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"10px",gridTemplateColumns:"repeat(5, 1fr)",flex:1},children:h.map(({label:r,key:t,type:g,placeholder:j})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${t}-${f}`,children:r}),e.jsx("input",{id:`${t}-${f}`,type:g,name:t,value:n[t]||"",onChange:C=>i(t,C.target.value),placeholder:j}),u[t]&&e.jsx("span",{className:"error",style:{color:"red"},children:u[t]})]},t))}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:p,className:"add-button",children:e.jsx(P,{})}),e.jsx("button",{type:"button",onClick:()=>s(f),className:"delete-button",children:e.jsx(Z,{})})]})]})},J=a=>new Date(a),ve=x.object({company:x.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]*$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),policy_start:x.string().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"Start date must be in YYYY-MM-DD format"}).optional(),policy_end:x.string().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"End date must be in YYYY-MM-DD format"}).optional(),amount:x.string().regex(/^\d+(\.\d{1,2})?$/,"Enter a valid amount (e.g., 5.00)").optional()}).refine(a=>!a.policy_start||!a.policy_end||J(a.policy_start)<=J(a.policy_end),{message:"End date must be after or equal to start date",path:["policy_end"]}),se=({liablility_insurance:a,index:f,handleLiabilityChange:c,handleRemoveLiability:s,onAddLiability:p})=>{const n=a[f]??{},[u,o]=v.useState({}),i=v.useCallback((r,t)=>{const g=F.sanitize(t);let j="";const C={...n,[r]:g},_=ve.safeParse(C);if(!_.success){const l=_.error.errors.find(d=>d.path[0]===r);j=l?l.message:""}o(l=>({...l,[r]:j})),c(f,C)},[n,c,f]),h=[{label:"Company",key:"company",type:"text",placeholder:"Enter Company Name"},{label:"Policy Start",key:"policy_start",type:"date"},{label:"Policy End",key:"policy_end",type:"date"},{label:"Amount",key:"amount",type:"text",placeholder:"Enter Amount"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"10px",gridTemplateColumns:"repeat(5, 1fr)",flex:1},children:h.map(({label:r,key:t,type:g,placeholder:j})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${t}-${f}`,children:r}),e.jsx("input",{id:`${t}-${f}`,type:g,name:t,value:n[t]||"",onChange:C=>i(t,C.target.value),placeholder:j}),u[t]&&e.jsx("span",{className:"error",style:{color:"red"},children:u[t]})]},t))}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:p,className:"add-button",children:e.jsx(P,{})}),e.jsx("button",{type:"button",onClick:()=>s(f),className:"delete-button",children:e.jsx(Z,{})})]})]})},Ce=({formCompany:a,setFormCompany:f})=>{const[c,s]=v.useState({}),[p,n]=v.useState({}),u="http://127.0.0.1:8000/api".trim()||"http://127.0.0.1:8000/api",o=10*1024*1024,i=async(h,r)=>{var C,_;const t=(C=h.target.files)==null?void 0:C[0];if(!t)return;if(t.size>o){s(l=>({...l,[r]:"File size exceeds 10MB limit."}));return}s(l=>({...l,[r]:""})),n(l=>({...l,[r]:!0}));const g=new FormData;g.append(r,t);const j=localStorage.getItem("token");try{const d=await(await fetch(`${u}/upload`,{method:"POST",headers:{Authorization:`Bearer ${j}`},body:g})).json();console.log(`Upload response for ${r}:`,d);const m=(_=d.files)==null?void 0:_[r];if(m!=null&&m.fileUrl){const y=u.replace("/api",""),b=m.fileUrl.startsWith("http")?m.fileUrl:`${y}${m.fileUrl}`;f(E=>({...E,[r]:b,[`${r}_name`]:m.fileName}))}else console.error("Missing fileUrl in response:",d),s(y=>({...y,[r]:"File upload failed: Missing URL in response."}))}catch(l){console.error(`Error uploading ${r}:`,l),s(d=>({...d,[r]:"Network error during file upload."}))}finally{n(l=>({...l,[r]:!1}))}};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Uploaded Documents"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"company_package",children:"Company Package"}),e.jsx("input",{id:"company_package",type:"file",onChange:h=>i(h,"company_package")}),typeof a.company_package=="string"&&a.company_package&&e.jsx("div",{children:e.jsx("a",{href:a.company_package,target:"_blank",rel:"noopener noreferrer",children:"Download Company Package"})}),p.company_package&&e.jsx("p",{children:"Uploading..."}),c.company_package&&e.jsx("p",{className:"error",children:c.company_package})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"insurance",children:"Insurance"}),e.jsx("input",{id:"insurance",type:"file",onChange:h=>i(h,"insurance")}),typeof a.insurance=="string"&&a.insurance&&e.jsx("div",{children:e.jsx("a",{href:a.insurance,target:"_blank",rel:"noopener noreferrer",children:"Download Insurance"})}),p.insurance&&e.jsx("p",{children:"Uploading..."}),c.insurance&&e.jsx("p",{className:"error",children:c.insurance})]})]})]})},Ae=({company:a,onClose:f,onUpdate:c})=>{const{formCompany:s,setFormCompany:p,updateCompany:n,handleAddBank:u,handleRemoveBank:o,handleBankChange:i,handleAddCargo:h,handleRemoveCargo:r,handleCargoChange:t,handleAddLiability:g,handleRemoveLiability:j,handleLiabilityChange:C}=xe(a,f,c);return console.log("Form company:",s),e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:_=>{_.preventDefault(),n()},className:"form-main",children:[s&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{formCompany:s,setFormCompany:p}),e.jsx(ye,{formCompany:s,setFormCompany:p}),e.jsx(je,{formCompany:s,setFormCompany:p}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Banking Info"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",children:[s.bank_info.map((_,l)=>e.jsx(ee,{bank_info:s.bank_info,index:l,onAddBank:u,handleRemoveBank:o,handleBankChange:i},l)),s.bank_info.length===0&&e.jsx("button",{type:"button",onClick:u,className:"add-button",children:e.jsx(P,{})})]})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Cargo Insurance"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",children:[s.cargo_insurance.map((_,l)=>e.jsx(ae,{cargo_insurance:s.cargo_insurance,index:l,onAddCargo:h,handleRemoveCargo:r,handleCargoChange:t},l)),s.cargo_insurance.length===0&&e.jsx("button",{type:"button",onClick:h,className:"add-button",children:e.jsx(P,{})})]})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Liability Insurance"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",children:[s.liablility_insurance.map((_,l)=>e.jsx(se,{liablility_insurance:s.liablility_insurance,index:l,onAddLiability:g,handleRemoveLiability:j,handleLiabilityChange:C},l)),s.liablility_insurance.length===0&&e.jsx("button",{type:"button",onClick:g,className:"add-button",children:e.jsx(P,{})})]})]})]}),e.jsx(Ce,{formCompany:s,setFormCompany:p}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Save"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:f,children:"Cancel"})]})]})})},Ee=x.object({name:x.string().min(1,"Name is required").max(100,"Name cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed"),invoice_terms:x.string().max(500,"Invoice Terms cannot exceed 500 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),rate_conf_terms:x.string().max(500,"Rate Conf terms cannot exceed 500 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),quote_terms:x.string().max(500,"Quote Terms cannot exceed 500 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),invoice_reminder:x.string().max(200,"Inovice Reminder cannot exceed 200 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional()}),ke=[{key:"name",label:"Name",placeholder:"Enter Name",type:"text",required:!0},{key:"invoice_terms",label:"Invoice Terms",placeholder:"Enter Invoice Terms",type:"textarea",required:!0},{key:"rate_conf_terms",label:"Rate Conf terms",placeholder:"Enter Rate Conf terms",type:"textarea"},{key:"quote_terms",label:"Quote Terms",placeholder:"Enter Quote Terms",type:"textarea"},{key:"invoice_reminder",label:"Inovice Reminder",placeholder:"Enter Inovice Reminder",type:"textarea"}],Se=({company:a,setCompany:f})=>{const[c,s]=v.useState({}),p=(n,u)=>{let o=F.sanitize(u),i="";const h={...a,[n]:o},r=Ee.safeParse(h);if(!r.success){const t=r.error.errors.find(g=>g.path[0]===n);i=t?t.message:""}s(t=>({...t,[n]:i})),f(h)};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"General"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:ke.map(({key:n,label:u,placeholder:o,type:i,required:h})=>e.jsx("div",{children:e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:n,children:[u," ",h&&e.jsx("span",{style:{color:"red"},children:"*"})]}),i==="textarea"?e.jsx("textarea",{id:n,placeholder:o,value:String(a[n]||""),onChange:r=>p(n,r.target.value),rows:4,style:{width:"100%"}}):e.jsx("input",{type:"text",id:n,placeholder:o,value:String(a[n]||""),onChange:r=>p(n,r.target.value)}),c[n]&&e.jsx("span",{className:"error",style:{color:"red"},children:c[n]})]},n)},n))})]})},we=x.object({address:x.string().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),city:x.string().max(200,"City name is too long").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),state:x.string().max(200,"Invalid state").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),country:x.string().max(100,"Invalid country").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),postal:x.string().max(20,"Postal code cannot exceed 20 characters").regex(/^[a-zA-Z0-9-\s ]*$/,"Invalid postal code").optional(),phone:x.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),cell:x.string().max(30,"Cell number cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),fax:x.string().max(20,"Fax exceed 20 characters").regex(/^[0-9-+()\s]*$/,"Invalid fax format").optional(),invoice_prefix:x.string().max(10,"Invoice Prefix cannot exceed 10 characters").regex(/^[a-zA-Z0-9-_]*$/,"Only letters, numbers, hyphens, and underscores allowed").optional(),SCAC:x.string().max(10,"SCAC cannot exceed 10 characters").regex(/^[A-Z0-9-]*$/,"Only uppercase letters, numbers, and dashes allowed").optional(),docket_no:x.string().max(20,"Docket number cannot exceed 20 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),carrier_code:x.string().max(30,"Carrier Code cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid format").optional(),gst_hst_no:x.string().max(30,"GST/HST Number cannot exceed 30 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),qst_no:x.string().max(30,"QST Number cannot exceed 30 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),ca_bond_no:x.string().max(30,"CA Bond Number cannot exceed 30 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),website:x.string().url("Invalid website URL").max(100,"Website URL is too long").optional(),obsolete:x.boolean().optional()}),$e=({company:a,setCompany:f})=>{const[c,s]=v.useState({});K(o=>{const i=h=>{var r,t;return((t=(r=o.address_components)==null?void 0:r.find(g=>g.types.includes(h)))==null?void 0:t.long_name)||""};f(h=>({...h,address:`${i("street_number")} ${i("route")}`.trim(),city:i("locality"),state:i("administrative_area_level_1"),country:i("country"),postal:i("postal_code")}))});const n=(o,i)=>{let h=i;["obsolete"].includes(o)&&typeof i!="boolean"?h=i==="true":typeof i!="boolean"&&(h=F.sanitize(i));let r="";const t={...a,[o]:h},g=we.safeParse(t);if(!g.success){const j=g.error.errors.find(C=>C.path[0]===o);r=j?j.message:""}s(j=>({...j,[o]:r})),f(t)},u=[{label:"Street",key:"address",placeholder:"Enter Address",required:!0},{label:"City",key:"city",placeholder:"Enter City"},{label:"State",key:"state",placeholder:"Enter State"},{label:"Country",key:"country",placeholder:"Enter Country"},{label:"Postal Code",key:"postal",placeholder:"Enter postal code"},{label:"Phone",key:"phone",placeholder:"Enter phone number"},{label:"Cell",key:"cell",placeholder:"Enter Cell"},{label:"Fax",key:"fax",placeholder:"Enter Fax"},{label:"Invoice Prefix",key:"invoice_prefix",placeholder:"Enter Invoice Prefix"},{label:"SCAC",key:"SCAC",placeholder:"Enter SCAC"},{label:"Docket#",key:"docket_no",placeholder:"Enter Docket Number"},{label:"Carrier Code",key:"carrier_code",placeholder:"Enter Carrier Code"},{label:"GST/HST#",key:"gst_hst_no",placeholder:"Enter GST/HST Number"},{label:"QST#",key:"qst_no",placeholder:"Enter QST Number"},{label:"CA Bond#",key:"ca_bond_no",placeholder:"Enter CA Bond Number"},{label:"Website",key:"website",placeholder:"Enter Website"},{label:"Obsolete",key:"obsolete",type:"boolean"}];return e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Address"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:u.map(({key:o,label:i,placeholder:h,type:r,required:t})=>e.jsx("div",{children:e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[r==="boolean"?e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",id:o,checked:!!a[o],onChange:g=>n(o,g.target.checked),style:{transform:"scale(1.1)",cursor:"pointer",margin:0}}),e.jsx("label",{htmlFor:o,style:{margin:0,whiteSpace:"nowrap"},children:i})]}):e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:o,children:[i," ",t&&e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsx("input",{type:"text",id:o,placeholder:h,value:String(a[o]||""),onChange:g=>n(o,g.target.value)})]}),c[o]&&e.jsx("span",{className:"error",style:{color:"red"},children:c[o]})]},o)},o))})]})},Ie=x.object({us_tax_id:x.string().max(20,"US Tax id cannot exceed 20 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),payroll_no:x.string().max(20,"Payroll Number cannot exceed 20 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),wcb_no:x.string().max(50,"WCB# must be at most 50 characters").regex(/^\d*$/,"WCB# must be numeric").optional(),dispatch_email:x.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),ap_email:x.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),ar_email:x.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),cust_comm_email:x.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),quot_email:x.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional()}),Pe=[{key:"us_tax_id",label:"US Tax id",placeholder:"Enter US Tax id",type:"text"},{key:"payroll_no",label:"Payroll#",placeholder:"Enter Payroll Number",type:"text"},{key:"wcb_no",label:"WCB#",placeholder:"Enter WCB Number",type:"text"},{key:"dispatch_email",label:"Dispatch Email",placeholder:"Enter Dispatch Email",type:"text"},{key:"ap_email",label:"Account Payable Email",placeholder:"Enter Payable Email",type:"text"},{key:"ar_email",label:"Account Receivable email",placeholder:"Enter Receivable Email",type:"text"},{key:"cust_comm_email",label:"Customer Communication Email",placeholder:"Enter Customer Communication Email",type:"text"},{key:"quot_email",label:"Quotation Email",placeholder:"Enter Quotation Email",type:"text"}],Fe=({company:a,setCompany:f})=>{const[c,s]=v.useState({}),p=(n,u)=>{let o=F.sanitize(u),i="";const h={...a,[n]:o},r=Ie.safeParse(h);if(!r.success){const t=r.error.errors.find(g=>g.path[0]===n);i=t?t.message:""}s(t=>({...t,[n]:i})),f(h)};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Other Info"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:Pe.map(({key:n,label:u,placeholder:o})=>e.jsx("div",{children:e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsx("label",{htmlFor:n,children:u}),e.jsx("input",{type:"text",id:n,placeholder:o,value:String(a[n]||""),onChange:i=>p(n,i.target.value)}),c[n]&&e.jsx("span",{className:"error",style:{color:"red"},children:c[n]})]},n)},n))})]})},X="http://127.0.0.1:8000/api",Te=(a,f)=>{const c={id:0,name:"",invoice_terms:"",rate_conf_terms:"",quote_terms:"",invoice_reminder:"",address:"",city:"",state:"",country:"",postal:"",email:"",phone:"",cell:"",fax:"",invoice_prefix:"",SCAC:"",docket_no:"",carrier_code:"",gst_hst_no:"",qst_no:"",ca_bond_no:"",website:"",obsolete:!1,us_tax_id:"",payroll_no:"",wcb_no:"",dispatch_email:"",ap_email:"",ar_email:"",cust_comm_email:"",quot_email:"",bank_info:[],cargo_insurance:[],liablility_insurance:[],company_package:"",insurance:"",created_at:"",updated_at:""},[s,p]=v.useState(c),n=()=>!!s.name,u=async d=>{if(d.preventDefault(),!n()){$.fire("Validation Error","Please fill in all required fields.","error");return}try{const m=localStorage.getItem("token");if(!m){$.fire("Error","No token found","error");return}const y={Authorization:`Bearer ${m}`},b=new FormData;Object.keys(s).forEach(I=>{const z=s[I];I==="obsolete"?b.append(I,z?"1":"0"):I!=="company_package"&&I!=="insurance"&&b.append(I,String(z||""))}),s.company_package&&s.company_package instanceof File&&b.append("company_package",s.company_package),s.insurance&&s.insurance instanceof File&&b.append("insurance",s.insurance);const E=s.id?await O.put(`${X}/company/${s.id}`,s,{headers:y}):await O.post(`${X}/company`,s,{headers:y});$.fire(s.id?"Success!":"Saved!","Company added successfully.","success"),o(),f()}catch(m){console.error("Error saving/updating company:",m.response?m.response.data:m.message),$.fire("Error","An error occurred while processing the company.","error")}},o=()=>{p({id:0,name:"",invoice_terms:"",rate_conf_terms:"",quote_terms:"",invoice_reminder:"",address:"",city:"",state:"",country:"",postal:"",email:"",phone:"",cell:"",fax:"",invoice_prefix:"",SCAC:"",docket_no:"",carrier_code:"",gst_hst_no:"",qst_no:"",ca_bond_no:"",website:"",obsolete:!1,us_tax_id:"",payroll_no:"",wcb_no:"",dispatch_email:"",ap_email:"",ar_email:"",cust_comm_email:"",quot_email:"",bank_info:[],cargo_insurance:[],liablility_insurance:[],company_package:"",insurance:"",created_at:"",updated_at:""})};return{company:s,setCompany:p,handleSubmit:u,handleAddBank:()=>{p(d=>({...d,bank_info:[...d.bank_info,{name:"",phone:"",email:"",address:"",us_account_no:"",cdn_account_no:""}]}))},handleRemoveBank:d=>{p(m=>({...m,bank_info:m.bank_info.filter((y,b)=>b!==d)}))},handleBankChange:(d,m)=>{const y=s.bank_info.map((b,E)=>E===d?m:b);p(b=>({...b,bank_info:y}))},handleAddCargo:()=>{p(d=>({...d,cargo_insurance:[...d.cargo_insurance,{company:"",policy_start:"",policy_end:"",amount:""}]}))},handleRemoveCargo:d=>{p(m=>({...m,cargo_insurance:m.cargo_insurance.filter((y,b)=>b!==d)}))},handleCargoChange:(d,m)=>{const y=s.cargo_insurance.map((b,E)=>E===d?m:b);p(b=>({...b,cargo_insurance:y}))},handleAddLiability:()=>{p(d=>({...d,liablility_insurance:[...d.liablility_insurance,{company:"",policy_start:"",policy_end:"",amount:""}]}))},handleRemoveLiability:d=>{p(m=>({...m,liablility_insurance:m.liablility_insurance.filter((y,b)=>b!==d)}))},handleLiabilityChange:(d,m)=>{const y=s.liablility_insurance.map((b,E)=>E===d?m:b);p(b=>({...b,liablility_insurance:y}))},clearCompanyForm:o}},ze=({company:a,setCompany:f})=>{const[c,s]=v.useState({}),[p,n]=v.useState({}),u="http://127.0.0.1:8000/api".trim()||"http://127.0.0.1:8000/api",o=10*1024*1024,i=async(h,r)=>{var C,_;const t=(C=h.target.files)==null?void 0:C[0];if(!t)return;if(t.size>o){s(l=>({...l,[r]:"File size exceeds 10MB limit."}));return}s(l=>({...l,[r]:""})),n(l=>({...l,[r]:!0}));const g=new FormData;g.append(r,t);const j=localStorage.getItem("token");try{const d=await(await fetch(`${u}/upload`,{method:"POST",headers:{Authorization:`Bearer ${j}`},body:g})).json();console.log(`Upload response for ${r}:`,d);const m=(_=d.files)==null?void 0:_[r];if(m!=null&&m.fileUrl){const y=u.replace("/api",""),b=m.fileUrl.startsWith("http")?m.fileUrl:`${y}${m.fileUrl}`;f(E=>({...E,[r]:b,[`${r}_name`]:m.fileName}))}else console.error("Missing fileUrl in response:",d),s(y=>({...y,[r]:"File upload failed: Missing URL in response."}))}catch(l){console.error(`Error uploading ${r}:`,l),s(d=>({...d,[r]:"Network error during file upload."}))}finally{n(l=>({...l,[r]:!1}))}};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Upload Documents"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"company_package",children:"Company Package"}),e.jsx("input",{id:"company_package",type:"file",onChange:h=>i(h,"company_package")}),typeof a.company_package=="string"&&a.company_package&&e.jsx("div",{children:e.jsx("a",{href:a.company_package,target:"_blank",rel:"noopener noreferrer",children:"Download Company Package"})}),p.company_package&&e.jsx("p",{children:"Uploading..."}),c.company_package&&e.jsx("p",{className:"error",children:c.company_package})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"insurance",children:"Insurance"}),e.jsx("input",{id:"insurance",type:"file",onChange:h=>i(h,"insurance")}),typeof a.insurance=="string"&&a.insurance&&e.jsx("div",{children:e.jsx("a",{href:a.insurance,target:"_blank",rel:"noopener noreferrer",children:"Download Insurance"})}),p.insurance&&e.jsx("p",{children:"Uploading..."}),c.insurance&&e.jsx("p",{className:"error",children:c.insurance})]})]})]})},Oe=({onClose:a,onSuccess:f})=>{const{company:c,setCompany:s,handleSubmit:p,handleAddBank:n,handleRemoveBank:u,handleBankChange:o,handleAddCargo:i,handleRemoveCargo:h,handleCargoChange:r,handleAddLiability:t,handleRemoveLiability:g,handleLiabilityChange:j}=Te(a,f);return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:p,className:"form-main",children:[e.jsx(Se,{company:c,setCompany:s}),e.jsx($e,{company:c,setCompany:s}),e.jsx(Fe,{company:c,setCompany:s}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Banking Info"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:c.bank_info.map((C,_)=>e.jsx(ee,{bank_info:c.bank_info,index:_,onAddBank:n,handleBankChange:o,handleRemoveBank:u},_))}),c.bank_info.length===0&&e.jsx("button",{type:"button",onClick:n,className:"add-button",children:e.jsx(P,{})})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Cargo Insurance"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:c.cargo_insurance.map((C,_)=>e.jsx(ae,{cargo_insurance:c.cargo_insurance,index:_,onAddCargo:i,handleCargoChange:r,handleRemoveCargo:h},_))}),c.cargo_insurance.length===0&&e.jsx("button",{type:"button",onClick:i,className:"add-button",children:e.jsx(P,{})})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Liability Insurance"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:c.liablility_insurance.map((C,_)=>e.jsx(se,{liablility_insurance:c.liablility_insurance,index:_,onAddLiability:t,handleLiabilityChange:j,handleRemoveLiability:g},_))}),c.liablility_insurance.length===0&&e.jsx("button",{type:"button",onClick:t,className:"add-button",children:e.jsx(P,{})})]}),e.jsx(ze,{company:c,setCompany:s}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit","data-testid":"submit-button",children:"Add Company"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:a,children:"Cancel"})]})]})})},Re=({formCompany:a})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"General"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("span",{children:a.name||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"invoiceTerms",children:"Invoice Terms"}),e.jsx("span",{children:a.invoice_terms||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"rateConfTerms",children:"Rate Conf terms"}),e.jsx("span",{children:a.rate_conf_terms||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"quoteTerms",children:"Quote Terms"}),e.jsx("span",{children:a.quote_terms||"N/A"})]})]}),e.jsx("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"inoviceReminder",children:"Inovice Reminder"}),e.jsx("span",{children:a.invoice_reminder||"N/A"})]})})]}),Ue=({formCompany:a})=>e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Address"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressStreet",children:"Street"}),e.jsx("span",{children:a.address||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressCity",children:"City"}),e.jsx("span",{children:a.city||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressState",children:"State"}),e.jsx("span",{children:a.state||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressCountry",children:"Country"}),e.jsx("span",{children:a.country||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressPostalCode",children:"Postal Code"}),e.jsx("span",{children:a.postal||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"Phone"}),e.jsx("span",{children:a.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressPostalCode",children:"Cell"}),e.jsx("span",{children:a.cell||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"Fax"}),e.jsx("span",{children:a.fax||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressPostalCode",children:"Invoice Prefix"}),e.jsx("span",{children:a.invoice_prefix||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"SCAC"}),e.jsx("span",{children:a.SCAC||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressPostalCode",children:"Docket#"}),e.jsx("span",{children:a.docket_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"Carrier Code"}),e.jsx("span",{children:a.carrier_code||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressPostalCode",children:"GST/HST#"}),e.jsx("span",{children:a.gst_hst_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"QST#"}),e.jsx("span",{children:a.qst_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressPostalCode",children:"CA Bond#"}),e.jsx("span",{children:a.ca_bond_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"Website"}),e.jsx("span",{children:a.website||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"Obsolete"}),e.jsx("span",{children:a.obsolete?"Yes":"No"})]})]})]}),Be=({formCompany:a})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Other Info"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"US Tax id"}),e.jsx("p",{children:a.us_tax_id||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Payroll#"}),e.jsx("p",{children:a.payroll_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"WCB#"}),e.jsx("p",{children:a.wcb_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Dispatch Email"}),e.jsx("p",{children:a.dispatch_email||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Account Payable Email"}),e.jsx("p",{children:a.ap_email||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Account Receivable email"}),e.jsx("p",{children:a.ar_email||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Customer Communication Email"}),e.jsx("p",{children:a.cust_comm_email||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Quotation Email"}),e.jsx("p",{children:a.quot_email||"N/A"})]})]})]}),De=({banking_info:a})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Name"}),e.jsx("span",{children:a.name||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Contact No"}),e.jsx("span",{children:a.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Email"}),e.jsx("span",{children:a.email||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Address"}),e.jsx("span",{children:a.address||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"US Account No."}),e.jsx("span",{children:a.us_account_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"CAN Account No."}),e.jsx("span",{children:a.cdn_account_no||"N/A"})]})]})]}),Le=({cargo_ins:a})=>e.jsx("fieldset",{className:"form-section",children:e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Company"}),e.jsx("span",{children:a.company||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Policy Start"}),e.jsx("span",{children:a.policy_start||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Policy End"}),e.jsx("span",{children:a.policy_end||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Amount"}),e.jsx("span",{children:a.amount||"N/A"})]})]})}),Ze=({liab_ins:a})=>e.jsx("fieldset",{className:"form-section",children:e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Company"}),e.jsx("span",{children:a.company||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Policy Start"}),e.jsx("span",{children:a.policy_start||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Policy End"}),e.jsx("span",{children:a.policy_end||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Amount"}),e.jsx("span",{children:a.amount||"N/A"})]})]})}),qe=({formCompany:a})=>{const f=(c,s)=>c?e.jsx("div",{children:e.jsxs("a",{href:c,target:"_blank",rel:"noopener noreferrer",children:["Download ",s]})}):null;return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Uploaded Documents"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Company Package"}),f(a.company_package,"Comapany Package")]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Insurance"}),f(a.insurance,"Insurance")]})]})]})},Me=({company:a,onClose:f})=>{v.useContext(re);const[c,s]=v.useState({id:0,name:"",invoice_terms:"",rate_conf_terms:"",quote_terms:"",invoice_reminder:"",address:"",city:"",state:"",country:"",postal:"",email:"",phone:"",cell:"",fax:"",invoice_prefix:"",SCAC:"",docket_no:"",carrier_code:"",gst_hst_no:"",qst_no:"",ca_bond_no:"",website:"",obsolete:!1,us_tax_id:"",payroll_no:"",wcb_no:"",dispatch_email:"",ap_email:"",ar_email:"",cust_comm_email:"",quot_email:"",bank_info:[],cargo_insurance:[],liablility_insurance:[],company_package:"",insurance:"",created_at:"",updated_at:""});return v.useEffect(()=>{a&&s({...a,bank_info:Array.isArray(a.bank_info)?a.bank_info:JSON.parse(a.bank_info||"[]"),cargo_insurance:Array.isArray(a.cargo_insurance)?a.cargo_insurance:JSON.parse(a.cargo_insurance||"[]"),liablility_insurance:Array.isArray(a.liablility_insurance)?a.liablility_insurance:JSON.parse(a.liablility_insurance||"[]")})},[a]),e.jsx("div",{className:"form-container",children:e.jsxs("form",{className:"form-main",children:[e.jsx(Re,{formCompany:c}),e.jsx(Ue,{formCompany:c}),e.jsx(Be,{formCompany:c}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Banking Info"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:c.bank_info.map((p,n)=>e.jsx(De,{banking_info:p,index:n},n))})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Cargo Insurance"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:c.cargo_insurance.map((p,n)=>e.jsx(Le,{cargo_ins:p,index:n},n))})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Liability Insurance"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:c.liablility_insurance.map((p,n)=>e.jsx(Ze,{liab_ins:p,index:n},n))})]}),e.jsx(qe,{formCompany:c}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"button",className:"btn-cancel",onClick:f,style:{padding:"9px 15px"},children:"Cancel"})})]})})},Ve=()=>{const{fetchCompanies:a,companies:f,loading:c,searchQuery:s,setSearchQuery:p,sortBy:n,sortDesc:u,selectedCompanies:o,paginatedData:i,totalPages:h,currentPage:r,isEditModalOpen:t,isAddModalOpen:g,isViewModalOpen:j,isEmailModalOpen:C,selectedCompany:_,setEditModalOpen:l,setAddModalOpen:d,setViewModalOpen:m,setEmailModalOpen:y,toggleSelectAll:b,toggleSelect:E,deleteSelected:I,openEditModal:z,sendEmails:R,openViewModal:Y,handleSort:U,updateCompany:q,handlePageChange:B}=he(),M=k=>k.key==="checkbox"||k.key==="actions"?k.label:e.jsxs("div",{className:"sortable-header",onClick:()=>U(k.key),children:[k.label,e.jsx("span",{className:"sort-icon",children:n===k.key?u?"":"":""})]}),D=[{key:"checkbox",label:e.jsx("input",{type:"checkbox",onChange:b,checked:o.length===i.length&&i.length>0}),render:k=>e.jsx("input",{type:"checkbox",checked:o.includes(k.id),onChange:()=>E(k.id)})},{key:"name",label:"Name"},{key:"phone",label:"Phone"},{key:"cell",label:"Cell"},{key:"email",label:"Email"},{key:"city",label:"City"},{key:"state",label:"State"},{key:"website",label:"Website"},{key:"gst_hst_no",label:"GST/HST No."},{key:"qst_no",label:"QST No."},{key:"actions",label:"",render:k=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Y(k),className:"btn-view",children:e.jsx(de,{})}),e.jsx("button",{onClick:()=>z(k),className:"btn-edit",children:e.jsx(oe,{})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{className:"header-container",children:[e.jsx("div",{className:"header-container-left",children:e.jsx("h1",{className:"page-heading",children:"Companies"})}),e.jsxs("div",{className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(me,{className:"search-icon"}),e.jsx("input",{className:"search-bar",value:s,onChange:k=>p(k.target.value)})]}),e.jsx("button",{onClick:()=>d(!0),className:"add-button",children:e.jsx(P,{})}),e.jsx("button",{onClick:()=>y(!0),className:"send-email-button",disabled:o.length===0,children:e.jsx(pe,{})}),e.jsx("button",{onClick:I,className:"delete-button",children:e.jsx(Z,{})})]})]}),c?e.jsx("div",{children:"Loading..."}):f.length===0?e.jsx("div",{children:"No records found"}):e.jsx(ie,{data:i,headers:D.map(k=>({...k,label:M(k)})),handleSort:U,sortBy:n,sortDesc:u}),e.jsx(ce,{currentPage:r,totalPages:h,onPageChange:B}),e.jsx(L,{isOpen:t,title:"Edit Company",onClose:()=>l(!1),children:_&&e.jsx(Ae,{company:_,onUpdate:q,onClose:()=>l(!1)})}),e.jsx(L,{isOpen:g,onClose:()=>d(!1),title:"Add Company",children:e.jsx(Oe,{onClose:()=>d(!1),onSuccess:a})}),e.jsx(L,{isOpen:C,onClose:()=>y(!1),title:"Send Email",children:e.jsx("button",{onClick:R,children:"Send"})}),e.jsx(L,{isOpen:j,onClose:()=>m(!1),title:"Company Details",children:_&&e.jsx(Me,{company:_,onClose:()=>m(!1)})})]})},ia=()=>e.jsx("div",{children:e.jsx(Ve,{})});export{ia as default};

import{r as m,u as j,j as r,b as i}from"./index-Dd33HN3-.js";import{S as a,U as p,V as I,W as n}from"./index-BysYhgZx.js";import"./EyeOutlined-yrfy-ixN.js";import"./asyncToGenerator-BfWTt6ZC.js";const E=()=>{const[h,l]=m.useState(!1),[g,L]=m.useState(!1),f="https://linkloadsapiprod.onrender.com/api",{setUserRole:x}=j(),c=e=>e.replace(/[<>"/=]/g,""),w=async e=>{var t,o,u,d;l(!0);try{const s=await i.post(`${f}/login`,{username:c(e.username),password:c(e.password)},{headers:{"Cache-Control":"no-cache, no-store, must-revalidate"}});console.log("Login Response:",s),s.data.token?y(s.data):n.error("Invalid credentials")}catch(s){console.error("Login Error:",s),i.isAxiosError(s)?(console.error("Error Response Data:",(t=s.response)==null?void 0:t.data),((o=s.response)==null?void 0:o.status)===429?n.error("Too many failed login attempts. Please wait before trying again."):n.error(((d=(u=s.response)==null?void 0:u.data)==null?void 0:d.error)||"Login failed.")):n.error("An unexpected error occurred.")}finally{l(!1)}},y=e=>{const t=Date.now()+36e5;localStorage.setItem("token",e.token),localStorage.setItem("userId",e.user.id.toString()),localStorage.setItem("userRole",e.user.role),localStorage.setItem("tokenExpiry",t.toString()),i.defaults.headers.common.Authorization=`Bearer ${e.token}`,x(e.user.role);let o="/";e.user.role.toLowerCase()==="employee"?o="/lead-employee":e.user.role.toLowerCase()==="carrier"&&(o="/quote"),setTimeout(()=>{window.location.href=o},100)};return g&&(window.location.href="/"),r.jsx("div",{className:"auth-container",children:r.jsxs("div",{className:"auth-card",children:[r.jsx("h2",{className:"auth-title",children:"Login to Continue"}),r.jsxs(a,{onFinish:w,children:[r.jsx(a.Item,{name:"username",rules:[{required:!0,message:"Please input your username!"}],children:r.jsx(p,{placeholder:"Username"})}),r.jsx(a.Item,{name:"password",rules:[{required:!0,message:"Please input your password!"}],children:r.jsx(p.Password,{placeholder:"Password"})}),r.jsx(a.Item,{children:r.jsx(I,{type:"primary",htmlType:"submit",className:"auth-button",loading:h,children:"Login"})})]})]})})};export{E as default};

import{r as m,u as y,j as r,b as n}from"./index-BoRYnzf8.js";import{S as t,U as p,V as I,W as a}from"./index-DXSkVWsC.js";import"./EyeOutlined-Uf6zJJv_.js";import"./asyncToGenerator-BfWTt6ZC.js";const k=()=>{const[h,i]=m.useState(!1),[g,S]=m.useState(!1),x="http://127.0.0.1:8000/api",{setUserRole:f}=y(),l=e=>e.replace(/[<>"/=]/g,""),w=async e=>{var o,c,u,d;i(!0);try{const s=await n.post(`${x}/login`,{username:l(e.username),password:l(e.password)},{headers:{"Cache-Control":"no-cache, no-store, must-revalidate"}});console.log("Login Response:",s),s.data.token?j(s.data):a.error("Invalid credentials")}catch(s){console.error("Login Error:",s),n.isAxiosError(s)?(console.error("Error Response Data:",(o=s.response)==null?void 0:o.data),((c=s.response)==null?void 0:c.status)===429?a.error("Too many failed login attempts. Please wait before trying again."):a.error(((d=(u=s.response)==null?void 0:u.data)==null?void 0:d.error)||"Login failed.")):a.error("An unexpected error occurred.")}finally{i(!1)}},j=e=>{const o=Date.now()+36e5;localStorage.setItem("token",e.token),localStorage.setItem("userId",e.user.id.toString()),localStorage.setItem("userRole",e.user.role),localStorage.setItem("tokenExpiry",o.toString()),n.defaults.headers.common.Authorization=`Bearer ${e.token}`,f(e.user.role),setTimeout(()=>{window.location.href="/"},100)};return g&&(window.location.href="/"),r.jsx("div",{className:"auth-container",children:r.jsxs("div",{className:"auth-card",children:[r.jsx("h2",{className:"auth-title",children:"Login to Continue"}),r.jsxs(t,{onFinish:w,children:[r.jsx(t.Item,{name:"username",rules:[{required:!0,message:"Please input your username!"}],children:r.jsx(p,{placeholder:"Username"})}),r.jsx(t.Item,{name:"password",rules:[{required:!0,message:"Please input your password!"}],children:r.jsx(p.Password,{placeholder:"Password"})}),r.jsx(t.Item,{children:r.jsx(I,{type:"primary",htmlType:"submit",className:"auth-button",loading:h,children:"Login"})})]})]})})};export{k as default};

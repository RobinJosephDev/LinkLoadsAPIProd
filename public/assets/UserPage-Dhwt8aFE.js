import{r as p,S as j,b as _,j as e}from"./index-Dd33HN3-.js";import{b as B,R as V,a as Z,T as L,M as I}from"./Modal-mZ12kiPk.js";import{z as x,P as Q}from"./Pagination-Cp7cgeW5.js";/* empty css             */import{o as Y,R as H}from"./EyeOutlined-yrfy-ixN.js";const G=({user:a,onUpdate:i,onClose:s})=>{const[n,l]=p.useState({id:0,name:"",username:"",email:"",password:"",password_confirmation:"",emp_code:"",role:"",created_at:"",updated_at:""}),r="https://linkloadsapiprod.onrender.com/api";p.useEffect(()=>{a&&l({id:a.id||0,name:a.name||"",username:a.username||"",email:a.email||"",password:a.password||"",password_confirmation:a.password_confirmation||"",emp_code:a.emp_code||"",role:a.role||"",created_at:a.created_at||"",updated_at:a.updated_at||""})},[a]);const h=()=>!!(n.name&&n.username&&n.password&&n.emp_code&&n.email&&n.role);return{formUser:n,setFormUser:l,updateUser:async()=>{var d;if(!h()){j.fire("Validation Error","Please fill in all required fields.","error");return}try{const c=localStorage.getItem("token");if(!c){j.fire({icon:"error",title:"Unauthorized",text:"You are not logged in. Please log in again."});return}const u=await _.put(`${r}/user/${n.id}`,n,{headers:{Authorization:`Bearer ${c}`}});j.fire({icon:"success",title:"Success!",text:"User details updated."}),i(u.data),s()}catch(c){console.error("Error updating user:",c),j.fire({icon:"error",title:"Oops...",text:((d=c.response)==null?void 0:d.status)===401?"Unauthorized. Please log in again.":"Failed to update user."})}}}},J=x.object({name:x.string().min(1,"Name is required").max(200,"Name cannot exceed 200 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed"),username:x.string().min(1,"Username is required").max(255,"Username cannot be more than 255 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed"),email:x.string().min(1,"Email is required").email("Invalid email format"),password:x.string().min(12,"Password must be at least 12 characters long").max(200,"Password cannot exceed 200 characters"),password_confirmation:x.string().min(12,"Password confirmation is required").max(200,"Password confirmation cannot exceed 200 characters"),emp_code:x.string().min(1,"Employee code is required").max(100,"Employee code cannot be more than 100 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed"),role:x.enum(["Admin","Employee","Carrier","Customer"],{errorMap:()=>({message:"Invalid role selection"})})}).refine(a=>a.password===a.password_confirmation,{message:"Passwords do not match",path:["password_confirmation"]}),K=["Admin","Employee","Carrier","Customer"],W=({formUser:a,setFormUser:i})=>{const[s,n]=p.useState({}),l=(r,h)=>{let f={...a,[r]:h};const d=J.safeParse(f);if(d.success)n(c=>({...c,[r]:""}));else{const c=d.error.errors.find(u=>u.path[0]===r);n(u=>({...u,[r]:(c==null?void 0:c.message)||""}))}i(f)};return e.jsx("fieldset",{children:e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"name",type:"text",value:a.name||"",onChange:r=>l("name",r.target.value),placeholder:"Enter Name"}),s.name&&e.jsx("span",{className:"error",style:{color:"red"},children:s.name})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"username",children:["Username ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"username",type:"text",value:a.username||"",onChange:r=>l("username",r.target.value),placeholder:"Enter Username"}),s.username&&e.jsx("span",{className:"error",style:{color:"red"},children:s.username})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"email",children:["Email ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"email",type:"email",value:a.email||"",onChange:r=>l("email",r.target.value),placeholder:"Enter Email"}),s.email&&e.jsx("span",{className:"error",style:{color:"red"},children:s.email})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"password",children:["Password ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"password",type:"password",value:a.password||"",onChange:r=>l("password",r.target.value),placeholder:"Enter Password"}),s.password&&e.jsx("span",{className:"error",style:{color:"red"},children:s.password})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"password_confirmation",children:["Confirm Password ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"password_confirmation",type:"password",value:a.password_confirmation||"",onChange:r=>l("password_confirmation",r.target.value),placeholder:"Confirm Password"}),s.password_confirmation&&e.jsx("span",{className:"error",style:{color:"red"},children:s.password_confirmation})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"emp_code",children:["User Code ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"emp_code",type:"text",value:a.emp_code||"",onChange:r=>l("emp_code",r.target.value),placeholder:"Employee Code"}),s.emp_code&&e.jsx("span",{className:"error",style:{color:"red"},children:s.emp_code})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"role",children:["Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"role",value:a.role||"",onChange:r=>l("role",r.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Role"}),K.map(r=>e.jsx("option",{value:r,children:r},r))]}),s.role&&e.jsx("span",{className:"error",style:{color:"red"},children:s.role})]})]})})},X=({user:a,onClose:i,onUpdate:s})=>{const{formUser:n,setFormUser:l,updateUser:r}=G({user:a,onUpdate:s,onClose:i});return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:h=>{h.preventDefault(),r()},className:"form-main",children:[e.jsx(W,{formUser:n,setFormUser:l}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Save Changes"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:i,children:"Cancel"})]})]})})},ee=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]+$/,se=x.object({name:x.string().min(1,"Name is required").max(200,"Name cannot exceed 200 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed"),username:x.string().min(1,"Username is required").max(255,"Username cannot be more than 255 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed"),email:x.string().min(1,"Email is required").email("Invalid email format"),password:x.string().min(12,"Password must be at least 12 characters long").max(200,"Password cannot exceed 200 characters").regex(ee,"Password must include at least one uppercase letter, one lowercase letter, one number, and one special character (@$!%*?&)."),password_confirmation:x.string().min(12,"Password confirmation is required").max(200,"Password confirmation cannot exceed 200 characters"),emp_code:x.string().min(1,"Employee code is required").max(100,"Employee code cannot be more than 100 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed"),role:x.enum(["Admin","Employee","Carrier","Customer"],{errorMap:()=>({message:"Invalid role selection"})})}).refine(a=>a.password===a.password_confirmation,{message:"Passwords do not match",path:["password_confirmation"]}),re=["Admin","Employee","Carrier","Customer"],ae=({user:a,setUser:i})=>{const[s,n]=p.useState({}),l=(r,h)=>{let f={...a,[r]:h};const d=se.safeParse(f);if(d.success)n(c=>({...c,[r]:""}));else{const c=d.error.errors.find(u=>u.path[0]===r);n(u=>({...u,[r]:(c==null?void 0:c.message)||""}))}i(f)};return e.jsx("fieldset",{children:e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"name",type:"text",value:a.name||"",onChange:r=>l("name",r.target.value),placeholder:"Enter Name"}),s.name&&e.jsx("span",{className:"error",style:{color:"red"},children:s.name})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"username",children:["Username ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"username",type:"text",value:a.username||"",onChange:r=>l("username",r.target.value),placeholder:"Enter Username"}),s.username&&e.jsx("span",{className:"error",style:{color:"red"},children:s.username})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"email",children:["Email ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"email",type:"email",value:a.email||"",onChange:r=>l("email",r.target.value),placeholder:"Enter Email"}),s.email&&e.jsx("span",{className:"error",style:{color:"red"},children:s.email})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"password",children:["Password ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"password",type:"password",value:a.password||"",onChange:r=>l("password",r.target.value),placeholder:"Enter Password"}),s.password&&e.jsx("span",{className:"error",style:{color:"red"},children:s.password})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"password_confirmation",children:["Confirm Password ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"password_confirmation",type:"password",value:a.password_confirmation||"",onChange:r=>l("password_confirmation",r.target.value),placeholder:"Confirm Password"}),s.password_confirmation&&e.jsx("span",{className:"error",style:{color:"red"},children:s.password_confirmation})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"emp_code",children:["User Code ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:"emp_code",type:"text",value:a.emp_code||"",onChange:r=>l("emp_code",r.target.value),placeholder:"Employee Code"}),s.emp_code&&e.jsx("span",{className:"error",style:{color:"red"},children:s.emp_code})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"role",children:["Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"role",value:a.role||"",onChange:r=>l("role",r.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Role"}),re.map(r=>e.jsx("option",{value:r,children:r},r))]}),s.role&&e.jsx("span",{className:"error",style:{color:"red"},children:s.role})]})]})})},D="https://linkloadsapiprod.onrender.com/api",oe=(a,i)=>{const[s,n]=p.useState({id:0,name:"",username:"",email:"",password:"",password_confirmation:"",emp_code:"",role:"",created_at:"",updated_at:""}),l=()=>!!(s.name&&s.username&&s.password&&s.emp_code&&s.email&&s.role),r=async f=>{if(f.preventDefault(),!l()){j.fire("Validation Error","Please fill in all required fields.","error");return}try{let d;const c=localStorage.getItem("token");if(!c){j.fire("Error","No token found","error");return}const u={Authorization:`Bearer ${c}`};s.id?(d=await _.put(`${D}/user/${s.id}`,s,{headers:u}),j.fire("Success!","User details updated.","success")):(d=await _.post(`${D}/user`,s,{headers:u}),j.fire("Success!","User added successfully.","success")),h(),i()}catch(d){console.error("Error saving/updating user:",d.response?d.response.data:d.message),j.fire("Error","An error occurred while saving/updating the user.","error")}},h=()=>{n({id:0,name:"",username:"",email:"",password:"",password_confirmation:"",emp_code:"",role:"",created_at:"",updated_at:""})};return{user:s,setUser:n,handleSubmit:r}},te=({onClose:a,onSuccess:i})=>{const{user:s,setUser:n,handleSubmit:l}=oe(a,i);return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:l,className:"form-main",children:[e.jsx(ae,{user:s,setUser:n}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Add User"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:a,children:"Cancel"})]})]})})},ne=({onClose:a,user:i})=>{const[s,n]=p.useState({id:0,name:"",username:"",email:"",password:"",password_confirmation:"",role:"",emp_code:"",created_at:"",updated_at:""});return p.useEffect(()=>{i&&(console.log("Selected User:",i),n({id:i.id,name:i.name||"",username:i.username||"",email:i.email||"",password:"",password_confirmation:"",role:i.role||"",emp_code:i.emp_code||"",created_at:"",updated_at:""}))},[i]),e.jsx("div",{className:"form-container",children:e.jsxs("form",{className:"form-main",children:[e.jsxs("fieldset",{className:"form-section",children:[e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("div",{children:s.name})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"username",children:"Username"}),e.jsx("div",{children:s.username})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("div",{children:s.email})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"role",children:"User Role"}),e.jsx("div",{children:s.role})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"emp_code",children:"Employee Code"}),e.jsx("div",{children:s.emp_code})]})]})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"button",className:"btn-cancel",onClick:a,style:{padding:"9px 15px"},children:"Cancel"})})]})})},q="https://linkloadsapiprod.onrender.com/api",le=()=>{const[a,i]=p.useState([]),[s,n]=p.useState(!0),[l,r]=p.useState(""),[h,f]=p.useState("created_at"),[d,c]=p.useState(!0),[u,S]=p.useState(1),[v,C]=p.useState(null),[A,E]=p.useState(!1),[F,$]=p.useState(!1),[M,U]=p.useState(!1),[w,b]=p.useState([]),[y,R]=p.useState(10),P=async()=>{try{const o=localStorage.getItem("token");if(!o)throw new Error("No token found");n(!0);const{data:m}=await _.get(`${q}/user`,{headers:{Authorization:`Bearer ${o}`}});i(m)}catch(o){console.error("Error loading users:",o),O(o)}finally{n(!1)}};p.useEffect(()=>{P()},[]);const O=o=>{var m;_.isAxiosError(o)&&((m=o.response)==null?void 0:m.status)===401&&j.fire({icon:"error",title:"Unauthorized",text:"You need to log in to access this resource."})},k=a.filter(o=>Object.values(o).some(m=>m==null?void 0:m.toString().toLowerCase().includes(l.toLowerCase()))),t=k.sort((o,m)=>{let g=o[h]??"",N=m[h]??"";return(h==="created_at"||h==="updated_at")&&(g=new Date(g).getTime(),N=new Date(N).getTime()),typeof g=="string"&&typeof N=="string"?d?N.localeCompare(g):g.localeCompare(N):0}).slice((u-1)*y,u*y),T=Math.ceil(k.length/y);return{fetchUsers:P,users:a,setSelectedUser:C,loading:s,searchQuery:l,setSearchQuery:r,sortBy:h,sortDesc:d,paginatedData:t,totalPages:T,currentPage:u,handlePageChange:o=>{S(o)},handleSort:o=>{h===o?c(!d):(f(o),c(!1))},selectedIds:w,toggleSelectAll:()=>{w.length===t.length?b([]):b(t.map(o=>o.id).filter(o=>o!==void 0))},toggleSelect:o=>{b(m=>m.includes(o)?m.filter(g=>g!==o):[...m,o])},deleteSelected:async()=>{if(!w.length){j.fire({icon:"warning",title:"No record selected",text:"Please select a record to delete."});return}if((await j.fire({title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete selected!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const m=localStorage.getItem("token");if(!m)throw new Error("No token found");await Promise.all(w.map(g=>_.delete(`${q}/user/${g}`,{headers:{Authorization:`Bearer ${m}`}}))),i(g=>g.filter(N=>!w.includes(N.id))),b([]),j.fire("Deleted!","The selected users have been removed.","success")}catch(m){console.error("Error deleting selected users:",m),j.fire({icon:"error",title:"Error!",text:"Failed to delete selected users."})}},isEditModalOpen:A,isAddModalOpen:F,isViewModalOpen:M,setEditModalOpen:E,setAddModalOpen:$,setViewModalOpen:U,selectedUser:v,openEditModal:o=>{C(o),E(!0)},openViewModal:o=>{C(o),U(!0)},updateUser:o=>{i(m=>m.map(g=>g.id===o.id?{...g,...o}:g))}}},ie=()=>{const{fetchUsers:a,users:i,loading:s,searchQuery:n,setSearchQuery:l,sortBy:r,sortDesc:h,paginatedData:f,totalPages:d,currentPage:c,handlePageChange:u,handleSort:S,selectedIds:v,toggleSelectAll:C,toggleSelect:A,deleteSelected:E,isEditModalOpen:F,isAddModalOpen:$,isViewModalOpen:M,setEditModalOpen:U,setAddModalOpen:w,setViewModalOpen:b,selectedUser:y,openEditModal:R,openViewModal:P,updateUser:O}=le(),k=t=>t.key==="checkbox"||t.key==="actions"?t.label:e.jsxs("div",{className:"sortable-header",onClick:()=>S(t.key),children:[t.label,e.jsx("span",{className:"sort-icon",children:r===t.key?h?"▼":"▲":"▼"})]}),z=[{key:"checkbox",label:e.jsx("input",{type:"checkbox",onChange:C,checked:v.length===f.length&&f.length>0}),render:t=>e.jsx("input",{type:"checkbox",checked:v.includes(t.id),onChange:()=>A(t.id)})},{key:"name",label:"Name",render:t=>t.name||e.jsx("span",{children:"-"})},{key:"username",label:"Username",render:t=>t.username||e.jsx("span",{children:"-"})},{key:"email",label:"Email",render:t=>t.email||e.jsx("span",{children:"-"})},{key:"emp_code",label:"User Code",render:t=>t.emp_code||e.jsx("span",{children:"-"})},{key:"role",label:"Role",render:t=>t.role||e.jsx("span",{children:"-"})},{key:"actions",label:"",render:t=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>P(t),className:"btn-view",children:e.jsx(Y,{})}),e.jsx("button",{onClick:()=>R(t),className:"btn-edit",children:e.jsx(B,{})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{className:"header-container",children:[e.jsx("div",{className:"header-container-left",children:e.jsx("h1",{className:"page-heading",children:"Users"})}),e.jsxs("div",{className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(H,{className:"search-icon"}),e.jsx("input",{className:"search-bar",value:n,onChange:t=>l(t.target.value)})]}),e.jsxs("button",{onClick:()=>w(!0),className:"add-button",children:[e.jsx(V,{})," New"]})]})]}),v.length>0&&e.jsxs("div",{className:"selection-banner",children:[e.jsxs("span",{children:[v.length," item",v.length>1?"s":""," selected"]}),e.jsxs("button",{className:"text-delete-btn",onClick:E,children:[e.jsx(Z,{}),"  Delete"]})]}),s?e.jsx("div",{children:"Loading..."}):i.length===0?e.jsx("div",{className:"no-record",children:"No records found"}):e.jsx(L,{data:f,headers:z.map(t=>({...t,label:k(t)})),handleSort:S,sortBy:r,sortDesc:h}),e.jsx(Q,{currentPage:c,totalPages:d,onPageChange:u}),e.jsx(I,{isOpen:F,title:"Edit User",onClose:()=>U(!1),children:y&&e.jsx(X,{user:y,onUpdate:O,onClose:()=>U(!1)})}),e.jsxs(I,{isOpen:$,onClose:()=>w(!1),title:"Add User",children:[e.jsx(te,{onClose:()=>w(!1),onSuccess:a})," "]}),e.jsx(I,{isOpen:M,onClose:()=>b(!1),title:"User Details",children:y&&e.jsx(ne,{user:y,onClose:()=>b(!1)})})]})},be=()=>e.jsx("div",{children:e.jsx(ie,{})});export{be as default};

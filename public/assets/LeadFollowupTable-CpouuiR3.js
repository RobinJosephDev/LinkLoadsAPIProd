import{r as f,j as e,b as P,S as A}from"./index-DsiLbZ9r.js";import{R as I,a as O,b as se,T as te,M}from"./Modal-Dy5-4all.js";import{z as N,P as ae}from"./Pagination-rW2CcH_q.js";import E from"./purify.es-Ci5xwkH_.js";/* empty css             */import{u as le}from"./useGoogleAutocomplete--4rnTPXT.js";import{o as re,R as ne}from"./EyeOutlined-B8J0i9Xp.js";const Z=s=>s.trim().replace(/<[^>]*>?/gm,""),oe=({followupEdit:s,setFollowupEdit:p})=>{const n=f.useRef(null);f.useEffect(()=>{(()=>{if(window.google&&window.google.maps){l();return}const r=document.createElement("script");return r.src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places",r.async=!0,r.defer=!0,r.onload=()=>{window.google&&window.google.maps&&l()},document.head.appendChild(r),()=>{document.head.removeChild(r)}})()},[]);const l=()=>{if(!n.current)return;const t=new window.google.maps.places.Autocomplete(n.current,{types:["address"]});t.addListener("place_changed",()=>{const r=t.getPlace();if(!r||!r.address_components){console.error("No valid address selected");return}a(r)})},a=t=>{if(!t.address_components)return;const r=(u,g)=>{var o;const m=(o=t.address_components)==null?void 0:o.find(h=>h.types.includes(u));return m?Z(m.long_name):g},c=r("street_number",""),d=r("route",""),x=`${c} ${d}`.trim();p({...s,address:x,city:r("locality",""),state:r("administrative_area_level_1",""),country:r("country",""),postal_code:r("postal_code","")})},i=(t,r)=>{p({...s,[t]:Z(r)})};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Address Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"address",children:"Address"}),e.jsx("input",{type:"text",id:"address",ref:n,value:s.address,onChange:t=>i("address",t.target.value),placeholder:"Enter your address"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"unitNo",children:"Unit No"}),e.jsx("input",{type:"text",id:"unitNo",value:s.unit_no,onChange:t=>i("unit_no",t.target.value)})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"city",children:"City"}),e.jsx("input",{type:"text",id:"city",value:s.city,onChange:t=>i("city",t.target.value)})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"state",children:"State"}),e.jsx("input",{type:"text",id:"state",value:s.state,onChange:t=>i("state",t.target.value)})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"country",children:"Country"}),e.jsx("input",{type:"text",id:"country",value:s.country,onChange:t=>i("country",t.target.value)})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"postalCode",children:"Postal Code"}),e.jsx("input",{type:"text",id:"postalCode",value:s.postal_code,onChange:t=>i("postal_code",t.target.value)})]})]})]})},de=s=>s.trim().replace(/<[^>]*>?/gm,""),ce=({followupEdit:s,setFollowupEdit:p})=>{const n=["AB","BC","BDS","CA","DPD MAGMA","MB","ON","Super Leads","TBAB","USA"],l=(a,i)=>{p({...s,[a]:de(i)})};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Lead Type and Contact"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadType",children:"Lead Type"}),e.jsxs("select",{id:"leadType",value:s.lead_type||"",onChange:a=>l("lead_type",a.target.value),children:[e.jsx("option",{value:"",children:"Select Lead Type"}),n.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"contactPerson",children:"Contact Person"}),e.jsx("input",{type:"text",id:"contactPerson",value:s.contact_person||"",onChange:a=>l("contact_person",a.target.value)})]})]})]})},ie=s=>s.trim().replace(/<[^>]*>?/gm,""),ue=({followupEdit:s,setFollowupEdit:p})=>{const n=["Select Status","New","In Progress","Completed","On Hold","Lost"],l=(a,i)=>{p({...s,[a]:ie(i)})};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Follow Up Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"nextFollowUpDate",children:"Next Follow-Up Date"}),e.jsx("input",{type:"date",id:"nextFollowUpDate",value:s.next_follow_up_date,onChange:a=>l("next_follow_up_date",a.target.value)})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadStatus",children:"Lead Status*"}),e.jsxs("select",{id:"leadStatus",value:s.lead_status,onChange:a=>l("lead_status",a.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select Lead Status"}),n.map(a=>e.jsx("option",{value:a,children:a},a))]})]})]})]})},me=s=>s.trim().replace(/<[^>]*>?/gm,""),pe=({followupEdit:s,setFollowupEdit:p})=>{const n=["Van","Reefer","Flatbed","Triaxle","Maxi","Btrain","Roll tite"],l=(a,i)=>{const t=me(i);p({...s,[a]:t})};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Additional Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"equipment",children:"Equipment"}),e.jsxs("select",{id:"equipment",value:s.equipment,onChange:a=>l("equipment",a.target.value),children:[e.jsx("option",{value:"",children:"Select Equipment Type"}),n.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"remarks",children:"Remarks"}),e.jsx("textarea",{id:"remarks",value:s.remarks,onChange:a=>l("remarks",a.target.value),maxLength:500})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",value:s.notes,onChange:a=>l("notes",a.target.value),maxLength:500})]})]})]})},B=s=>typeof s!="string"?"":s.trim().replace(/<[^>]*>?/gm,""),he=({followupEdit:s,setFollowupEdit:p})=>{const[n,l]=f.useState([]),a="https://linkloadsapiprod.onrender.com/api";f.useEffect(()=>{(async()=>{try{const r=localStorage.getItem("token");if(!r){console.warn("No authentication token found.");return}const c=await P.get(`${a}/lead`,{headers:{Authorization:`Bearer ${r}`}});console.log("Fetched leads:",c.data);const d=Array.isArray(c.data)?c.data:c.data.data;if(!Array.isArray(d)){console.error("Unexpected API response format:",c.data);return}const x=d.map(u=>({value:B(u==null?void 0:u.value),label:B(u==null?void 0:u.label)}));l(x)}catch(r){console.error("Error fetching leads:",r)}})()},[]);const i=(t,r)=>{p({...s,[t]:B(r)})};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Follow-up Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadNo",children:"Lead No*"}),e.jsx("input",{type:"number",id:"leadNo",value:s.lead_no,onChange:t=>i("lead_no",t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadDate",children:"Lead Date*"}),e.jsx("input",{type:"date",id:"leadDate",value:s.lead_date,onChange:t=>i("lead_date",t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"quote_customer",children:"Lead"}),e.jsxs("select",{id:"quote_customer",value:s.customer_name,onChange:t=>i("customer_name",t.target.value),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a lead"}),n.map((t,r)=>e.jsx("option",{value:t.value,children:t.label},t.value||r))]})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"phone",children:"Phone"}),e.jsx("input",{type:"tel",id:"phone",value:s.phone,onChange:t=>i("phone",t.target.value)})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:s.email,onChange:t=>i("email",t.target.value)})]})]})]})},xe=N.object({name:N.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]+$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),phone:N.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),email:N.string().max(255,"Email must be at most 255 characters").email("Invalid email format").optional()}),Q=({contacts:s,index:p,handleContactChange:n,handleRemoveContact:l,onAddContact:a})=>{const i=s[p]??{},[t,r]=f.useState({}),c=f.useCallback((x,u)=>{const g=E.sanitize(u);let m="";const o={...i,[x]:g},h=xe.safeParse(o);if(!h.success){const j=h.error.errors.find(y=>y.path[0]===x);m=j?j.message:""}r(j=>({...j,[x]:m})),n(p,o)},[i,n,p]),d=[{label:"Name",key:"name",type:"text",placeholder:"Enter name"},{label:"Phone",key:"phone",type:"tel",placeholder:"Enter phone"},{label:"Email",key:"email",type:"email",placeholder:"Enter email"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[d.map(({label:x,key:u,type:g,placeholder:m})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${u}-${p}`,children:x}),e.jsx("input",{id:`${u}-${p}`,type:g,name:u,value:i[u]||"",onChange:o=>c(u,o.target.value),placeholder:m}),t[u]&&e.jsx("span",{className:"error",style:{color:"red"},children:t[u]})]},u)),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:a,className:"add-button",children:e.jsx(I,{})}),e.jsx("button",{type:"button",onClick:()=>l(p),className:"delete-button",children:e.jsx(O,{})})]})]})},ge=N.object({name:N.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]+$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),quantity:N.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional()}),Y=({products:s,index:p,handleProductChange:n,handleRemoveProduct:l,onAddProduct:a})=>{const i=s[p]??{},[t,r]=f.useState({}),c=f.useCallback((x,u)=>{const g=E.sanitize(u);let m="";const o={...i,[x]:g},h=ge.safeParse(o);if(!h.success){const j=h.error.errors.find(y=>y.path[0]===x);m=j?j.message:""}r(j=>({...j,[x]:m})),n(p,o)},[i,n,p]),d=[{label:"Name",key:"name",type:"text",placeholder:"Enter name"},{label:"Quantity",key:"phone",type:"text",placeholder:"Enter quantity"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[d.map(({label:x,key:u,type:g,placeholder:m})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${u}-${p}`,children:x}),e.jsx("input",{id:`${u}-${p}`,type:g,name:u,value:i[u]||"",onChange:o=>c(u,o.target.value),placeholder:m}),t[u]&&e.jsx("span",{className:"error",style:{color:"red"},children:t[u]})]},u)),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:a,className:"add-button",children:e.jsx(I,{})}),e.jsx("button",{type:"button",onClick:()=>l(p),className:"delete-button",children:e.jsx(O,{})})]})]})},je="https://linkloadsapiprod.onrender.com/api",fe=(s,p,n)=>{const[l,a]=f.useState({id:0,lead_no:"",lead_date:"",customer_name:"",phone:"",email:"",address:"",city:"",state:"",country:"",postal_code:"",unit_no:"",lead_type:"",contact_person:"",notes:"",next_follow_up_date:"",followup_type:"",lead_status:"",remarks:"",equipment:"",contacts:[],products:[],created_at:"",updated_at:""});f.useEffect(()=>{if(s){const m=Array.isArray(s.contacts)?s.contacts:JSON.parse(s.contacts||"[]"),o=Array.isArray(s.products)?s.products:JSON.parse(s.products||"[]"),h={...s,contacts:m.length>0?m:[],products:o.length>0?o:[]};a(h)}},[s]);const i=()=>!!l.lead_no&&!!l.lead_date&&!!l.lead_type&&!!l.lead_status;return{followupEdit:l,setFollowupEdit:a,handleAddContact:()=>{a(m=>({...m,contacts:[...m.contacts,{id:"",name:"",phone:"",email:""}]}))},handleAddProduct:()=>{a(m=>({...m,products:[...m.products,{id:"",name:"",quantity:0}]}))},handleContactChange:(m,o)=>{a(h=>({...h,contacts:h.contacts.map(j=>j.id===m?o:j)}))},handleRemoveContact:m=>{a(o=>({...o,contacts:o.contacts.filter(h=>h.id!==m)}))},handleProductChange:(m,o)=>{a(h=>({...h,products:h.products.map(j=>j.id===m?o:j)}))},handleRemoveProduct:m=>{a(o=>({...o,products:o.products.filter(h=>h.id!==m)}))},updateFollowup:async()=>{if(!i()){A.fire("Validation Error","Please fill in all required fields.","error");return}try{const m=localStorage.getItem("token");if(!m){A.fire({icon:"error",title:"Unauthorized",text:"You are not logged in. Please log in again."});return}const o=await P.put(`${je}/lead-followup/${l.id}`,l,{headers:{Authorization:`Bearer ${m}`}});A.fire({icon:"success",title:"Updated!",text:"Follow-up data has been updated successfully."}),n(o.data),p()}catch(m){console.error("Error updating follow-up:",m),A.fire({icon:"error",title:"Oops...",text:"Failed to update follow-up."})}}}},ye=({followup:s,onClose:p,onUpdate:n})=>{const{followupEdit:l,setFollowupEdit:a,handleAddContact:i,handleAddProduct:t,handleContactChange:r,handleRemoveContact:c,handleProductChange:d,handleRemoveProduct:x,updateFollowup:u}=fe(s,p,n),g=l.contacts.map(j=>j.id),m=new Set(g).size!==g.length;console.log("Has duplicate contacts:",m);const o=l.products.map(j=>j.id),h=new Set(o).size!==o.length;return console.log("Has duplicate products:",h),e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:j=>{j.preventDefault(),u()},className:"form-main",children:[e.jsx(he,{followupEdit:l,setFollowupEdit:a}),e.jsx(oe,{followupEdit:l,setFollowupEdit:a}),e.jsx(ce,{followupEdit:l,setFollowupEdit:a}),e.jsx(ue,{followupEdit:l,setFollowupEdit:a}),e.jsx(pe,{followupEdit:l,setFollowupEdit:a}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),l.contacts&&l.contacts.length>0?l.contacts.map(j=>{const y=j.id;return e.jsx(Q,{contact:{...j,id:y},onAddContact:i,handleRemoveContact:c,handleContactChange:r},y)}):e.jsx("p",{children:"No contacts available"}),e.jsx("button",{type:"button",onClick:i,className:"add-button",children:e.jsx(I,{})})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Products"}),l.products&&l.products.length>0?l.products.map(j=>{const y=Number(j.id);return e.jsx(Y,{product:{...j,id:y},onAddProduct:t,handleRemoveProduct:x,handleProductChange:d},y)}):e.jsx("p",{children:"No products available"}),e.jsx("button",{type:"button",onClick:t,className:"add-button",children:e.jsx(I,{})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Save"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:p,children:"Cancel"})]})]})})},ve=({followupEdit:s})=>{const[p,n]=f.useState([]),l="https://linkloadsapiprod.onrender.com/api";return f.useEffect(()=>{(async()=>{try{const i=localStorage.getItem("token"),{data:t}=await P.get(`${l}/lead`,{headers:{Authorization:`Bearer ${i}`}});console.log("Fetched leads:",t);const r=(Array.isArray(t),t);if(!Array.isArray(r)){console.error("Unexpected API response format:",t);return}const c=r.map(d=>({value:d.customer_name,label:d.customer_name}));n(c)}catch(i){console.error("Error fetching leads:",i)}})()},[]),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Follow-up Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Lead No"}),e.jsx("div",{children:s.lead_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Lead Date"}),e.jsx("div",{children:s.lead_date||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Lead"}),e.jsx("div",{children:s.customer_name||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:s.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:s.email||"N/A"})]})]})]})},Ne=({followupEdit:s})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Address Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:s.address})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Unit No"}),e.jsx("div",{children:s.unit_no})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"City"}),e.jsx("div",{children:s.city})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"State"}),e.jsx("div",{children:s.state})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Country"}),e.jsx("div",{children:s.country})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Postal Code"}),e.jsx("div",{children:s.postal_code})]})]})]}),be=({followupEdit:s})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Lead Type and Contact"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Lead Type"}),e.jsx("div",{children:s.lead_type||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Contact Person"}),e.jsx("div",{children:s.contact_person||"N/A"})]})]})]}),_e=({followupEdit:s})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Additional Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Equipment"}),e.jsx("div",{children:s.equipment})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Remarks"}),e.jsx("div",{children:s.remarks})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Notes"}),e.jsx("div",{children:s.notes})]})]})]}),Ce=({followupEdit:s})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Follow Up Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Next Follow-Up Date"}),e.jsx("div",{children:s.next_follow_up_date||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Lead Status"}),e.jsx("div",{children:s.lead_status||"N/A"})]})]})]}),Ae=({contact:s})=>e.jsxs("div",{className:"contact-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:s.name||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:s.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:s.email||"N/A"})]})]}),Fe=({product:s})=>e.jsx("fieldset",{children:e.jsxs("div",{className:"contact-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:s.name||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Quantity"}),e.jsx("div",{children:s.quantity??"N/A"})]})]})}),Se=({followUp:s,onClose:p})=>{var a;const[n,l]=f.useState({id:0,lead_no:"",lead_date:"",customer_name:"",phone:"",email:"",address:"",city:"",state:"",country:"",postal_code:"",unit_no:"",lead_type:"",contact_person:"",notes:"",next_follow_up_date:"",followup_type:"",products:[],lead_status:"",remarks:"",equipment:"",contacts:[]});return f.useEffect(()=>{if(s){const i=Array.isArray(s.contacts)?s.contacts:JSON.parse(s.contacts||"[]"),t=Array.isArray(s.products)?s.products:JSON.parse(s.products||"[]");l({...s,contacts:i.length>0?i:[],products:t.length>0?t:[]})}},[s]),e.jsx("div",{className:"form-container",children:e.jsxs("form",{className:"form-main",children:[e.jsx(ve,{followupEdit:n}),e.jsx(Ne,{followupEdit:n}),e.jsx(be,{followupEdit:n}),e.jsx(Ce,{followupEdit:n}),e.jsx(_e,{followupEdit:n}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),e.jsx("hr",{}),n.contacts.map((i,t)=>e.jsx(Ae,{contact:i},t))]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Products"}),e.jsx("hr",{}),(a=n.products)==null?void 0:a.map((i,t)=>e.jsx(Fe,{product:i},t))]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"button",className:"btn-cancel",onClick:p,children:"Cancel"})})]})})},H="https://linkloadsapiprod.onrender.com/api",we=()=>{const[s,p]=f.useState([]),[n,l]=f.useState(!0),[a,i]=f.useState(""),[t,r]=f.useState("created_at"),[c,d]=f.useState(!0),[x,u]=f.useState(1),[g,m]=f.useState(null),[o,h]=f.useState(!1),[j,y]=f.useState(!1),[F,S]=f.useState([]),[L,V]=f.useState(10);f.useEffect(()=>{(async()=>{try{const C=localStorage.getItem("token");if(!C)throw new Error("No token found");l(!0);const{data:_}=await P.get(`${H}/lead-followup`,{headers:{Authorization:`Bearer ${C}`}});console.log("Fetched Leads:",_),p(_)}catch(C){console.error("Error loading leads:",C),$(C)}finally{l(!1)}})()},[]);const $=v=>{v.response&&v.response.status===401&&A.fire({icon:"error",title:"Unauthorized",text:"You need to log in to access this resource."})},k=v=>{u(v)},D=v=>{m(v),h(!0)},q=()=>{h(!1),m(null)},z=v=>{m(v),y(!0)},R=()=>{y(!1),m(null)},T=v=>{p(C=>C.map(_=>_.id===v.id?{..._,...v}:_))},b=()=>{F.length===s.length?S([]):S(s.map(v=>v.id))},J=v=>{S(C=>C.includes(v)?C.filter(_=>_!==v):[...C,v])},K=async()=>{if(F.length===0){A.fire({icon:"warning",title:"No record selected",text:"Please select a record to delete."});return}if((await A.fire({title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete selected!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const C=localStorage.getItem("token");if(!C)throw new Error("No token found");await Promise.all(F.map(_=>P.delete(`${H}/lead-followup/${_}`,{headers:{Authorization:`Bearer ${C}`}}))),p(_=>_.filter(w=>!F.includes(w.id))),S([]),A.fire("Deleted!","Selected follow-ups have been deleted.","success")}catch(C){console.error("Error deleting follow-ups:",C),A.fire({icon:"error",title:"Error!",text:"Failed to delete selected follow-ups."})}},W=v=>{t===v?d(!c):(r(v),d(!1))},U=s.filter(v=>v.customer_name.toLowerCase().includes(a.toLowerCase())||v.phone.toLowerCase().includes(a.toLowerCase())||v.email.toLowerCase().includes(a.toLowerCase())),X=U.sort((v,C)=>{let _=v[t]??"",w=C[t]??"";return typeof _=="string"&&typeof w=="string"?c?w.localeCompare(_):_.localeCompare(w):typeof _=="number"&&typeof w=="number"?c?w-_:_-w:0}).slice((x-1)*L,x*L),ee=Math.ceil(U.length/L);return{followUps:s,loading:n,searchQuery:a,setSearchQuery:i,sortBy:t,sortDesc:c,selectedIds:F,setSelectedIds:S,selectedFollowup:g,paginatedData:X,totalPages:ee,currentPage:x,setCurrentPage:u,isEditModalOpen:o,isViewModalOpen:j,setEditModalOpen:h,setViewModalOpen:y,openEditModal:D,closeEditModal:q,openViewModal:z,closeViewModal:R,toggleSelectAll:b,toggleSelect:J,deleteSelected:K,handleSort:W,updateFollowup:T,handlePageChange:k}},Pe=N.object({lead_no:N.string().min(1,"Lead No is required").max(100,"Lead No must be at most 100 characters long").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed"),lead_date:N.string().min(1,"Lead Date is required"),customer_name:N.string().max(200,"Customer Name must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),phone:N.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),email:N.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),lead_type:N.enum(["AB","BC","BDS","CA","DPD MAGMA","MB","ON","Super Leads","TBAB","USA"],{errorMap:()=>({message:"Invalid lead type"})}),lead_status:N.enum(["New","In Progress","Completed","On Hold","Lost"],{errorMap:()=>({message:"Invalid lead status"})})}),Ie=({followup:s,setFollowup:p})=>{const[n,l]=f.useState({}),a=["AB","BC","BDS","CA","DPD MAGMA","MB","ON","Super Leads","TBAB","USA"],i=["New","In Progress","Completed","On Hold","Lost"],t=(c,d)=>{const x=E.sanitize(d);let u="";const g={...s,[c]:x},m=Pe.safeParse(g);if(!m.success){const o=m.error.errors.find(h=>h.path[0]===c);u=o?o.message:""}l(o=>({...o,[c]:u})),p(g)},r=[{label:"Lead#",key:"lead_no",type:"text",placeholder:"Enter lead#",required:!0},{label:"Lead Date",key:"lead_date",type:"date",placeholder:"Enter lead date",required:!0},{label:"Customer Name",key:"customer_name",placeholder:"Enter customer name"},{label:"Phone",key:"phone",type:"text",placeholder:"Enter phone number"},{label:"Email",key:"email",type:"text",placeholder:"Enter email"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Lead Info"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[r.map(({label:c,key:d,type:x,placeholder:u,required:g})=>e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:d,children:[c," ",g&&e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsx("input",{type:x,id:d,placeholder:u,value:s[d]||"",onChange:m=>t(d,m.target.value)}),n[d]&&e.jsx("span",{className:"error",style:{color:"red"},children:n[d]})]},d)),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"lead_type",children:["Lead Type ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"lead_type",value:s.lead_type||"",onChange:c=>p(d=>({...d,lead_type:c.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Lead Type"}),a.map(c=>e.jsx("option",{value:c,children:c},c))]}),n.lead_type&&e.jsx("span",{className:"error",style:{color:"red"},children:n.lead_type})]}),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"lead_status",children:["Lead Status ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"lead_status",value:s.lead_status||"",onChange:c=>p(d=>({...d,lead_status:c.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Lead Status"}),i.map(c=>e.jsx("option",{value:c,children:c},c))]}),n.lead_status&&e.jsx("span",{className:"error",style:{color:"red"},children:n.lead_status})]})]})]})},Le=N.object({address:N.string().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),city:N.string().max(200,"City name is too long").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),state:N.string().max(200,"Invalid state").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),country:N.string().max(100,"Invalid country").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),postal_code:N.string().max(20,"Postal code cannot exceed 20 characters").regex(/^[a-zA-Z0-9-\s ]*$/,"Invalid postal code").optional(),unit_no:N.string().max(20,"Unit no. cannot exceed 20 characters").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid unit no. format").optional()}),Ee=({followup:s,setFollowup:p})=>{const[n,l]=f.useState({}),i=le(c=>{const d=x=>{var u,g;return((g=(u=c.address_components)==null?void 0:u.find(m=>m.types.includes(x)))==null?void 0:g.long_name)||""};p(x=>({...x,address:`${d("street_number")} ${d("route")}`.trim(),city:d("locality"),state:d("administrative_area_level_1"),country:d("country"),postal_code:d("postal_code")}))}),t=(c,d)=>{const x=E.sanitize(d);let u="";const g={...s,[c]:x},m=Le.safeParse(g);if(!m.success){const o=m.error.errors.find(h=>h.path[0]===c);u=o?o.message:""}l(o=>({...o,[c]:u})),p(g)},r=[{label:"Address",key:"address",placeholder:"Enter street address"},{label:"City",key:"city",placeholder:"Enter city name"},{label:"State",key:"state",placeholder:"Enter state"},{label:"Country",key:"country",placeholder:"Enter country"},{label:"Postal Code",key:"postal_cide",placeholder:"Enter postal code"},{label:"Unit No.",key:"unit_no",placeholder:"Enter unit number"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Address Details"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:r.map(({label:c,key:d,placeholder:x})=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:d,children:c}),e.jsx("input",{type:"text",id:d,placeholder:x,value:s[d]||"",onChange:u=>t(d,u.target.value),ref:d==="address"?i:void 0}),n[d]&&e.jsx("span",{className:"error",style:{color:"red"},children:n[d]})]},d))})]})},ke=N.object({next_follow_up_date:N.string().optional(),contact_person:N.string().max(200,"Contact name must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),equipment:N.enum(["Van","Reefer","Flatbed","Triaxle","Maxi","Btrain","Roll tite"],{errorMap:()=>({message:"Invalid equipment type"})}),notes:N.string().max(500,"Notes must be at most 500 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional()}),$e=({followup:s,setFollowup:p})=>{const[n,l]=f.useState({}),a=(t,r)=>{const c=E.sanitize(r);let d="";const x={...s,[t]:c},u=ke.safeParse(x);if(!u.success){const g=u.error.errors.find(m=>m.path[0]===t);d=g?g.message:""}l(g=>({...g,[t]:d})),p(x)},i=[{label:"Next Follow-Up Date",key:"next_follow_up_date",type:"date",placeholder:"Enter follow-up date"},{label:"Contact Person",key:"contact_person",type:"text",placeholder:"Enter contact person"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Additional Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[i.map(({label:t,key:r,type:c,placeholder:d})=>e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:r,children:t}),e.jsx("input",{type:c,id:r,placeholder:d,value:s[r]||"",onChange:x=>a(r,x.target.value)}),n[r]&&e.jsx("span",{className:"error",style:{color:"red"},children:n[r]})]},r)),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"equipmentType",children:"Equipment Type"}),e.jsxs("select",{id:"equipmentType",value:s.equipment||"",onChange:t=>p(r=>({...r,equipment:t.target.value})),children:[e.jsx("option",{value:"",children:"Select Equipment Type"}),e.jsx("option",{value:"Van",children:"Van"}),e.jsx("option",{value:"Reefer",children:"Reefer"}),e.jsx("option",{value:"Flatbed",children:"Flatbed"}),e.jsx("option",{value:"Triaxle",children:"Triaxle"}),e.jsx("option",{value:"Maxi",children:"Maxi"}),e.jsx("option",{value:"Btrain",children:"Btrain"}),e.jsx("option",{value:"Roll tite",children:"Roll tite"})]}),n.equipment&&e.jsx("span",{className:"error",style:{color:"red"},children:n.equipment})]})]}),e.jsx("div",{className:"form-row",style:{display:"flex"},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",placeholder:"Enter notes",value:s.notes||"",onChange:t=>a("notes",t.target.value),style:{width:"100%",minHeight:"100px"}}),n.notes&&e.jsx("span",{className:"error",style:{color:"red"},children:n.notes})]})})]})},G="https://linkloadsapiprod.onrender.com/api",De=(s,p)=>{const n={id:0,lead_no:"",lead_date:"",customer_name:"",phone:"",email:"",address:"",unit_no:"",city:"",state:"",country:"",postal_code:"",lead_type:"",contact_person:"",notes:"",lead_status:"",next_follow_up_date:"",followup_type:"",equipment:"",remarks:"",contacts:[],products:[],created_at:"",updated_at:""},[l,a]=f.useState(n),i=()=>!!l.lead_no&&!!l.lead_date&&!!l.lead_type&&!!l.lead_status,t=async o=>{if(o.preventDefault(),!i()){A.fire("Validation Error","Please fill in all required fields.","error");return}try{const h=localStorage.getItem("token");if(!h){A.fire("Error","No token found","error");return}const j={Authorization:`Bearer ${h}`},y=l.id?await P.put(`${G}/lead-followup/${l.id}`,l,{headers:j}):await P.post(`${G}/lead-followup`,l,{headers:j});A.fire("Success","Follow-up data has been saved successfully.","success"),r(),p()}catch(h){console.error("Error saving/updating followup:",h),A.fire("Error","An error occurred while saving/updating the followup.","error")}},r=()=>{a({id:0,lead_no:"",lead_date:"",customer_name:"",phone:"",email:"",address:"",unit_no:"",city:"",state:"",country:"",postal_code:"",lead_type:"",contact_person:"",notes:"",lead_status:"",next_follow_up_date:"",followup_type:"",equipment:"",remarks:"",contacts:[],products:[],created_at:"",updated_at:""})};return{followup:l,setFollowup:a,handleAddContact:()=>{a(o=>({...o,contacts:[...o.contacts,{name:"",phone:"",email:""}]}))},handleRemoveContact:o=>{a(h=>({...h,contacts:h.contacts.filter((j,y)=>y!==o)}))},handleContactChange:(o,h)=>{const j=l.contacts.map((y,F)=>F===o?h:y);a(y=>({...y,contacts:j}))},handleAddProduct:()=>{a(o=>({...o,products:[...o.products,{name:"",quantity:""}]}))},handleRemoveProduct:o=>{a(h=>({...h,products:h.products.filter((j,y)=>y!==o)}))},handleProductChange:(o,h)=>{const j=l.products.map((y,F)=>F===o?h:y);a(y=>({...y,products:j}))},handleSubmit:t,clearFollowupForm:r}},qe=({onClose:s,onSuccess:p})=>{const{followup:n,setFollowup:l,handleAddContact:a,handleRemoveContact:i,handleContactChange:t,handleAddProduct:r,handleRemoveProduct:c,handleProductChange:d,handleSubmit:x}=De(s,p);return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:x,className:"form-main",children:[e.jsx(Ie,{followup:n,setFollowup:l}),e.jsx(Ee,{followup:n,setFollowup:l}),e.jsx($e,{followup:n,setFollowup:l}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:n.contacts.map((u,g)=>e.jsx(Q,{contacts:n.contacts,index:g,onAddContact:a,handleContactChange:t,handleRemoveContact:i},g))}),n.contacts.length===0&&e.jsx("button",{type:"button",onClick:a,className:"add-button",children:e.jsx(I,{})})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Products"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:n.products.map((u,g)=>e.jsx(Y,{products:n.products,index:g,onAddProduct:r,handleProductChange:d,handleRemoveProduct:c},g))}),n.products.length===0&&e.jsx("button",{type:"button",onClick:r,className:"add-button",children:e.jsx(I,{})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Create Follow-up"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:s,children:"Cancel"})]})]})})},Ze=()=>{const{fetchFollowUps:s,followUps:p,loading:n,searchQuery:l,setSearchQuery:a,sortBy:i,sortDesc:t,selectedIds:r,paginatedData:c,totalPages:d,currentPage:x,isAddModalOpen:u,isEditModalOpen:g,isViewModalOpen:m,selectedFollowup:o,setAddModalOpen:h,openEditModal:j,closeEditModal:y,openViewModal:F,closeViewModal:S,toggleSelectAll:L,toggleSelect:V,deleteSelected:$,handleSort:k,updateFollowup:D,handlePageChange:q}=we(),z=b=>b.key==="checkbox"||b.key==="actions"?b.label:e.jsxs("div",{className:"sortable-header",onClick:()=>k(b.key),children:[b.label,e.jsx("span",{className:"sort-icon",children:i===b.key?t?"▼":"▲":"▼"})]}),R=[{key:"checkbox",label:e.jsx("input",{type:"checkbox",onChange:L,checked:r.length===c.length&&c.length>0}),render:b=>e.jsx("input",{type:"checkbox",checked:r.includes(b.id),onChange:()=>V(b.id)})},{key:"lead_no",label:"Lead#"},{key:"lead_date",label:"Date"},{key:"customer_name",label:"Customer Name"},{key:"phone",label:"Phone"},{key:"email",label:"Email"},{key:"lead_type",label:"Lead Type"},{key:"lead_status",label:"Status",render:b=>e.jsx("span",{className:`badge ${T(b.lead_status)}`,children:b.lead_status})},{key:"actions",label:"Actions",render:b=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>F(b),className:"btn-view",children:e.jsx(re,{})}),e.jsx("button",{onClick:()=>j(b),className:"btn-edit",children:e.jsx(se,{})})]})}],T=b=>{switch(b){case"New":return"badge-new";case"In Progress":return"badge-in-progress";case"Completed":return"badge-completed";case"On Hold":return"badge-on-hold";case"Lost":return"badge-lost";default:return"badge-default"}};return e.jsxs("div",{children:[e.jsxs("div",{className:"header-container",children:[e.jsx("h1",{className:"page-heading",children:"Lead Follow-ups"}),e.jsxs("div",{className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(ne,{className:"search-icon"}),e.jsx("input",{className:"search-bar",value:l,onChange:b=>a(b.target.value)})]}),e.jsxs("button",{onClick:()=>h(!0),className:"add-button",children:[e.jsx(I,{})," New"]})]})]}),r.length>0&&e.jsxs("div",{className:"selection-banner",children:[e.jsxs("span",{children:[r.length," item",r.length>1?"s":""," selected"]}),e.jsxs("button",{className:"text-delete-btn",onClick:$,children:[e.jsx(O,{}),"  Delete"]})]}),n?e.jsx("div",{children:"Loading..."}):p.length===0?e.jsx("div",{children:"No records found"}):e.jsx(te,{data:c,headers:R.map(b=>({...b,label:z(b)})),handleSort:k,sortBy:i,sortDesc:t}),e.jsx(ae,{currentPage:x,totalPages:d,onPageChange:q}),e.jsx(M,{isOpen:u,onClose:()=>h(!1),title:"Add Followup",children:e.jsx(qe,{onClose:()=>h(!1),onSuccess:s})}),e.jsx(M,{isOpen:g,onClose:y,title:"Edit Followup",children:o&&e.jsx(ye,{followup:o,onClose:y,onUpdate:D})}),e.jsx(M,{isOpen:m,onClose:S,title:"Follow-up Details",children:o&&e.jsx(Se,{followUp:o,onClose:S})})]})};export{Ze as L};

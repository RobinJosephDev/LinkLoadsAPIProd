import{r as g,j as e,b as D,S as w}from"./index-Dd33HN3-.js";import{R as Z,a as G,b as X,T as ee,M as U}from"./Modal-mZ12kiPk.js";/* empty css             */import{z as u,P as se}from"./Pagination-Cp7cgeW5.js";import B from"./purify.es-Ci5xwkH_.js";import{u as te}from"./useGoogleAutocomplete-CdP8wscP.js";import{u as ae,d as Y}from"./useEditLead-B5xo4DYG.js";import{R as Q}from"./CalendarOutlined-D--vMc67.js";import{o as le,R as re}from"./EyeOutlined-yrfy-ixN.js";const oe=u.object({name:u.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]+$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),phone:u.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),email:u.string().max(255,"Email must be at most 255 characters").email("Invalid email format").optional()}),ne=({contacts:s,index:d,handleContactChange:o,handleRemoveContact:f,onAddContact:x})=>{const j=s[d]??{},[n,c]=g.useState({}),m=g.useCallback((l,r)=>{const h=B.sanitize(r);let i="";const y={...j,[l]:h},_=oe.safeParse(y);if(!_.success){const N=_.error.errors.find(C=>C.path[0]===l);i=N?N.message:""}c(N=>({...N,[l]:i})),o(d,y)},[j,o,d]),t=[{label:"Name",key:"name",type:"text",placeholder:"Enter name"},{label:"Phone",key:"phone",type:"tel",placeholder:"Enter phone"},{label:"Email",key:"email",type:"email",placeholder:"Enter email"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.map(({label:l,key:r,type:h,placeholder:i})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${r}-${d}`,children:l}),e.jsx("input",{id:`${r}-${d}`,type:h,name:r,value:j[r]||"",onChange:y=>m(r,y.target.value),placeholder:i}),n[r]&&e.jsx("span",{className:"error",style:{color:"red"},children:n[r]})]},r)),e.jsxs("div",{className:"action-buttons-row",style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:x,className:"add-btn",children:e.jsx(Z,{})}),e.jsx("button",{type:"button",onClick:()=>f(d),className:"delete-button",children:e.jsx(G,{})})]})]})},ie=u.object({lead_no:u.string().max(200,"Legal No must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),lead_date:u.string().min(1,"Lead Date is required").regex(/^\d{2}-\d{2}-\d{4}$/,{message:"Date must be in DD-MM-YYYY format"}).optional(),customer_name:u.string().max(200,"Customer Name must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),phone:u.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),email:u.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),website:u.string().max(255,"Website must be at most 255 characters long").url("Invalid website URL").optional(),lead_type:u.enum(["AB","BC","BDS","CA","DPD MAGMA","MB","ON","Super Leads","TBAB","USA"],{errorMap:()=>({message:"Invalid lead type"})}),lead_status:u.enum(["Prospect","Lanes discussed","Prod/Equip noted","E-mail sent","Portal registration","Quotations","Fob/Have broker","VM/No answer","Diff Dept.","No reply","Not Int.","Asset based"],{errorMap:()=>({message:"Invalid lead status"})})}),ce=({formLead:s,setFormLead:d})=>{const[o,f]=g.useState({}),x=(n,c)=>{const m=B.sanitize(c);let t="",l=m;if(n==="lead_date"&&/^\d{4}-\d{2}-\d{2}$/.test(m)){const[i,y,_]=m.split("-");l=`${_}-${y}-${i}`}const r={...s,[n]:l},h=ie.safeParse(r);if(!h.success){const i=h.error.errors.find(y=>y.path[0]===n);t=i?i.message:""}f(i=>({...i,[n]:t})),d(i=>({...i,[n]:m}))},j=[{label:"Lead#",key:"lead_no",type:"text",placeholder:"Enter lead#",required:!0},{label:"Lead Date",key:"lead_date",type:"date",placeholder:"Enter lead date",required:!0},{label:"Customer Name",key:"customer_name",placeholder:"Enter customer name"},{label:"Phone",key:"phone",type:"text",placeholder:"Enter phone number"},{label:"Email",key:"email",type:"text",placeholder:"Enter email"},{label:"Website",key:"website",type:"text",placeholder:"Enter website URL"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Lead Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[j.map(({label:n,key:c,type:m,placeholder:t,required:l})=>e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:c,children:[n," ",l&&e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsx("input",{type:m,id:c,placeholder:t,value:s[c]||"",onChange:r=>x(c,r.target.value)}),o[c]&&e.jsx("span",{className:"error",style:{color:"red"},children:o[c]})]},c)),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"lead_type",children:["Lead Type ",e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsxs("select",{id:"lead_type",value:s.lead_type||"",onChange:n=>d(c=>({...c,lead_type:n.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Lead Type"}),e.jsx("option",{value:"AB",children:"AB"}),e.jsx("option",{value:"BC",children:"BC"}),e.jsx("option",{value:"BDS",children:"BDS"}),e.jsx("option",{value:"CA",children:"CA"}),e.jsx("option",{value:"DPD MAGMA",children:"DPD MAGMA"}),e.jsx("option",{value:"MB",children:"MB"}),e.jsx("option",{value:"ON",children:"ON"}),e.jsx("option",{value:"Super Leads",children:"Super Leads"}),e.jsx("option",{value:"TBAB",children:"TBAB"}),e.jsx("option",{value:"USA",children:"USA"})]}),o.lead_type&&e.jsx("span",{className:"error",style:{color:"red"},children:o.lead_type})]}),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"lead_status",children:["Lead Status ",e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsxs("select",{id:"lead_status",value:s.lead_status||"",onChange:n=>d(c=>({...c,lead_status:n.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Lead Status"}),e.jsx("option",{value:"Prospect",children:"Prospect"}),e.jsx("option",{value:"Lanes discussed",children:"Lanes discussed"}),e.jsx("option",{value:"Prod/Equip noted",children:"Prod/Equip noted"}),e.jsx("option",{value:"E-mail sent",children:"E-mail sent"}),e.jsx("option",{value:"Portal registration",children:"Portal registration"}),e.jsx("option",{value:"Quotations",children:"Quotations"}),e.jsx("option",{value:"Fob/Have broker",children:"Fob/Have broker"}),e.jsx("option",{value:"VM/No answer",children:"VM/No answer"}),e.jsx("option",{value:"Diff Dept.",children:"Diff Dept."}),e.jsx("option",{value:"No reply",children:"No reply"}),e.jsx("option",{value:"Not Int.",children:"Not Int."}),e.jsx("option",{value:"Asset based",children:"Asset based"})]}),o.lead_status&&e.jsx("span",{className:"error",style:{color:"red"},children:o.lead_status})]})]})]})},de=u.object({address:u.string().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),city:u.string().max(200,"City name is too long").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),state:u.string().max(200,"Invalid state").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),country:u.string().max(100,"Invalid country").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),postal_code:u.string().max(20,"Postal code cannot exceed 20 characters").regex(/^[a-zA-Z0-9-\s ]*$/,"Invalid postal code").optional(),unit_no:u.string().max(20,"Unit no. cannot exceed 20 characters").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid unit no. format").optional()}),me=({formLead:s,setFormLead:d})=>{const[o,f]=g.useState({}),j=te(m=>{const t=l=>{var r,h;return((h=(r=m.address_components)==null?void 0:r.find(i=>i.types.includes(l)))==null?void 0:h.long_name)||""};d(l=>({...l,address:`${t("street_number")} ${t("route")}`.trim(),city:t("locality"),state:t("administrative_area_level_1"),country:t("country"),postal_code:t("postal_code")}))}),n=(m,t)=>{const l=B.sanitize(t);let r="";const h={...s,[m]:l},i=de.safeParse(h);if(!i.success){const y=i.error.errors.find(_=>_.path[0]===m);r=y?y.message:""}f(y=>({...y,[m]:r})),d(h)},c=[{label:"Address",key:"address",placeholder:"Enter street address"},{label:"City",key:"city",placeholder:"Enter city name"},{label:"State",key:"state",placeholder:"Enter state"},{label:"Country",key:"country",placeholder:"Enter country"},{label:"Postal Code",key:"postal_code",placeholder:"Enter postal code"},{label:"Unit No.",key:"unit_no",placeholder:"Enter unit number"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Address Details"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:c.map(({label:m,key:t,placeholder:l})=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:t,children:m}),e.jsx("input",{type:"text",id:t,placeholder:l,value:s[t]||"",onChange:r=>n(t,r.target.value),ref:t==="address"?j:void 0}),o[t]&&e.jsx("span",{className:"error",style:{color:"red"},children:o[t]})]},t))})]})},pe=u.object({follow_up_date:u.string().regex(/^\d{2}-\d{2}-\d{4}$/,{message:"Date must be in DD-MM-YYYY format"}).optional(),contact_person:u.string().max(200,"Contact name must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),lead_type:u.enum(["AB","BC","BDS","CA","DPD MAGMA","MB","ON","Super Leads","TBAB","USA"],{errorMap:()=>({message:"Invalid lead type"})}),equipment_type:u.enum(["Van","Reefer","Flatbed","Triaxle","Maxi","Btrain","Roll tite"],{errorMap:()=>({message:"Invalid equipment type"})}).optional(),assigned_to:u.string().min(1,"Assigned To is required").max(200,"Assigned To must be at most 200 characters long").regex(/^[a-zA-Z\s'-]+$/,"Only letters, spaces, apostrophes, and hyphens allowed").optional(),notes:u.string().max(500,"Notes must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional()}),he=({formLead:s,setFormLead:d})=>{const[o,f]=g.useState({}),x="https://linkloadsapiprod.onrender.com/api",[j,n]=g.useState([]);g.useEffect(()=>{(async()=>{var l,r;try{const h=localStorage.getItem("token");if(!h)throw new Error("No token found. Please log in.");const y=(await D.get(`${x}/user`,{headers:{Authorization:`Bearer ${h}`}})).data.filter(_=>_.role==="employee");n(y)}catch(h){console.error("Error fetching users:",h),w.fire({icon:"error",title:((l=h.response)==null?void 0:l.status)===401?"Unauthorized":"Error",text:((r=h.response)==null?void 0:r.status)===401?"You are not authorized to view this data. Please log in again.":"An error occurred while fetching users. Please try again."})}})()},[x]);const c=(t,l)=>{const r=B.sanitize(l);let h="",i=r;if(t==="follow_up_date"&&/^\d{4}-\d{2}-\d{2}$/.test(r)){const[N,C,M]=r.split("-");i=`${M}-${C}-${N}`}const y={...s,[t]:i},_=pe.safeParse(y);if(!_.success){const N=_.error.errors.find(C=>C.path[0]===t);h=N?N.message:""}f(N=>({...N,[t]:h})),d(N=>({...N,[t]:r}))},m=[{label:"Next Follow-Up Date",key:"follow_up_date",type:"date",placeholder:"Enter follow-up date"},{label:"Contact Person",key:"contact_person",type:"text",placeholder:"Enter contact person"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Additional Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[m.map(({label:t,key:l,type:r,placeholder:h})=>e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:l,children:t}),e.jsx("input",{type:r,id:l,placeholder:h,value:s[l]||"",onChange:i=>c(l,i.target.value)}),o[l]&&e.jsx("span",{className:"error",style:{color:"red"},children:o[l]})]},l)),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"equipmentType",children:"Equipment Type"}),e.jsxs("select",{id:"equipmentType",value:s.equipment_type||"",onChange:t=>d(l=>({...l,equipment_type:t.target.value})),children:[e.jsx("option",{value:"",children:"Select Equipment Type"}),e.jsx("option",{value:"Van",children:"Van"}),e.jsx("option",{value:"Reefer",children:"Reefer"}),e.jsx("option",{value:"Flatbed",children:"Flatbed"}),e.jsx("option",{value:"Triaxle",children:"Triaxle"}),e.jsx("option",{value:"Maxi",children:"Maxi"}),e.jsx("option",{value:"Btrain",children:"Btrain"}),e.jsx("option",{value:"Roll tite",children:"Roll tite"})]}),o.equipment_type&&e.jsx("span",{className:"error",style:{color:"red"},children:o.equipment_type})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"assignedTo",children:"Assigned To"}),e.jsxs("select",{id:"assignedTo",value:s.assigned_to,onChange:t=>c("assigned_to",t.target.value),children:[e.jsx("option",{value:"",children:"Select Employee"}),j.map(t=>e.jsx("option",{value:t.name,children:t.name},t.name))]}),o.assigned_to&&e.jsx("span",{className:"error",style:{color:"red"},children:o.assigned_to})]})]}),e.jsx("div",{className:"form-row",style:{display:"flex"},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",placeholder:"Enter notes",value:s.notes||"",onChange:t=>c("notes",t.target.value),style:{width:"100%",minHeight:"100px"}}),o.notes&&e.jsx("span",{className:"error",style:{color:"red"},children:o.notes})]})})]})},ue=({lead:s,onClose:d,onUpdate:o})=>{const{formLead:f,setFormLead:x,updateLead:j,handleAddContact:n,handleRemoveContact:c,handleContactChange:m}=ae(s,d,o);return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:t=>{t.preventDefault(),j()},className:"form-main",children:[e.jsx(ce,{formLead:f,setFormLead:x}),e.jsx(me,{formLead:f,setFormLead:x}),e.jsx(he,{formLead:f,setFormLead:x}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",children:[f.contacts.map((t,l)=>e.jsx(ne,{contacts:f.contacts,index:l,onAddContact:n,handleContactChange:m,handleRemoveContact:c},l)),f.contacts.length===0&&e.jsx("button",{type:"button",onClick:n,className:"add-btn",children:e.jsx(Z,{})})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Save"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:d,children:"Cancel"})]})]})})},xe=({formLead:s})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Lead Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadNo",children:"Lead No"}),e.jsx("div",{children:s.lead_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadDate",children:"Lead Date"}),e.jsx("div",{children:s.lead_date||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"customerName",children:"Customer Name"}),e.jsx("div",{children:s.customer_name||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"phone",children:"Phone"}),e.jsx("div",{children:s.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("div",{children:s.email||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"website",children:"Website"}),e.jsx("div",{children:s.website||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadType",children:"Lead Type"}),e.jsx("div",{children:s.lead_type||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadStatus",children:"Lead Status"}),e.jsx("div",{children:s.lead_status||"N/A"})]})]})]}),ge=({formLead:s})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Address Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"address",children:"Address"}),e.jsx("div",{children:s.address||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"unitNo",children:"Unit No"}),e.jsx("div",{children:s.unit_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"city",children:"City"}),e.jsx("div",{children:s.city||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"state",children:"State"}),e.jsx("div",{children:s.state||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"country",children:"Country"}),e.jsx("div",{children:s.country||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"postalCode",children:"Postal Code"}),e.jsx("div",{children:s.postal_code||"N/A"})]})]})]}),fe=({formLead:s})=>{const d="https://linkloadsapiprod.onrender.com/api",[o,f]=g.useState([]);return g.useEffect(()=>{(async()=>{var j;try{const n=localStorage.getItem("token");if(!n)throw new Error("No token found. Please log in.");const m=(await D.get(`${d}/user`,{headers:{Authorization:`Bearer ${n}`}})).data.filter(t=>t.role==="employee");f(m)}catch(n){console.error("Error fetching users:",n),((j=n.response)==null?void 0:j.status)===401?w.fire({icon:"error",title:"Unauthorized",text:"You are not authorized to view this data. Please log in again."}):w.fire({icon:"error",title:"Error",text:"An error occurred while fetching users. Please try again."})}})()},[]),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Additional Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"follow_up_date",children:"Next Follow-Up Date"}),e.jsx("div",{children:s.follow_up_date||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"equipmentType",children:"Equipment Type"}),e.jsx("div",{children:s.equipment_type||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"assignedTo",children:"Assigned To"}),e.jsx("div",{children:s.assigned_to||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"contactPerson",children:"Contact Person"}),e.jsx("div",{children:s.contact_person||"N/A"})]})]}),e.jsx("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("div",{children:s.notes||"N/A"})]})})]})},je=({contact:s,index:d,onRemove:o})=>e.jsxs("div",{className:"contact-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:s.name||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:s.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:s.email||"N/A"})]})]}),ye=({lead:s,onClose:d})=>{const[o,f]=g.useState({id:0,lead_no:"",lead_date:"",customer_name:"",phone:"",email:"",website:"",address:"",unit_no:"",city:"",state:"",country:"",postal_code:"",equipment_type:"",lead_type:"",lead_status:"",contact_person:"",notes:"",follow_up_date:"",assigned_to:"",contacts:[]});return g.useEffect(()=>{if(s){let x=[];if(Array.isArray(s.contacts))x=s.contacts;else if(typeof s.contacts=="string")try{x=JSON.parse(s.contacts)||[]}catch{x=[]}f({...s,contacts:x.length>0?x:[]})}},[s]),e.jsx("div",{className:"form-container",children:e.jsxs("form",{className:"form-main",children:[e.jsx(xe,{formLead:o}),e.jsx(ge,{formLead:o}),e.jsx(fe,{formLead:o}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:o.contacts&&o.contacts.map((x,j)=>e.jsx(je,{contact:x,index:j},j))})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"button",className:"btn-cancel",onClick:d,style:{padding:"9px 15px"},children:"Cancel"})})]})})},k="https://linkloadsapiprod.onrender.com/api",ve=()=>{const[s,d]=g.useState([]),[o,f]=g.useState(!0),[x,j]=g.useState(""),[n,c]=g.useState("created_at"),[m,t]=g.useState(!0),[l,r]=g.useState(1),[h,i]=g.useState(null),[y,_]=g.useState(!1),[N,C]=g.useState(!1),[M,$]=g.useState(!1),[S,E]=g.useState([]),[F,R]=g.useState(10),I=async()=>{try{const a=localStorage.getItem("token");if(!a)throw new Error("No token found");f(!0);const{data:b}=await D.get(`${k}/lead`,{headers:{Authorization:`Bearer ${a}`}}),v=b.filter(A=>A.lead_status==="Quotations");d(v)}catch(a){console.error("Error loading leads:",a),L(a)}finally{f(!1)}};g.useEffect(()=>{I()},[]);const L=a=>{a.response&&a.response.status===401&&w.fire({icon:"error",title:"Unauthorized",text:"You need to log in to access this resource."})},p=a=>{n===a?t(!m):(c(a),t(!1))},V=s.filter(a=>Object.values(a).some(b=>b!=null&&b.toString().toLowerCase().includes(x.toLowerCase()))),z=V.sort((a,b)=>{let v=a[n]??"",A=b[n]??"";return typeof v=="string"&&typeof A=="string"?m?A.localeCompare(v):v.localeCompare(A):typeof v=="number"&&typeof A=="number"?m?A-v:v-A:0}).slice((l-1)*F,l*F),H=Math.ceil(V.length/F);return{fetchLeads:I,leads:s,loading:o,convertToCustomer:async a=>{var v,A,q;if((await w.fire({title:"Are you sure?",text:"This lead will be converted to a customer.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, convert it!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const P=localStorage.getItem("token");if(!P)throw new Error("No token found");const W=a.contacts.map(T=>({name:T.name||"",phone:T.phone||"",email:T.email||"",ext:"",fax:"",designation:""})),O={cust_name:a.customer_name||"",cust_email:a.email||"",cust_primary_state:a.state||"",cust_primary_city:a.city||"",cust_primary_address:a.address||"",cust_primary_postal:a.postal_code||"",cust_contact:W,cust_website:a.website||"",sameAsPrimary:!0,cust_ap_name:a.contact_person||"",cust_ap_email:a.email||"",cust_ap_phone:a.phone||"",cust_credit_application:!1,cust_equipment:[{equipment:a.equipment_type||""}]};console.log("Customer data to insert:",O);const J=await D.post(`${k}/customer`,O,{headers:{Authorization:`Bearer ${P}`}});console.log("Customer created:",J.data),await D.delete(`${k}/lead/${a.id}`,{headers:{Authorization:`Bearer ${P}`}}),console.log("Lead deleted:",a.id),d(T=>T.filter(K=>K.id!==a.id)),w.fire("Converted!","The lead has been converted to a customer.","success")}catch(P){console.error("Error converting lead to customer:",((v=P.response)==null?void 0:v.data)||P.message),w.fire({icon:"error",title:"Error!",text:`Failed to convert the lead. ${((q=(A=P.response)==null?void 0:A.data)==null?void 0:q.error)||""}`})}},searchQuery:x,setSearchQuery:j,sortBy:n,sortDesc:m,selectedIds:S,setSelectedIds:E,paginatedData:z,totalPages:H,currentPage:l,setCurrentPage:r,isEditModalOpen:y,isAddModalOpen:N,isViewModalOpen:M,selectedLead:h,openEditModal:a=>{i(a),_(!0)},closeEditModal:()=>{_(!1),i(null)},openViewModal:a=>{i(a),$(!0)},closeViewModal:()=>{$(!1),i(null)},setEditModalOpen:_,setAddModalOpen:C,setViewModalOpen:$,toggleSelectAll:()=>{S.length===z.length?E([]):E(z.map(a=>a.id))},toggleSelect:a=>{E(b=>b.includes(a)?b.filter(v=>v!==a):[...b,a])},deleteSelected:async()=>{if(S.length===0){w.fire({icon:"warning",title:"No record selected",text:"Please select a record to delete."});return}if((await w.fire({title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete selected!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const b=localStorage.getItem("token");if(!b)throw new Error("No token found");await Promise.all(S.map(v=>D.delete(`${k}/lead/${v}`,{headers:{Authorization:`Bearer ${b}`}}))),d(v=>v.filter(A=>!S.includes(A.id))),E([]),w.fire("Deleted!","Selected leads have been deleted.","success")}catch(b){console.error("Error deleting leads:",b),w.fire({icon:"error",title:"Error!",text:"Failed to delete selected leads."})}},handleSort:p,updateLead:a=>{d(b=>b.map(v=>v.id===a.id?{...v,...a}:v))},handlePageChange:a=>{r(a)}}},be=()=>{const{leads:s,loading:d,convertToCustomer:o,searchQuery:f,setSearchQuery:x,sortBy:j,sortDesc:n,selectedIds:c,paginatedData:m,totalPages:t,currentPage:l,isEditModalOpen:r,isViewModalOpen:h,selectedLead:i,openEditModal:y,openViewModal:_,setEditModalOpen:N,setViewModalOpen:C,toggleSelectAll:M,toggleSelect:$,deleteSelected:S,handleSort:E,updateLead:F,handlePageChange:R}=ve(),I=p=>p.key==="checkbox"||p.key==="actions"?p.label:e.jsxs("div",{className:"sortable-header",onClick:()=>E(p.key),children:[p.label,e.jsx("span",{className:"sort-icon",children:j===p.key?n?"▼":"▲":"▼"})]}),L=[{key:"checkbox",label:e.jsx("input",{type:"checkbox",onChange:M,checked:c.length===m.length&&m.length>0}),render:p=>e.jsx("input",{type:"checkbox",checked:c.includes(p.id),onChange:()=>$(p.id)})},{key:"lead_no",label:"Lead#"},{key:"customer_name",label:"Name"},{key:"lead_date",label:"Date",render:p=>e.jsxs("div",{className:"date-picker-container-normal",children:[e.jsx(Q,{style:{marginRight:5}}),p.lead_date?Y(p.lead_date).format("DD MMM, YYYY"):"-"]})},{key:"city",label:"City"},{key:"lead_type",label:"Type"},{key:"assigned_to",label:"Assigned To",render:p=>e.jsx("span",{children:p.assigned_to||"Unassigned"})},{key:"follow_up_date",label:"Follow Up",render:p=>e.jsxs("div",{className:"date-picker-container",children:[e.jsx(Q,{style:{marginRight:5}}),p.follow_up_date?Y(p.follow_up_date).format("DD MMM, YYYY"):"-"]})},{key:"actions",label:"",render:p=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>_(p),className:"btn-view",children:e.jsx(le,{})}),e.jsx("button",{onClick:()=>y(p),className:"btn-edit",children:e.jsx(X,{})}),p.lead_status==="Quotations"&&e.jsx("button",{onClick:()=>o(p),className:"btn-convert",children:"Convert to Customer"})]})}];return e.jsxs("div",{children:[e.jsxs("div",{className:"header-container",children:[e.jsx("div",{className:"header-container-left",children:e.jsx("h1",{className:"page-heading",children:"Leads with quotes"})}),e.jsx("div",{className:"search-container",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(re,{className:"search-icon"}),e.jsx("input",{className:"search-bar",value:f,onChange:p=>x(p.target.value)})]})})]}),c.length>0&&e.jsxs("div",{className:"selection-banner",children:[e.jsxs("span",{children:[c.length," item",c.length>1?"s":""," selected"]}),e.jsxs("button",{className:"text-delete-btn",onClick:S,children:[e.jsx(G,{}),"  Delete"]})]}),d?e.jsx("div",{children:"Loading..."}):s.length===0?e.jsx("div",{className:"no-record",children:"No records found"}):e.jsx(ee,{data:m,headers:L.map(p=>({...p,label:I(p)})),handleSort:E,sortBy:j,sortDesc:n}),e.jsx(se,{currentPage:l,totalPages:t,onPageChange:R}),e.jsx(U,{isOpen:r,onClose:()=>N(!1),title:"Edit Lead",children:i&&e.jsx(ue,{lead:i,onClose:()=>N(!1),onUpdate:F})}),e.jsx(U,{isOpen:h,onClose:()=>C(!1),title:"Lead Details",children:i&&e.jsx(ye,{lead:i,onClose:()=>C(!1)})})]})},qe=()=>e.jsx("div",{children:e.jsx(be,{})});export{qe as default};

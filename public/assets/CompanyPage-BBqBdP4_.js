import{r as v,b as O,S as $,j as e,u as re}from"./index-Cbvw9UaN.js";import{R as P,a as Z,b as le,T as te,M as L}from"./Modal-BWB1UxEb.js";import F from"./purify.es-Ci5xwkH_.js";import{z as h,o as oe,b as ie,s as w,P as ce}from"./Pagination-CcGIvBBs.js";import{u as K}from"./useGoogleAutocomplete-Bc_iNf8a.js";/* empty css             */import{o as de,R as me}from"./EyeOutlined-CITt_E_k.js";import{R as pe}from"./MailOutlined-CCvmWzeJ.js";const Q="https://linkloadsapiprod.onrender.com/api",he=()=>{const[a,f]=v.useState([]),[x,s]=v.useState(!0),[u,r]=v.useState(""),[d,o]=v.useState("created_at"),[i,p]=v.useState(!0),[n,l]=v.useState(1),[g,j]=v.useState(null),[C,_]=v.useState(!1),[t,c]=v.useState(!1),[m,y]=v.useState([]),[b,E]=v.useState(!1),[I,z]=v.useState(!1),[R,Y]=v.useState(10),[B,q]=v.useState({subject:"",content:""}),U=async()=>{try{const N=localStorage.getItem("token");if(!N)throw new Error("No token found");s(!0);const{data:A}=await O.get(`${Q}/company`,{headers:{Authorization:`Bearer ${N}`}});f(A)}catch(N){console.error("Error loading companies:",N),M(N)}finally{s(!1)}};v.useEffect(()=>{U()},[]);const M=N=>{var A;((A=N.response)==null?void 0:A.status)===401&&$.fire({icon:"error",title:"Unauthorized",text:"You need to log in to access this resource."})},D=a.filter(N=>Object.values(N).some(A=>A&&A.toString().toLowerCase().includes(u.toLowerCase()))),V=D.sort((N,A)=>{let S=N[d]??"",T=A[d]??"";return typeof S=="string"&&typeof T=="string"?i?T.localeCompare(S):S.localeCompare(T):typeof S=="number"&&typeof T=="number"?i?T-S:S-T:0}).slice((n-1)*R,n*R),ne=Math.ceil(D.length/R);return{fetchCompanies:U,companies:a,loading:x,searchQuery:u,setSearchQuery:r,sortBy:d,sortDesc:i,selectedCompanies:m,setSelectedCompanies:y,paginatedData:V,totalPages:ne,currentPage:n,setCurrentPage:l,isEditModalOpen:C,isAddModalOpen:t,isViewModalOpen:b,isEmailModalOpen:I,selectedCompany:g,setEditModalOpen:_,setAddModalOpen:c,setViewModalOpen:E,setEmailModalOpen:z,toggleSelectAll:()=>{m.length===V.length?y([]):y(V.map(N=>N.id).filter(N=>N!==void 0))},toggleSelect:N=>{y(A=>A.includes(N)?A.filter(S=>S!==N):[...A,N])},deleteSelected:async()=>{if(!m.length){$.fire({icon:"warning",title:"No record selected",text:"Please select a record to delete."});return}if((await $.fire({title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete selected!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const A=localStorage.getItem("token");if(!A)throw new Error("No token found");await Promise.all(m.map(S=>O.delete(`${Q}/company/${S}`,{headers:{Authorization:`Bearer ${A}`}}))),f(S=>S.filter(T=>!m.includes(T.id))),y([]),$.fire("The selected companies have been deleted.","success")}catch(A){console.error("Error deleting companies:",A),$.fire({icon:"error",title:"Error!",text:"Failed to delete selected companies."})}},openEditModal:N=>{j(N),_(!0)},emailData:B,setEmailData:q,sendEmails:async()=>{if(m.length===0){$.fire({icon:"warning",title:"No companies selected",text:"Please select companies to send emails to."});return}try{const N=localStorage.getItem("token");if(!N)throw new Error("No token found");await O.post(`${Q}/email`,{ids:m,...B,module:"carriers"},{headers:{Authorization:`Bearer ${N}`,"Content-Type":"application/json"}}),$.fire("Success!","Emails have been sent.","success"),z(!1),y([])}catch(N){console.error("Error sending emails:",N),$.fire("Error!","Failed to send emails.","error")}},openViewModal:N=>{j(N),E(!0)},handleSort:N=>{d===N?p(!i):(o(N),p(!1))},updateCompany:N=>{f(A=>A.map(S=>S.id===N.id?{...S,...N}:S))},handlePageChange:N=>{l(N)}}},W="https://linkloadsapiprod.onrender.com/api",xe=(a,f,x)=>{const[s,u]=v.useState({id:0,name:"",invoice_terms:"",rate_conf_terms:"",quote_terms:"",invoice_reminder:"",address:"",city:"",state:"",country:"",postal:"",email:"",phone:"",cell:"",fax:"",invoice_prefix:"",SCAC:"",docket_no:"",carrier_code:"",gst_hst_no:"",qst_no:"",ca_bond_no:"",website:"",obsolete:!1,us_tax_id:"",payroll_no:"",wcb_no:"",dispatch_email:"",ap_email:"",ar_email:"",cust_comm_email:"",quot_email:"",bank_info:[],cargo_insurance:[],liablility_insurance:[],company_package:"",insurance:"",created_at:"",updated_at:""});v.useEffect(()=>{if(a){const t=Array.isArray(a.bank_info)?a.bank_info:JSON.parse(a.bank_info||"[]"),c=Array.isArray(a.cargo_insurance)?a.cargo_insurance:JSON.parse(a.cargo_insurance||"[]"),m=Array.isArray(a.liablility_insurance)?a.liablility_insurance:JSON.parse(a.liablility_insurance||"[]"),y={...a,bank_info:t.length>0?t:[],cargo_insurance:c.length>0?c:[],liablility_insurance:m.length>0?m:[]};u(y)}},[a]);const r=()=>!!s.name;return{formCompany:s,setFormCompany:u,updateCompany:async()=>{if(!r()){$.fire("Validation Error","Please fill in all required fields.","error");return}try{const t=localStorage.getItem("token");if(!t){$.fire({icon:"error",title:"Unauthorized",text:"You are not logged in. Please log in again."});return}const c={Authorization:`Bearer ${t}`},m=new FormData;Object.keys(s).forEach(b=>{const E=s[b];b==="obsolete"?m.append(b,E?"1":"0"):b!=="company_package"&&b!=="insurance"&&m.append(b,String(E||""))}),s.company_package&&s.company_package instanceof File&&m.append("company_package",s.company_package),s.insurance&&s.insurance instanceof File&&m.append("insurance",s.insurance);const y=s.id?await O.put(`${W}/company/${s.id}`,s,{headers:c}):await O.post(`${W}/company`,s,{headers:c});$.fire(s.id?"Success!":"Saved!","Company updated successfully.","success"),x(y.data),f()}catch(t){console.error("Error saving/updating company:",t.response?t.response.data:t.message),$.fire("Error","An error occurred while processing the company.","error")}},handleAddBank:()=>{u(t=>t&&{...t,bank_info:[...t.bank_info,{name:"",phone:"",email:"",address:"",us_account_no:"",cdn_account_no:""}]})},handleRemoveBank:t=>{u(c=>c&&{...c,bank_info:c.bank_info.filter((m,y)=>y!==t)})},handleBankChange:(t,c)=>{u(m=>m&&{...m,bank_info:m.bank_info.map((y,b)=>b===t?c:y)})},handleAddCargo:()=>{u(t=>({...t,cargo_insurance:[...t.cargo_insurance,{company:"",policy_start:"",policy_end:"",amount:""}]}))},handleRemoveCargo:t=>{u(c=>({...c,cargo_insurance:c.cargo_insurance.filter((m,y)=>y!==t)}))},handleCargoChange:(t,c)=>{const m=s.cargo_insurance.map((y,b)=>b===t?c:y);u(y=>({...y,cargo_insurance:m}))},handleAddLiability:()=>{u(t=>({...t,liablility_insurance:[...t.liablility_insurance,{company:"",policy_start:"",policy_end:"",amount:""}]}))},handleRemoveLiability:t=>{u(c=>({...c,liablility_insurance:c.liablility_insurance.filter((m,y)=>y!==t)}))},handleLiabilityChange:(t,c)=>{const m=s.liablility_insurance.map((y,b)=>b===t?c:y);u(y=>({...y,liablility_insurance:m}))}}},ue=h.object({name:h.string().min(1,"Name is required").max(100,"Name cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed"),invoice_terms:h.string().max(100,"Invoice Terms cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),rate_conf_terms:h.string().max(100,"Rate Conf terms cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),quote_terms:h.string().max(100,"Quote Terms cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),invoice_reminder:h.string().max(100,"Inovice Reminder cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional()}),ge=[{key:"name",label:"Name",placeholder:"Enter Name",type:"text",required:!0},{key:"invoice_terms",label:"Invoice Terms",placeholder:"Enter Invoice Terms",type:"textarea",required:!0},{key:"rate_conf_terms",label:"Rate Conf terms",placeholder:"Enter Rate Conf terms",type:"textarea"},{key:"quote_terms",label:"Quote Terms",placeholder:"Enter Quote Terms",type:"textarea"},{key:"invoice_reminder",label:"Inovice Reminder",placeholder:"Enter Inovice Reminder",type:"textarea"}],fe=({formCompany:a,setFormCompany:f})=>{const[x,s]=v.useState({}),u=(r,d)=>{let o=F.sanitize(d),i="";const p={...a,[r]:o},n=ue.safeParse(p);if(!n.success){const l=n.error.errors.find(g=>g.path[0]===r);i=l?l.message:""}s(l=>({...l,[r]:i})),f(p)};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"General"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:ge.map(({key:r,label:d,placeholder:o,type:i,required:p})=>e.jsx("div",{children:e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:r,children:[d," ",p&&e.jsx("span",{style:{color:"red"},children:"*"})]}),i==="textarea"?e.jsx("textarea",{id:r,placeholder:o,value:String(a[r]||""),onChange:n=>u(r,n.target.value),rows:4,style:{width:"100%"}}):e.jsx("input",{type:"text",id:r,placeholder:o,value:String(a[r]||""),onChange:n=>u(r,n.target.value)}),x[r]&&e.jsx("span",{className:"error",style:{color:"red"},children:x[r]})]},r)},r))})]})},G=oe({address:w().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),city:w().max(200,"City name is too long").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),state:w().max(200,"Invalid state").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),country:w().max(100,"Invalid country").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),postal:w().max(20,"Postal code cannot exceed 20 characters").regex(/^[a-zA-Z0-9-\s ]*$/,"Invalid postal code").optional(),phone:w().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),cell:w().max(30,"Cell number cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),fax:w().max(20,"Fax exceed 20 characters").regex(/^[0-9-+()\s]*$/,"Invalid fax format").optional(),invoice_prefix:w().max(10,"Invoice Prefix cannot exceed 10 characters").regex(/^[a-zA-Z0-9-_]*$/,"Only letters, numbers, hyphens, and underscores allowed").optional(),SCAC:w().max(10,"SCAC cannot exceed 10 characters").regex(/^[A-Z0-9-]*$/,"Only uppercase letters, numbers, and dashes allowed").optional(),docket_no:w().max(20,"Docket number cannot exceed 20 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),carrier_code:w().max(30,"Carrier Code cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),gst_hst_no:w().max(30,"GST/HST Number cannot exceed 30 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),qst_no:w().max(30,"QST Number cannot exceed 30 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),ca_bond_no:w().max(30,"CA Bond Number cannot exceed 30 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),website:w().url("Invalid website URL").max(100,"Website URL is too long").optional(),obsolete:ie().optional()});function ye({formCompany:a,setFormCompany:f}){const[x,s]=v.useState({});K(o=>{const i=p=>{var n,l;return((l=(n=o.address_components)==null?void 0:n.find(g=>g.types.includes(p)))==null?void 0:l.long_name)||""};f(p=>({...p,address:`${i("street_number")} ${i("route")}`.trim(),city:i("locality"),state:i("administrative_area_level_1"),country:i("country"),postal:i("postal_code")}))});const r=(o,i)=>{let p=typeof i=="boolean"?i:F.sanitize(i),n="";const l={...a,[o]:p};if(o in G.shape){const g=G.safeParse(l);if(!g.success){const j=g.error.errors.find(C=>C.path[0]===o);n=j?j.message:""}}s(g=>({...g,[o]:n})),f(l)},d=[{label:"Street",key:"address",placeholder:"Enter Address",required:!0},{label:"City",key:"city",placeholder:"Enter City"},{label:"State",key:"state",placeholder:"Enter State"},{label:"Country",key:"country",placeholder:"Enter Country"},{label:"Postal Code",key:"postal",placeholder:"Enter postal code"},{label:"Phone",key:"phone",placeholder:"Enter phone number"},{label:"Cell",key:"cell",placeholder:"Enter Cell"},{label:"Fax",key:"fax",placeholder:"Enter Fax"},{label:"Invoice Prefix",key:"invoice_prefix",placeholder:"Enter Invoice Prefix"},{label:"SCAC",key:"SCAC",placeholder:"Enter SCAC"},{label:"Docket#",key:"docket_no",placeholder:"Enter Docket Number"},{label:"Carrier Code",key:"carrier_code",placeholder:"Enter Carrier Code"},{label:"GST/HST#",key:"gst_hst_no",placeholder:"Enter GST/HST Number"},{label:"QST#",key:"qst_no",placeholder:"Enter QST Number"},{label:"CA Bond#",key:"ca_bond_no",placeholder:"Enter CA Bond Number"},{label:"Website",key:"website",placeholder:"Enter Website"},{key:"obsolete",label:"Obsolete",type:"boolean"}];return e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Address"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:d.map(({key:o,label:i,placeholder:p,type:n,required:l})=>e.jsx("div",{children:e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[n==="boolean"?e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",id:o,checked:!!a[o],onChange:g=>r(o,g.target.checked),style:{transform:"scale(1.1)",cursor:"pointer",margin:0}}),e.jsx("label",{htmlFor:o,style:{margin:0,whiteSpace:"nowrap"},children:i})]}):e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:o,children:[i," ",l&&e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsx("input",{type:"text",id:o,placeholder:p,value:String(a[o]||""),onChange:g=>r(o,g.target.value)})]}),x[o]&&e.jsx("span",{className:"error",style:{color:"red"},children:x[o]})]},o)},o))})]})}const be=h.object({us_tax_id:h.string().max(20,"US Tax id cannot exceed 20 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),payroll_no:h.string().max(20,"Payroll Number cannot exceed 20 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),wcb_no:h.string().max(50,"WCB# must be at most 50 characters").regex(/^\d*$/,"WCB# must be numeric").optional(),dispatch_email:h.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),ap_email:h.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),ar_email:h.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),cust_comm_email:h.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),quot_email:h.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional()});function je({formCompany:a,setFormCompany:f}){const[x,s]=v.useState({}),u=(d,o)=>{let i=typeof o=="boolean"?o:F.sanitize(o),p="";const n={...a,[d]:i},l=be.safeParse(n);if(!l.success){const g=l.error.errors.find(j=>j.path[0]===d);p=g?g.message:""}s(g=>({...g,[d]:p})),f(n)},r=[{key:"us_tax_id",label:"US Tax id",placeholder:"Enter US Tax id",type:"text"},{key:"payroll_no",label:"Payroll#",placeholder:"Enter Payroll Number",type:"text"},{key:"wcb_no",label:"WCB#",placeholder:"Enter WCB Number",type:"text"},{key:"dispatch_email",label:"Dispatch Email",placeholder:"Enter Dispatch Email",type:"text"},{key:"ap_email",label:"Account Payable Email",placeholder:"Enter Payable Email",type:"text"},{key:"ar_email",label:"Account Receivable email",placeholder:"Enter Receivable Email",type:"text"},{key:"cust_comm_email",label:"Customer Communication Email",placeholder:"Enter Customer Communication Email",type:"text"},{key:"quot_email",label:"Quotation Email",placeholder:"Enter Quotation Email",type:"text"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Other Info"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:r.map(({key:d,label:o,placeholder:i})=>e.jsx("div",{children:e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsx("label",{htmlFor:d,children:o}),e.jsx("input",{type:"text",id:d,placeholder:i,value:String(a[d]||""),onChange:p=>u(d,p.target.value)}),x[d]&&e.jsx("span",{className:"error",style:{color:"red"},children:x[d]})]},d)},d))})]})}const _e=h.object({name:h.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]+$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),phone:h.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),email:h.string().max(255,"Email must be at most 255 characters").email("Invalid email format").optional(),address:h.string().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),us_account_no:h.string().max(100,"US Account# must be at most 100 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods,commas and hyphens allowed").optional(),cdn_account_no:h.string().max(100,"CAN Account# must be at most 100 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods,commas and hyphens allowed").optional()}),ee=({bank_info:a,index:f,handleBankChange:x,handleRemoveBank:s,onAddBank:u})=>{const r=a[f]??{},[d,o]=v.useState({}),i=v.useCallback((n,l)=>{const g=F.sanitize(l);let j="";const C={...r,[n]:g},_=_e.safeParse(C);if(!_.success){const t=_.error.errors.find(c=>c.path[0]===n);j=t?t.message:""}o(t=>({...t,[n]:j})),x(f,C)},[r,x,f]),p=[{label:"Name",key:"name",type:"text",placeholder:"Enter Name"},{label:"Phone",key:"phone",type:"tel",placeholder:"Enter Phone"},{label:"Email",key:"email",type:"email",placeholder:"Enter Email"},{label:"Address",key:"address",type:"text",placeholder:"Enter Address"},{label:"US Account#",key:"us_account_no",type:"text",placeholder:"Enter US Account#"},{label:"CAN Account#",key:"cdn_account_no",type:"text",placeholder:"Enter CAN Account#"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"10px",gridTemplateColumns:"repeat(5, 1fr)",flex:1},children:p.map(({label:n,key:l,type:g,placeholder:j})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${l}-${f}`,children:n}),e.jsx("input",{id:`${l}-${f}`,type:g,name:l,value:r[l]||"",onChange:C=>i(l,C.target.value),placeholder:j}),d[l]&&e.jsx("span",{className:"error",style:{color:"red"},children:d[l]})]},l))}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:u,className:"add-button",children:e.jsx(P,{})}),e.jsx("button",{type:"button",onClick:()=>s(f),className:"delete-button",children:e.jsx(Z,{})})]})]})},H=a=>new Date(a),Ne=h.object({company:h.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]*$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),policy_start:h.string().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"Start date must be in YYYY-MM-DD format"}).optional(),policy_end:h.string().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"End date must be in YYYY-MM-DD format"}).optional(),amount:h.string().regex(/^\d+(\.\d{1,2})?$/,"Enter a valid amount (e.g., 5.00)").optional()}).refine(a=>!a.policy_start||!a.policy_end||H(a.policy_start)<=H(a.policy_end),{message:"End date must be after or equal to start date",path:["policy_end"]}),ae=({cargo_insurance:a,index:f,handleCargoChange:x,handleRemoveCargo:s,onAddCargo:u})=>{const r=a[f]??{},[d,o]=v.useState({}),i=v.useCallback((n,l)=>{const g=F.sanitize(l);let j="";const C={...r,[n]:g},_=Ne.safeParse(C);if(!_.success){const t=_.error.errors.find(c=>c.path[0]===n);j=t?t.message:""}o(t=>({...t,[n]:j})),x(f,C)},[r,x,f]),p=[{label:"Company",key:"company",type:"text",placeholder:"Enter Company Name"},{label:"Policy Start",key:"policy_start",type:"date"},{label:"Policy End",key:"policy_end",type:"date"},{label:"Amount",key:"amount",type:"text",placeholder:"Enter Amount"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"10px",gridTemplateColumns:"repeat(5, 1fr)",flex:1},children:p.map(({label:n,key:l,type:g,placeholder:j})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${l}-${f}`,children:n}),e.jsx("input",{id:`${l}-${f}`,type:g,name:l,value:r[l]||"",onChange:C=>i(l,C.target.value),placeholder:j}),d[l]&&e.jsx("span",{className:"error",style:{color:"red"},children:d[l]})]},l))}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:u,className:"add-button",children:e.jsx(P,{})}),e.jsx("button",{type:"button",onClick:()=>s(f),className:"delete-button",children:e.jsx(Z,{})})]})]})},J=a=>new Date(a),ve=h.object({company:h.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]*$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),policy_start:h.string().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"Start date must be in YYYY-MM-DD format"}).optional(),policy_end:h.string().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"End date must be in YYYY-MM-DD format"}).optional(),amount:h.string().regex(/^\d+(\.\d{1,2})?$/,"Enter a valid amount (e.g., 5.00)").optional()}).refine(a=>!a.policy_start||!a.policy_end||J(a.policy_start)<=J(a.policy_end),{message:"End date must be after or equal to start date",path:["policy_end"]}),se=({liablility_insurance:a,index:f,handleLiabilityChange:x,handleRemoveLiability:s,onAddLiability:u})=>{const r=a[f]??{},[d,o]=v.useState({}),i=v.useCallback((n,l)=>{const g=F.sanitize(l);let j="";const C={...r,[n]:g},_=ve.safeParse(C);if(!_.success){const t=_.error.errors.find(c=>c.path[0]===n);j=t?t.message:""}o(t=>({...t,[n]:j})),x(f,C)},[r,x,f]),p=[{label:"Company",key:"company",type:"text",placeholder:"Enter Company Name"},{label:"Policy Start",key:"policy_start",type:"date"},{label:"Policy End",key:"policy_end",type:"date"},{label:"Amount",key:"amount",type:"text",placeholder:"Enter Amount"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"10px",gridTemplateColumns:"repeat(5, 1fr)",flex:1},children:p.map(({label:n,key:l,type:g,placeholder:j})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${l}-${f}`,children:n}),e.jsx("input",{id:`${l}-${f}`,type:g,name:l,value:r[l]||"",onChange:C=>i(l,C.target.value),placeholder:j}),d[l]&&e.jsx("span",{className:"error",style:{color:"red"},children:d[l]})]},l))}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:u,className:"add-button",children:e.jsx(P,{})}),e.jsx("button",{type:"button",onClick:()=>s(f),className:"delete-button",children:e.jsx(Z,{})})]})]})},Ce=({formCompany:a,setFormCompany:f})=>{const[x,s]=v.useState({}),[u,r]=v.useState({}),d="https://linkloadsapiprod.onrender.com/api".trim()||"http://127.0.0.1:8000/api",o=10*1024*1024,i=async(p,n)=>{var C,_;const l=(C=p.target.files)==null?void 0:C[0];if(!l)return;if(l.size>o){s(t=>({...t,[n]:"File size exceeds 10MB limit."}));return}s(t=>({...t,[n]:""})),r(t=>({...t,[n]:!0}));const g=new FormData;g.append(n,l);const j=localStorage.getItem("token");try{const c=await(await fetch(`${d}/upload`,{method:"POST",headers:{Authorization:`Bearer ${j}`},body:g})).json();console.log(`Upload response for ${n}:`,c);const m=(_=c.files)==null?void 0:_[n];if(m!=null&&m.fileUrl){const y=d.replace("/api",""),b=m.fileUrl.startsWith("http")?m.fileUrl:`${y}${m.fileUrl}`;f(E=>({...E,[n]:b,[`${n}_name`]:m.fileName}))}else console.error("Missing fileUrl in response:",c),s(y=>({...y,[n]:"File upload failed: Missing URL in response."}))}catch(t){console.error(`Error uploading ${n}:`,t),s(c=>({...c,[n]:"Network error during file upload."}))}finally{r(t=>({...t,[n]:!1}))}};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Uploaded Documents"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"company_package",children:"Company Package"}),e.jsx("input",{id:"company_package",type:"file",onChange:p=>i(p,"company_package")}),typeof a.company_package=="string"&&a.company_package&&e.jsx("div",{children:e.jsx("a",{href:a.company_package,target:"_blank",rel:"noopener noreferrer",children:"Download Company Package"})}),u.company_package&&e.jsx("p",{children:"Uploading..."}),x.company_package&&e.jsx("p",{className:"error",children:x.company_package})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"insurance",children:"Insurance"}),e.jsx("input",{id:"insurance",type:"file",onChange:p=>i(p,"insurance")}),typeof a.insurance=="string"&&a.insurance&&e.jsx("div",{children:e.jsx("a",{href:a.insurance,target:"_blank",rel:"noopener noreferrer",children:"Download Insurance"})}),u.insurance&&e.jsx("p",{children:"Uploading..."}),x.insurance&&e.jsx("p",{className:"error",children:x.insurance})]})]})]})},Ae=({company:a,onClose:f,onUpdate:x})=>{const{formCompany:s,setFormCompany:u,updateCompany:r,handleAddBank:d,handleRemoveBank:o,handleBankChange:i,handleAddCargo:p,handleRemoveCargo:n,handleCargoChange:l,handleAddLiability:g,handleRemoveLiability:j,handleLiabilityChange:C}=xe(a,f,x);return console.log("Form company:",s),e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:_=>{_.preventDefault(),r()},className:"form-main",children:[s&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{formCompany:s,setFormCompany:u}),e.jsx(ye,{formCompany:s,setFormCompany:u}),e.jsx(je,{formCompany:s,setFormCompany:u}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Banking Info"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",children:[s.bank_info.map((_,t)=>e.jsx(ee,{bank_info:s.bank_info,index:t,onAddBank:d,handleRemoveBank:o,handleBankChange:i},t)),s.bank_info.length===0&&e.jsx("button",{type:"button",onClick:d,className:"add-button",children:e.jsx(P,{})})]})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Cargo Insurance"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",children:[s.cargo_insurance.map((_,t)=>e.jsx(ae,{cargo_insurance:s.cargo_insurance,index:t,onAddCargo:p,handleRemoveCargo:n,handleCargoChange:l},t)),s.cargo_insurance.length===0&&e.jsx("button",{type:"button",onClick:p,className:"add-button",children:e.jsx(P,{})})]})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Liability Insurance"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",children:[s.liablility_insurance.map((_,t)=>e.jsx(se,{liablility_insurance:s.liablility_insurance,index:t,onAddLiability:g,handleRemoveLiability:j,handleLiabilityChange:C},t)),s.liablility_insurance.length===0&&e.jsx("button",{type:"button",onClick:g,className:"add-button",children:e.jsx(P,{})})]})]})]}),e.jsx(Ce,{formCompany:s,setFormCompany:u}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Save"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:f,children:"Cancel"})]})]})})},Ee=h.object({name:h.string().min(1,"Name is required").max(100,"Name cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed"),invoice_terms:h.string().max(500,"Invoice Terms cannot exceed 500 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),rate_conf_terms:h.string().max(500,"Rate Conf terms cannot exceed 500 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),quote_terms:h.string().max(500,"Quote Terms cannot exceed 500 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),invoice_reminder:h.string().max(200,"Inovice Reminder cannot exceed 200 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional()}),ke=[{key:"name",label:"Name",placeholder:"Enter Name",type:"text",required:!0},{key:"invoice_terms",label:"Invoice Terms",placeholder:"Enter Invoice Terms",type:"textarea",required:!0},{key:"rate_conf_terms",label:"Rate Conf terms",placeholder:"Enter Rate Conf terms",type:"textarea"},{key:"quote_terms",label:"Quote Terms",placeholder:"Enter Quote Terms",type:"textarea"},{key:"invoice_reminder",label:"Inovice Reminder",placeholder:"Enter Inovice Reminder",type:"textarea"}],Se=({company:a,setCompany:f})=>{const[x,s]=v.useState({}),u=(r,d)=>{let o=F.sanitize(d),i="";const p={...a,[r]:o},n=Ee.safeParse(p);if(!n.success){const l=n.error.errors.find(g=>g.path[0]===r);i=l?l.message:""}s(l=>({...l,[r]:i})),f(p)};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"General"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:ke.map(({key:r,label:d,placeholder:o,type:i,required:p})=>e.jsx("div",{children:e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:r,children:[d," ",p&&e.jsx("span",{style:{color:"red"},children:"*"})]}),i==="textarea"?e.jsx("textarea",{id:r,placeholder:o,value:String(a[r]||""),onChange:n=>u(r,n.target.value),rows:4,style:{width:"100%"}}):e.jsx("input",{type:"text",id:r,placeholder:o,value:String(a[r]||""),onChange:n=>u(r,n.target.value)}),x[r]&&e.jsx("span",{className:"error",style:{color:"red"},children:x[r]})]},r)},r))})]})},we=h.object({address:h.string().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),city:h.string().max(200,"City name is too long").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),state:h.string().max(200,"Invalid state").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),country:h.string().max(100,"Invalid country").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),postal:h.string().max(20,"Postal code cannot exceed 20 characters").regex(/^[a-zA-Z0-9-\s ]*$/,"Invalid postal code").optional(),phone:h.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),cell:h.string().max(30,"Cell number cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),fax:h.string().max(20,"Fax exceed 20 characters").regex(/^[0-9-+()\s]*$/,"Invalid fax format").optional(),invoice_prefix:h.string().max(10,"Invoice Prefix cannot exceed 10 characters").regex(/^[a-zA-Z0-9-_]*$/,"Only letters, numbers, hyphens, and underscores allowed").optional(),SCAC:h.string().max(10,"SCAC cannot exceed 10 characters").regex(/^[A-Z0-9-]*$/,"Only uppercase letters, numbers, and dashes allowed").optional(),docket_no:h.string().max(20,"Docket number cannot exceed 20 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),carrier_code:h.string().max(30,"Carrier Code cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid format").optional(),gst_hst_no:h.string().max(30,"GST/HST Number cannot exceed 30 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),qst_no:h.string().max(30,"QST Number cannot exceed 30 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),ca_bond_no:h.string().max(30,"CA Bond Number cannot exceed 30 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),website:h.string().url("Invalid website URL").max(100,"Website URL is too long").optional(),obsolete:h.boolean().optional()}),$e=({company:a,setCompany:f})=>{const[x,s]=v.useState({});K(o=>{const i=p=>{var n,l;return((l=(n=o.address_components)==null?void 0:n.find(g=>g.types.includes(p)))==null?void 0:l.long_name)||""};f(p=>({...p,address:`${i("street_number")} ${i("route")}`.trim(),city:i("locality"),state:i("administrative_area_level_1"),country:i("country"),postal:i("postal_code")}))});const r=(o,i)=>{let p=i;["obsolete"].includes(o)&&typeof i!="boolean"?p=i==="true":typeof i!="boolean"&&(p=F.sanitize(i));let n="";const l={...a,[o]:p},g=we.safeParse(l);if(!g.success){const j=g.error.errors.find(C=>C.path[0]===o);n=j?j.message:""}s(j=>({...j,[o]:n})),f(l)},d=[{label:"Street",key:"address",placeholder:"Enter Address",required:!0},{label:"City",key:"city",placeholder:"Enter City"},{label:"State",key:"state",placeholder:"Enter State"},{label:"Country",key:"country",placeholder:"Enter Country"},{label:"Postal Code",key:"postal",placeholder:"Enter postal code"},{label:"Phone",key:"phone",placeholder:"Enter phone number"},{label:"Cell",key:"cell",placeholder:"Enter Cell"},{label:"Fax",key:"fax",placeholder:"Enter Fax"},{label:"Invoice Prefix",key:"invoice_prefix",placeholder:"Enter Invoice Prefix"},{label:"SCAC",key:"SCAC",placeholder:"Enter SCAC"},{label:"Docket#",key:"docket_no",placeholder:"Enter Docket Number"},{label:"Carrier Code",key:"carrier_code",placeholder:"Enter Carrier Code"},{label:"GST/HST#",key:"gst_hst_no",placeholder:"Enter GST/HST Number"},{label:"QST#",key:"qst_no",placeholder:"Enter QST Number"},{label:"CA Bond#",key:"ca_bond_no",placeholder:"Enter CA Bond Number"},{label:"Website",key:"website",placeholder:"Enter Website"},{label:"Obsolete",key:"obsolete",type:"boolean"}];return e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Address"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:d.map(({key:o,label:i,placeholder:p,type:n,required:l})=>e.jsx("div",{children:e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[n==="boolean"?e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",id:o,checked:!!a[o],onChange:g=>r(o,g.target.checked),style:{transform:"scale(1.1)",cursor:"pointer",margin:0}}),e.jsx("label",{htmlFor:o,style:{margin:0,whiteSpace:"nowrap"},children:i})]}):e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:o,children:[i," ",l&&e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsx("input",{type:"text",id:o,placeholder:p,value:String(a[o]||""),onChange:g=>r(o,g.target.value)})]}),x[o]&&e.jsx("span",{className:"error",style:{color:"red"},children:x[o]})]},o)},o))})]})},Ie=h.object({us_tax_id:h.string().max(20,"US Tax id cannot exceed 20 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),payroll_no:h.string().max(20,"Payroll Number cannot exceed 20 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),wcb_no:h.string().max(50,"WCB# must be at most 50 characters").regex(/^\d*$/,"WCB# must be numeric").optional(),dispatch_email:h.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),ap_email:h.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),ar_email:h.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),cust_comm_email:h.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),quot_email:h.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional()}),Pe=[{key:"us_tax_id",label:"US Tax id",placeholder:"Enter US Tax id",type:"text"},{key:"payroll_no",label:"Payroll#",placeholder:"Enter Payroll Number",type:"text"},{key:"wcb_no",label:"WCB#",placeholder:"Enter WCB Number",type:"text"},{key:"dispatch_email",label:"Dispatch Email",placeholder:"Enter Dispatch Email",type:"text"},{key:"ap_email",label:"Account Payable Email",placeholder:"Enter Payable Email",type:"text"},{key:"ar_email",label:"Account Receivable email",placeholder:"Enter Receivable Email",type:"text"},{key:"cust_comm_email",label:"Customer Communication Email",placeholder:"Enter Customer Communication Email",type:"text"},{key:"quot_email",label:"Quotation Email",placeholder:"Enter Quotation Email",type:"text"}],Fe=({company:a,setCompany:f})=>{const[x,s]=v.useState({}),u=(r,d)=>{let o=F.sanitize(d),i="";const p={...a,[r]:o},n=Ie.safeParse(p);if(!n.success){const l=n.error.errors.find(g=>g.path[0]===r);i=l?l.message:""}s(l=>({...l,[r]:i})),f(p)};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Other Info"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:Pe.map(({key:r,label:d,placeholder:o})=>e.jsx("div",{children:e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsx("label",{htmlFor:r,children:d}),e.jsx("input",{type:"text",id:r,placeholder:o,value:String(a[r]||""),onChange:i=>u(r,i.target.value)}),x[r]&&e.jsx("span",{className:"error",style:{color:"red"},children:x[r]})]},r)},r))})]})},X="https://linkloadsapiprod.onrender.com/api",Te=(a,f)=>{const x={id:0,name:"",invoice_terms:"",rate_conf_terms:"",quote_terms:"",invoice_reminder:"",address:"",city:"",state:"",country:"",postal:"",email:"",phone:"",cell:"",fax:"",invoice_prefix:"",SCAC:"",docket_no:"",carrier_code:"",gst_hst_no:"",qst_no:"",ca_bond_no:"",website:"",obsolete:!1,us_tax_id:"",payroll_no:"",wcb_no:"",dispatch_email:"",ap_email:"",ar_email:"",cust_comm_email:"",quot_email:"",bank_info:[],cargo_insurance:[],liablility_insurance:[],company_package:"",insurance:"",created_at:"",updated_at:""},[s,u]=v.useState(x),r=()=>!!s.name,d=async c=>{if(c.preventDefault(),!r()){$.fire("Validation Error","Please fill in all required fields.","error");return}try{const m=localStorage.getItem("token");if(!m){$.fire("Error","No token found","error");return}const y={Authorization:`Bearer ${m}`},b=new FormData;Object.keys(s).forEach(I=>{const z=s[I];I==="obsolete"?b.append(I,z?"1":"0"):I!=="company_package"&&I!=="insurance"&&b.append(I,String(z||""))}),s.company_package&&s.company_package instanceof File&&b.append("company_package",s.company_package),s.insurance&&s.insurance instanceof File&&b.append("insurance",s.insurance);const E=s.id?await O.put(`${X}/company/${s.id}`,s,{headers:y}):await O.post(`${X}/company`,s,{headers:y});$.fire(s.id?"Success!":"Saved!","Company added successfully.","success"),o(),f()}catch(m){console.error("Error saving/updating company:",m.response?m.response.data:m.message),$.fire("Error","An error occurred while processing the company.","error")}},o=()=>{u({id:0,name:"",invoice_terms:"",rate_conf_terms:"",quote_terms:"",invoice_reminder:"",address:"",city:"",state:"",country:"",postal:"",email:"",phone:"",cell:"",fax:"",invoice_prefix:"",SCAC:"",docket_no:"",carrier_code:"",gst_hst_no:"",qst_no:"",ca_bond_no:"",website:"",obsolete:!1,us_tax_id:"",payroll_no:"",wcb_no:"",dispatch_email:"",ap_email:"",ar_email:"",cust_comm_email:"",quot_email:"",bank_info:[],cargo_insurance:[],liablility_insurance:[],company_package:"",insurance:"",created_at:"",updated_at:""})};return{company:s,setCompany:u,handleSubmit:d,handleAddBank:()=>{u(c=>({...c,bank_info:[...c.bank_info,{name:"",phone:"",email:"",address:"",us_account_no:"",cdn_account_no:""}]}))},handleRemoveBank:c=>{u(m=>({...m,bank_info:m.bank_info.filter((y,b)=>b!==c)}))},handleBankChange:(c,m)=>{const y=s.bank_info.map((b,E)=>E===c?m:b);u(b=>({...b,bank_info:y}))},handleAddCargo:()=>{u(c=>({...c,cargo_insurance:[...c.cargo_insurance,{company:"",policy_start:"",policy_end:"",amount:""}]}))},handleRemoveCargo:c=>{u(m=>({...m,cargo_insurance:m.cargo_insurance.filter((y,b)=>b!==c)}))},handleCargoChange:(c,m)=>{const y=s.cargo_insurance.map((b,E)=>E===c?m:b);u(b=>({...b,cargo_insurance:y}))},handleAddLiability:()=>{u(c=>({...c,liablility_insurance:[...c.liablility_insurance,{company:"",policy_start:"",policy_end:"",amount:""}]}))},handleRemoveLiability:c=>{u(m=>({...m,liablility_insurance:m.liablility_insurance.filter((y,b)=>b!==c)}))},handleLiabilityChange:(c,m)=>{const y=s.liablility_insurance.map((b,E)=>E===c?m:b);u(b=>({...b,liablility_insurance:y}))},clearCompanyForm:o}},ze=({company:a,setCompany:f})=>{const[x,s]=v.useState({}),[u,r]=v.useState({}),d="https://linkloadsapiprod.onrender.com/api".trim()||"http://127.0.0.1:8000/api",o=10*1024*1024,i=async(p,n)=>{var C,_;const l=(C=p.target.files)==null?void 0:C[0];if(!l)return;if(l.size>o){s(t=>({...t,[n]:"File size exceeds 10MB limit."}));return}s(t=>({...t,[n]:""})),r(t=>({...t,[n]:!0}));const g=new FormData;g.append(n,l);const j=localStorage.getItem("token");try{const c=await(await fetch(`${d}/upload`,{method:"POST",headers:{Authorization:`Bearer ${j}`},body:g})).json();console.log(`Upload response for ${n}:`,c);const m=(_=c.files)==null?void 0:_[n];if(m!=null&&m.fileUrl){const y=d.replace("/api",""),b=m.fileUrl.startsWith("http")?m.fileUrl:`${y}${m.fileUrl}`;f(E=>({...E,[n]:b,[`${n}_name`]:m.fileName}))}else console.error("Missing fileUrl in response:",c),s(y=>({...y,[n]:"File upload failed: Missing URL in response."}))}catch(t){console.error(`Error uploading ${n}:`,t),s(c=>({...c,[n]:"Network error during file upload."}))}finally{r(t=>({...t,[n]:!1}))}};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Upload Documents"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"company_package",children:"Company Package"}),e.jsx("input",{id:"company_package",type:"file",onChange:p=>i(p,"company_package")}),typeof a.company_package=="string"&&a.company_package&&e.jsx("div",{children:e.jsx("a",{href:a.company_package,target:"_blank",rel:"noopener noreferrer",children:"Download Company Package"})}),u.company_package&&e.jsx("p",{children:"Uploading..."}),x.company_package&&e.jsx("p",{className:"error",children:x.company_package})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"insurance",children:"Insurance"}),e.jsx("input",{id:"insurance",type:"file",onChange:p=>i(p,"insurance")}),typeof a.insurance=="string"&&a.insurance&&e.jsx("div",{children:e.jsx("a",{href:a.insurance,target:"_blank",rel:"noopener noreferrer",children:"Download Insurance"})}),u.insurance&&e.jsx("p",{children:"Uploading..."}),x.insurance&&e.jsx("p",{className:"error",children:x.insurance})]})]})]})},Oe=({onClose:a,onSuccess:f})=>{const{company:x,setCompany:s,handleSubmit:u,handleAddBank:r,handleRemoveBank:d,handleBankChange:o,handleAddCargo:i,handleRemoveCargo:p,handleCargoChange:n,handleAddLiability:l,handleRemoveLiability:g,handleLiabilityChange:j}=Te(a,f);return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:u,className:"form-main",children:[e.jsx(Se,{company:x,setCompany:s}),e.jsx($e,{company:x,setCompany:s}),e.jsx(Fe,{company:x,setCompany:s}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Banking Info"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:x.bank_info.map((C,_)=>e.jsx(ee,{bank_info:x.bank_info,index:_,onAddBank:r,handleBankChange:o,handleRemoveBank:d},_))}),x.bank_info.length===0&&e.jsx("button",{type:"button",onClick:r,className:"add-button",children:e.jsx(P,{})})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Cargo Insurance"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:x.cargo_insurance.map((C,_)=>e.jsx(ae,{cargo_insurance:x.cargo_insurance,index:_,onAddCargo:i,handleCargoChange:n,handleRemoveCargo:p},_))}),x.cargo_insurance.length===0&&e.jsx("button",{type:"button",onClick:i,className:"add-button",children:e.jsx(P,{})})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Liability Insurance"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:x.liablility_insurance.map((C,_)=>e.jsx(se,{liablility_insurance:x.liablility_insurance,index:_,onAddLiability:l,handleLiabilityChange:j,handleRemoveLiability:g},_))}),x.liablility_insurance.length===0&&e.jsx("button",{type:"button",onClick:l,className:"add-button",children:e.jsx(P,{})})]}),e.jsx(ze,{company:x,setCompany:s}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit","data-testid":"submit-button",children:"Add Company"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:a,children:"Cancel"})]})]})})},Re=({formCompany:a})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"General"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx("span",{children:a.name||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"invoiceTerms",children:"Invoice Terms"}),e.jsx("span",{children:a.invoice_terms||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"rateConfTerms",children:"Rate Conf terms"}),e.jsx("span",{children:a.rate_conf_terms||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"quoteTerms",children:"Quote Terms"}),e.jsx("span",{children:a.quote_terms||"N/A"})]})]}),e.jsx("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"inoviceReminder",children:"Inovice Reminder"}),e.jsx("span",{children:a.invoice_reminder||"N/A"})]})})]}),Be=({formCompany:a})=>e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Address"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressStreet",children:"Street"}),e.jsx("span",{children:a.address||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressCity",children:"City"}),e.jsx("span",{children:a.city||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressState",children:"State"}),e.jsx("span",{children:a.state||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressCountry",children:"Country"}),e.jsx("span",{children:a.country||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressPostalCode",children:"Postal Code"}),e.jsx("span",{children:a.postal||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"Phone"}),e.jsx("span",{children:a.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressPostalCode",children:"Cell"}),e.jsx("span",{children:a.cell||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"Fax"}),e.jsx("span",{children:a.fax||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressPostalCode",children:"Invoice Prefix"}),e.jsx("span",{children:a.invoice_prefix||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"SCAC"}),e.jsx("span",{children:a.SCAC||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressPostalCode",children:"Docket#"}),e.jsx("span",{children:a.docket_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"Carrier Code"}),e.jsx("span",{children:a.carrier_code||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressPostalCode",children:"GST/HST#"}),e.jsx("span",{children:a.gst_hst_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"QST#"}),e.jsx("span",{children:a.qst_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressPostalCode",children:"CA Bond#"}),e.jsx("span",{children:a.ca_bond_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"Website"}),e.jsx("span",{children:a.website||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"mailingAddressUnitNo",children:"Obsolete"}),e.jsx("span",{children:a.obsolete?"Yes":"No"})]})]})]}),Ue=({formCompany:a})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Other Info"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"US Tax id"}),e.jsx("p",{children:a.us_tax_id||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Payroll#"}),e.jsx("p",{children:a.payroll_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"WCB#"}),e.jsx("p",{children:a.wcb_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Dispatch Email"}),e.jsx("p",{children:a.dispatch_email||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Account Payable Email"}),e.jsx("p",{children:a.ap_email||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Account Receivable email"}),e.jsx("p",{children:a.ar_email||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Customer Communication Email"}),e.jsx("p",{children:a.cust_comm_email||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Quotation Email"}),e.jsx("p",{children:a.quot_email||"N/A"})]})]})]}),De=({banking_info:a})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Name"}),e.jsx("span",{children:a.name||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Contact No"}),e.jsx("span",{children:a.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Email"}),e.jsx("span",{children:a.email||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Address"}),e.jsx("span",{children:a.address||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"US Account No."}),e.jsx("span",{children:a.us_account_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"CAN Account No."}),e.jsx("span",{children:a.cdn_account_no||"N/A"})]})]})]}),Le=({cargo_ins:a})=>e.jsx("fieldset",{className:"form-section",children:e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Company"}),e.jsx("span",{children:a.company||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Policy Start"}),e.jsx("span",{children:a.policy_start||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Policy End"}),e.jsx("span",{children:a.policy_end||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Amount"}),e.jsx("span",{children:a.amount||"N/A"})]})]})}),Ze=({liab_ins:a})=>e.jsx("fieldset",{className:"form-section",children:e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Company"}),e.jsx("span",{children:a.company||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Policy Start"}),e.jsx("span",{children:a.policy_start||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Policy End"}),e.jsx("span",{children:a.policy_end||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Amount"}),e.jsx("span",{children:a.amount||"N/A"})]})]})}),qe=({formCompany:a})=>{const f=(x,s)=>x?e.jsx("div",{children:e.jsxs("a",{href:x,target:"_blank",rel:"noopener noreferrer",children:["Download ",s]})}):null;return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Uploaded Documents"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Company Package"}),f(a.company_package,"Comapany Package")]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Insurance"}),f(a.insurance,"Insurance")]})]})]})},Me=({company:a,onClose:f})=>{const{userRole:x}=re(),[s,u]=v.useState({id:0,name:"",invoice_terms:"",rate_conf_terms:"",quote_terms:"",invoice_reminder:"",address:"",city:"",state:"",country:"",postal:"",email:"",phone:"",cell:"",fax:"",invoice_prefix:"",SCAC:"",docket_no:"",carrier_code:"",gst_hst_no:"",qst_no:"",ca_bond_no:"",website:"",obsolete:!1,us_tax_id:"",payroll_no:"",wcb_no:"",dispatch_email:"",ap_email:"",ar_email:"",cust_comm_email:"",quot_email:"",bank_info:[],cargo_insurance:[],liablility_insurance:[],company_package:"",insurance:"",created_at:"",updated_at:""});return v.useEffect(()=>{a&&u({...a,bank_info:Array.isArray(a.bank_info)?a.bank_info:JSON.parse(a.bank_info||"[]"),cargo_insurance:Array.isArray(a.cargo_insurance)?a.cargo_insurance:JSON.parse(a.cargo_insurance||"[]"),liablility_insurance:Array.isArray(a.liablility_insurance)?a.liablility_insurance:JSON.parse(a.liablility_insurance||"[]")})},[a]),e.jsx("div",{className:"form-container",children:e.jsxs("form",{className:"form-main",children:[e.jsx(Re,{formCompany:s}),e.jsx(Be,{formCompany:s}),e.jsx(Ue,{formCompany:s}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Banking Info"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:s.bank_info.map((r,d)=>e.jsx(De,{banking_info:r,index:d},d))})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Cargo Insurance"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:s.cargo_insurance.map((r,d)=>e.jsx(Le,{cargo_ins:r,index:d},d))})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Liability Insurance"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:s.liablility_insurance.map((r,d)=>e.jsx(Ze,{liab_ins:r,index:d},d))})]}),e.jsx(qe,{formCompany:s}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"button",className:"btn-cancel",onClick:f,style:{padding:"9px 15px"},children:"Cancel"})})]})})},Ve=()=>{const{fetchCompanies:a,companies:f,loading:x,searchQuery:s,setSearchQuery:u,sortBy:r,sortDesc:d,selectedCompanies:o,paginatedData:i,totalPages:p,currentPage:n,isEditModalOpen:l,isAddModalOpen:g,isViewModalOpen:j,isEmailModalOpen:C,selectedCompany:_,setEditModalOpen:t,setAddModalOpen:c,setViewModalOpen:m,setEmailModalOpen:y,toggleSelectAll:b,toggleSelect:E,deleteSelected:I,openEditModal:z,sendEmails:R,openViewModal:Y,handleSort:B,updateCompany:q,handlePageChange:U}=he(),M=k=>k.key==="checkbox"||k.key==="actions"?k.label:e.jsxs("div",{className:"sortable-header",onClick:()=>B(k.key),children:[k.label,e.jsx("span",{className:"sort-icon",children:r===k.key?d?"":"":""})]}),D=[{key:"checkbox",label:e.jsx("input",{type:"checkbox",onChange:b,checked:o.length===i.length&&i.length>0}),render:k=>e.jsx("input",{type:"checkbox",checked:o.includes(k.id),onChange:()=>E(k.id)})},{key:"name",label:"Name"},{key:"phone",label:"Phone"},{key:"cell",label:"Cell"},{key:"email",label:"Email"},{key:"city",label:"City"},{key:"state",label:"State"},{key:"website",label:"Website"},{key:"gst_hst_no",label:"GST/HST No."},{key:"qst_no",label:"QST No."},{key:"actions",label:"",render:k=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Y(k),className:"btn-view",children:e.jsx(de,{})}),e.jsx("button",{onClick:()=>z(k),className:"btn-edit",children:e.jsx(le,{})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{className:"header-container",children:[e.jsx("div",{className:"header-container-left",children:e.jsx("h1",{className:"page-heading",children:"Companies"})}),e.jsxs("div",{className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(me,{className:"search-icon"}),e.jsx("input",{className:"search-bar",value:s,onChange:k=>u(k.target.value)})]}),e.jsxs("button",{onClick:()=>c(!0),className:"add-button",children:[e.jsx(P,{}),"New"]}),e.jsx("button",{onClick:()=>y(!0),className:"send-email-button",disabled:o.length===0,children:e.jsx(pe,{})}),e.jsx("button",{onClick:I,className:"delete-button",children:e.jsx(Z,{})})]})]}),x?e.jsx("div",{children:"Loading..."}):f.length===0?e.jsx("div",{className:"no-record",children:"No records found"}):e.jsx(te,{data:i,headers:D.map(k=>({...k,label:M(k)})),handleSort:B,sortBy:r,sortDesc:d}),e.jsx(ce,{currentPage:n,totalPages:p,onPageChange:U}),e.jsx(L,{isOpen:l,title:"Edit Company",onClose:()=>t(!1),children:_&&e.jsx(Ae,{company:_,onUpdate:q,onClose:()=>t(!1)})}),e.jsx(L,{isOpen:g,onClose:()=>c(!1),title:"Add Company",children:e.jsx(Oe,{onClose:()=>c(!1),onSuccess:a})}),e.jsx(L,{isOpen:C,onClose:()=>y(!1),title:"Send Email",children:e.jsx("button",{onClick:R,children:"Send"})}),e.jsx(L,{isOpen:j,onClose:()=>m(!1),title:"Company Details",children:_&&e.jsx(Me,{company:_,onClose:()=>m(!1)})})]})},ca=()=>e.jsx("div",{children:e.jsx(Ve,{})});export{ca as default};

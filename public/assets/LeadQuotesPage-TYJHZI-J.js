import{r as f,j as e,b as P,S as w}from"./index-CShLHsUt.js";import{z as u,R as U,a as q,b as H,T as W,P as J,M as R}from"./Pagination-2Q04ZmxJ.js";/* empty css             */import I from"./purify.es-Ci5xwkH_.js";import{u as K}from"./useGoogleAutocomplete-C2ALqIRo.js";import{u as X,d as V}from"./useEditLead-CUKV6sor.js";import{R as O}from"./CalendarOutlined-DV2-_YpA.js";import{o as ee,R as se}from"./EyeOutlined-B28M-sP9.js";const te=u.object({name:u.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]+$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),phone:u.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),email:u.string().max(255,"Email must be at most 255 characters").email("Invalid email format").optional()}),ae=({contacts:s,index:c,handleContactChange:o,handleRemoveContact:j,onAddContact:x})=>{const y=s[c]??{},[n,m]=f.useState({}),d=f.useCallback((a,l)=>{const h=I.sanitize(l);let i="";const v={...y,[a]:h},A=te.safeParse(v);if(!A.success){const N=A.error.errors.find(C=>C.path[0]===a);i=N?N.message:""}m(N=>({...N,[a]:i})),o(c,v)},[y,o,c]),t=[{label:"Name",key:"name",type:"text",placeholder:"Enter name"},{label:"Phone",key:"phone",type:"tel",placeholder:"Enter phone"},{label:"Email",key:"email",type:"email",placeholder:"Enter email"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.map(({label:a,key:l,type:h,placeholder:i})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${l}-${c}`,children:a}),e.jsx("input",{id:`${l}-${c}`,type:h,name:l,value:y[l]||"",onChange:v=>d(l,v.target.value),placeholder:i}),n[l]&&e.jsx("span",{className:"error",style:{color:"red"},children:n[l]})]},l)),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:x,className:"add-button",children:e.jsx(U,{})}),e.jsx("button",{type:"button",onClick:()=>j(c),className:"delete-button",children:e.jsx(q,{})})]})]})},le=u.object({lead_no:u.string().max(200,"Legal No must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),lead_date:u.string().min(1,"Lead Date is required").regex(/^\d{2}-\d{2}-\d{4}$/,{message:"Date must be in DD-MM-YYYY format"}).optional(),customer_name:u.string().max(200,"Customer Name must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),phone:u.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),email:u.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),website:u.string().max(255,"Website must be at most 255 characters long").url("Invalid website URL").optional(),lead_type:u.enum(["AB","BC","BDS","CA","DPD MAGMA","MB","ON","Super Leads","TBAB","USA"],{errorMap:()=>({message:"Invalid lead type"})}),lead_status:u.enum(["Prospect","Lanes discussed","Prod/Equip noted","E-mail sent","Portal registration","Quotations","Fob/Have broker","VM/No answer","Diff Dept.","No reply","Not Int.","Asset based"],{errorMap:()=>({message:"Invalid lead status"})})}),re=({formLead:s,setFormLead:c})=>{const[o,j]=f.useState({}),x=(n,m)=>{const d=I.sanitize(m);let t="",a=d;if(n==="lead_date"&&/^\d{4}-\d{2}-\d{2}$/.test(d)){const[i,v,A]=d.split("-");a=`${A}-${v}-${i}`}const l={...s,[n]:a},h=le.safeParse(l);if(!h.success){const i=h.error.errors.find(v=>v.path[0]===n);t=i?i.message:""}j(i=>({...i,[n]:t})),c(i=>({...i,[n]:d}))},y=[{label:"Lead#",key:"lead_no",type:"text",placeholder:"Enter lead#",required:!0},{label:"Lead Date",key:"lead_date",type:"date",placeholder:"Enter lead date",required:!0},{label:"Customer Name",key:"customer_name",placeholder:"Enter customer name"},{label:"Phone",key:"phone",type:"text",placeholder:"Enter phone number"},{label:"Email",key:"email",type:"text",placeholder:"Enter email"},{label:"Website",key:"website",type:"text",placeholder:"Enter website URL"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Lead Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[y.map(({label:n,key:m,type:d,placeholder:t,required:a})=>e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:m,children:[n," ",a&&e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsx("input",{type:d,id:m,placeholder:t,value:s[m]||"",onChange:l=>x(m,l.target.value)}),o[m]&&e.jsx("span",{className:"error",style:{color:"red"},children:o[m]})]},m)),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"lead_type",children:["Lead Type ",e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsxs("select",{id:"lead_type",value:s.lead_type||"",onChange:n=>c(m=>({...m,lead_type:n.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Lead Type"}),e.jsx("option",{value:"AB",children:"AB"}),e.jsx("option",{value:"BC",children:"BC"}),e.jsx("option",{value:"BDS",children:"BDS"}),e.jsx("option",{value:"CA",children:"CA"}),e.jsx("option",{value:"DPD MAGMA",children:"DPD MAGMA"}),e.jsx("option",{value:"MB",children:"MB"}),e.jsx("option",{value:"ON",children:"ON"}),e.jsx("option",{value:"Super Leads",children:"Super Leads"}),e.jsx("option",{value:"TBAB",children:"TBAB"}),e.jsx("option",{value:"USA",children:"USA"})]}),o.lead_type&&e.jsx("span",{className:"error",style:{color:"red"},children:o.lead_type})]}),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"lead_status",children:["Lead Status ",e.jsx("span",{style:{color:"red"},children:"*"})]})," ",e.jsxs("select",{id:"lead_status",value:s.lead_status||"",onChange:n=>c(m=>({...m,lead_status:n.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Lead Status"}),e.jsx("option",{value:"Prospect",children:"Prospect"}),e.jsx("option",{value:"Lanes discussed",children:"Lanes discussed"}),e.jsx("option",{value:"Prod/Equip noted",children:"Prod/Equip noted"}),e.jsx("option",{value:"E-mail sent",children:"E-mail sent"}),e.jsx("option",{value:"Portal registration",children:"Portal registration"}),e.jsx("option",{value:"Quotations",children:"Quotations"}),e.jsx("option",{value:"Fob/Have broker",children:"Fob/Have broker"}),e.jsx("option",{value:"VM/No answer",children:"VM/No answer"}),e.jsx("option",{value:"Diff Dept.",children:"Diff Dept."}),e.jsx("option",{value:"No reply",children:"No reply"}),e.jsx("option",{value:"Not Int.",children:"Not Int."}),e.jsx("option",{value:"Asset based",children:"Asset based"})]}),o.lead_status&&e.jsx("span",{className:"error",style:{color:"red"},children:o.lead_status})]})]})]})},oe=u.object({address:u.string().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),city:u.string().max(200,"City name is too long").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),state:u.string().max(200,"Invalid state").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),country:u.string().max(100,"Invalid country").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),postal_code:u.string().max(20,"Postal code cannot exceed 20 characters").regex(/^[a-zA-Z0-9-\s ]*$/,"Invalid postal code").optional(),unit_no:u.string().max(20,"Unit no. cannot exceed 20 characters").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid unit no. format").optional()}),ne=({formLead:s,setFormLead:c})=>{const[o,j]=f.useState({}),y=K(d=>{const t=a=>{var l,h;return((h=(l=d.address_components)==null?void 0:l.find(i=>i.types.includes(a)))==null?void 0:h.long_name)||""};c(a=>({...a,address:`${t("street_number")} ${t("route")}`.trim(),city:t("locality"),state:t("administrative_area_level_1"),country:t("country"),postal_code:t("postal_code")}))}),n=(d,t)=>{const a=I.sanitize(t);let l="";const h={...s,[d]:a},i=oe.safeParse(h);if(!i.success){const v=i.error.errors.find(A=>A.path[0]===d);l=v?v.message:""}j(v=>({...v,[d]:l})),c(h)},m=[{label:"Address",key:"address",placeholder:"Enter street address"},{label:"City",key:"city",placeholder:"Enter city name"},{label:"State",key:"state",placeholder:"Enter state"},{label:"Country",key:"country",placeholder:"Enter country"},{label:"Postal Code",key:"postal_code",placeholder:"Enter postal code"},{label:"Unit No.",key:"unit_no",placeholder:"Enter unit number"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Address Details"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:m.map(({label:d,key:t,placeholder:a})=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:t,children:d}),e.jsx("input",{type:"text",id:t,placeholder:a,value:s[t]||"",onChange:l=>n(t,l.target.value),ref:t==="address"?y:void 0}),o[t]&&e.jsx("span",{className:"error",style:{color:"red"},children:o[t]})]},t))})]})},ie=u.object({follow_up_date:u.string().regex(/^\d{2}-\d{2}-\d{4}$/,{message:"Date must be in DD-MM-YYYY format"}).optional(),contact_person:u.string().max(200,"Contact name must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),lead_type:u.enum(["AB","BC","BDS","CA","DPD MAGMA","MB","ON","Super Leads","TBAB","USA"],{errorMap:()=>({message:"Invalid lead type"})}),equipment_type:u.enum(["Van","Reefer","Flatbed","Triaxle","Maxi","Btrain","Roll tite"],{errorMap:()=>({message:"Invalid equipment type"})}).optional(),assigned_to:u.string().min(1,"Assigned To is required").max(200,"Assigned To must be at most 200 characters long").regex(/^[a-zA-Z\s'-]+$/,"Only letters, spaces, apostrophes, and hyphens allowed").optional(),notes:u.string().max(500,"Notes must be at most 200 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional()}),ce=({formLead:s,setFormLead:c})=>{const[o,j]=f.useState({}),x="http://127.0.0.1:8000/api",[y,n]=f.useState([]);f.useEffect(()=>{(async()=>{var a,l;try{const h=localStorage.getItem("token");if(!h)throw new Error("No token found. Please log in.");const v=(await P.get(`${x}/user`,{headers:{Authorization:`Bearer ${h}`}})).data.filter(A=>A.role==="employee");n(v)}catch(h){console.error("Error fetching users:",h),w.fire({icon:"error",title:((a=h.response)==null?void 0:a.status)===401?"Unauthorized":"Error",text:((l=h.response)==null?void 0:l.status)===401?"You are not authorized to view this data. Please log in again.":"An error occurred while fetching users. Please try again."})}})()},[x]);const m=(t,a)=>{const l=I.sanitize(a);let h="",i=l;if(t==="follow_up_date"&&/^\d{4}-\d{2}-\d{2}$/.test(l)){const[N,C,D]=l.split("-");i=`${D}-${C}-${N}`}const v={...s,[t]:i},A=ie.safeParse(v);if(!A.success){const N=A.error.errors.find(C=>C.path[0]===t);h=N?N.message:""}j(N=>({...N,[t]:h})),c(N=>({...N,[t]:l}))},d=[{label:"Next Follow-Up Date",key:"follow_up_date",type:"date",placeholder:"Enter follow-up date"},{label:"Contact Person",key:"contact_person",type:"text",placeholder:"Enter contact person"}];return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Additional Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[d.map(({label:t,key:a,type:l,placeholder:h})=>e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:a,children:t}),e.jsx("input",{type:l,id:a,placeholder:h,value:s[a]||"",onChange:i=>m(a,i.target.value)}),o[a]&&e.jsx("span",{className:"error",style:{color:"red"},children:o[a]})]},a)),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"equipmentType",children:"Equipment Type"}),e.jsxs("select",{id:"equipmentType",value:s.equipment_type||"",onChange:t=>c(a=>({...a,equipment_type:t.target.value})),children:[e.jsx("option",{value:"",children:"Select Equipment Type"}),e.jsx("option",{value:"Van",children:"Van"}),e.jsx("option",{value:"Reefer",children:"Reefer"}),e.jsx("option",{value:"Flatbed",children:"Flatbed"}),e.jsx("option",{value:"Triaxle",children:"Triaxle"}),e.jsx("option",{value:"Maxi",children:"Maxi"}),e.jsx("option",{value:"Btrain",children:"Btrain"}),e.jsx("option",{value:"Roll tite",children:"Roll tite"})]}),o.equipment_type&&e.jsx("span",{className:"error",style:{color:"red"},children:o.equipment_type})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"assignedTo",children:"Assigned To"}),e.jsxs("select",{id:"assignedTo",value:s.assigned_to,onChange:t=>m("assigned_to",t.target.value),children:[e.jsx("option",{value:"",children:"Select Employee"}),y.map(t=>e.jsx("option",{value:t.name,children:t.name},t.name))]}),o.assigned_to&&e.jsx("span",{className:"error",style:{color:"red"},children:o.assigned_to})]})]}),e.jsx("div",{className:"form-row",style:{display:"flex"},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("textarea",{id:"notes",placeholder:"Enter notes",value:s.notes||"",onChange:t=>m("notes",t.target.value),style:{width:"100%",minHeight:"100px"}}),o.notes&&e.jsx("span",{className:"error",style:{color:"red"},children:o.notes})]})})]})},de=({lead:s,onClose:c,onUpdate:o})=>{const{formLead:j,setFormLead:x,updateLead:y,handleAddContact:n,handleRemoveContact:m,handleContactChange:d}=X(s,c,o);return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:t=>{t.preventDefault(),y()},className:"form-main",children:[e.jsx(re,{formLead:j,setFormLead:x}),e.jsx(ne,{formLead:j,setFormLead:x}),e.jsx(ce,{formLead:j,setFormLead:x}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",children:[j.contacts.map((t,a)=>e.jsx(ae,{contacts:j.contacts,index:a,onAddContact:n,handleContactChange:d,handleRemoveContact:m},a)),j.contacts.length===0&&e.jsx("button",{type:"button",onClick:n,className:"add-button",children:e.jsx(U,{})})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Save"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:c,children:"Cancel"})]})]})})},me=({formLead:s})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Lead Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadNo",children:"Lead No"}),e.jsx("div",{children:s.lead_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadDate",children:"Lead Date"}),e.jsx("div",{children:s.lead_date||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"customerName",children:"Customer Name"}),e.jsx("div",{children:s.customer_name||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"phone",children:"Phone"}),e.jsx("div",{children:s.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("div",{children:s.email||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"website",children:"Website"}),e.jsx("div",{children:s.website||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadType",children:"Lead Type"}),e.jsx("div",{children:s.lead_type||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"leadStatus",children:"Lead Status"}),e.jsx("div",{children:s.lead_status||"N/A"})]})]})]}),pe=({formLead:s})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Address Details"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"address",children:"Address"}),e.jsx("div",{children:s.address||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"unitNo",children:"Unit No"}),e.jsx("div",{children:s.unit_no||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"city",children:"City"}),e.jsx("div",{children:s.city||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"state",children:"State"}),e.jsx("div",{children:s.state||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"country",children:"Country"}),e.jsx("div",{children:s.country||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"postalCode",children:"Postal Code"}),e.jsx("div",{children:s.postal_code||"N/A"})]})]})]}),he=({formLead:s})=>{const c="http://127.0.0.1:8000/api",[o,j]=f.useState([]);return f.useEffect(()=>{(async()=>{var y;try{const n=localStorage.getItem("token");if(!n)throw new Error("No token found. Please log in.");const d=(await P.get(`${c}/user`,{headers:{Authorization:`Bearer ${n}`}})).data.filter(t=>t.role==="employee");j(d)}catch(n){console.error("Error fetching users:",n),((y=n.response)==null?void 0:y.status)===401?w.fire({icon:"error",title:"Unauthorized",text:"You are not authorized to view this data. Please log in again."}):w.fire({icon:"error",title:"Error",text:"An error occurred while fetching users. Please try again."})}})()},[]),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Additional Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"follow_up_date",children:"Next Follow-Up Date"}),e.jsx("div",{children:s.follow_up_date||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"equipmentType",children:"Equipment Type"}),e.jsx("div",{children:s.equipment_type||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"assignedTo",children:"Assigned To"}),e.jsx("div",{children:s.assigned_to||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"contactPerson",children:"Contact Person"}),e.jsx("div",{children:s.contact_person||"N/A"})]})]}),e.jsx("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{htmlFor:"notes",children:"Notes"}),e.jsx("div",{children:s.notes||"N/A"})]})})]})},ue=({contact:s,index:c,onRemove:o})=>e.jsxs("div",{className:"contact-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:s.name||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:s.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:s.email||"N/A"})]})]}),xe=({lead:s,onClose:c})=>{const[o,j]=f.useState({id:0,lead_no:"",lead_date:"",customer_name:"",phone:"",email:"",website:"",address:"",unit_no:"",city:"",state:"",country:"",postal_code:"",equipment_type:"",lead_type:"",lead_status:"",contact_person:"",notes:"",follow_up_date:"",assigned_to:"",contacts:[]});return f.useEffect(()=>{if(s){let x=[];if(Array.isArray(s.contacts))x=s.contacts;else if(typeof s.contacts=="string")try{x=JSON.parse(s.contacts)||[]}catch{x=[]}j({...s,contacts:x.length>0?x:[]})}},[s]),e.jsx("div",{className:"form-container",children:e.jsxs("form",{className:"form-main",children:[e.jsx(me,{formLead:o}),e.jsx(pe,{formLead:o}),e.jsx(he,{formLead:o}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:o.contacts&&o.contacts.map((x,y)=>e.jsx(ue,{contact:x,index:y},y))})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"button",className:"btn-cancel",onClick:c,style:{padding:"9px 15px"},children:"Cancel"})})]})})},T="http://127.0.0.1:8000/api",ge=()=>{const[s,c]=f.useState([]),[o,j]=f.useState(!0),[x,y]=f.useState(""),[n,m]=f.useState("created_at"),[d,t]=f.useState(!0),[a,l]=f.useState(1),[h,i]=f.useState(null),[v,A]=f.useState(!1),[N,C]=f.useState(!1),[D,M]=f.useState(!1),[S,E]=f.useState([]),[$,L]=f.useState(10),F=async()=>{try{const r=localStorage.getItem("token");if(!r)throw new Error("No token found");j(!0);const{data:b}=await P.get(`${T}/lead`,{headers:{Authorization:`Bearer ${r}`}}),g=b.filter(_=>_.lead_status==="Quotations");c(g)}catch(r){console.error("Error loading leads:",r),B(r)}finally{j(!1)}};f.useEffect(()=>{F()},[]);const B=r=>{r.response&&r.response.status===401&&w.fire({icon:"error",title:"Unauthorized",text:"You need to log in to access this resource."})},p=r=>{n===r?t(!d):(m(r),t(!1))},z=s.filter(r=>Object.values(r).some(b=>b!=null&&b.toString().toLowerCase().includes(x.toLowerCase()))),k=z.sort((r,b)=>{let g=r[n]??"",_=b[n]??"";return typeof g=="string"&&typeof _=="string"?d?_.localeCompare(g):g.localeCompare(_):typeof g=="number"&&typeof _=="number"?d?_-g:g-_:0}).slice((a-1)*$,a*$),Y=Math.ceil(z.length/$);return{fetchLeads:F,leads:s,loading:o,convertToCustomer:async r=>{if((await w.fire({title:"Are you sure?",text:"This lead will be converted to a customer.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, convert it!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const g=localStorage.getItem("token");if(!g)throw new Error("No token found");const _={cust_name:r.customer_name,cust_email:r.email,cust_primary_state:r.state};console.log("Customer data to be inserted:",_);const Z=await P.post(`${T}/customer`,_,{headers:{Authorization:`Bearer ${g}`}});console.log("Converted to customer:",Z.data),await P.delete(`${T}/lead/${r.id}`,{headers:{Authorization:`Bearer ${g}`}}),c(Q=>Q.filter(G=>G.id!==r.id)),w.fire("Converted!","The lead has been converted to a customer.","success")}catch(g){console.error("Error converting lead to customer:",g),w.fire({icon:"error",title:"Error!",text:"Failed to convert the lead to a customer."})}},searchQuery:x,setSearchQuery:y,sortBy:n,sortDesc:d,selectedIds:S,setSelectedIds:E,paginatedData:k,totalPages:Y,currentPage:a,setCurrentPage:l,isEditModalOpen:v,isAddModalOpen:N,isViewModalOpen:D,selectedLead:h,openEditModal:r=>{i(r),A(!0)},closeEditModal:()=>{A(!1),i(null)},openViewModal:r=>{i(r),M(!0)},closeViewModal:()=>{M(!1),i(null)},setEditModalOpen:A,setAddModalOpen:C,setViewModalOpen:M,toggleSelectAll:()=>{S.length===k.length?E([]):E(k.map(r=>r.id))},toggleSelect:r=>{E(b=>b.includes(r)?b.filter(g=>g!==r):[...b,r])},deleteSelected:async()=>{if(S.length===0){w.fire({icon:"warning",title:"No record selected",text:"Please select a record to delete."});return}if((await w.fire({title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete selected!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const b=localStorage.getItem("token");if(!b)throw new Error("No token found");await Promise.all(S.map(g=>P.delete(`${T}/lead/${g}`,{headers:{Authorization:`Bearer ${b}`}}))),c(g=>g.filter(_=>!S.includes(_.id))),E([]),w.fire("Deleted!","Selected leads have been deleted.","success")}catch(b){console.error("Error deleting leads:",b),w.fire({icon:"error",title:"Error!",text:"Failed to delete selected leads."})}},handleSort:p,updateLead:r=>{c(b=>b.map(g=>g.id===r.id?{...g,...r}:g))},handlePageChange:r=>{l(r)}}},fe=()=>{const{leads:s,loading:c,convertToCustomer:o,searchQuery:j,setSearchQuery:x,sortBy:y,sortDesc:n,selectedIds:m,paginatedData:d,totalPages:t,currentPage:a,isEditModalOpen:l,isViewModalOpen:h,selectedLead:i,openEditModal:v,openViewModal:A,setEditModalOpen:N,setViewModalOpen:C,toggleSelectAll:D,toggleSelect:M,deleteSelected:S,handleSort:E,updateLead:$,handlePageChange:L}=ge(),F=p=>p.key==="checkbox"||p.key==="actions"?p.label:e.jsxs("div",{className:"sortable-header",onClick:()=>E(p.key),children:[p.label,e.jsx("span",{className:"sort-icon",children:y===p.key?n?"▼":"▲":"▼"})]}),B=[{key:"checkbox",label:e.jsx("input",{type:"checkbox",onChange:D,checked:m.length===d.length&&d.length>0}),render:p=>e.jsx("input",{type:"checkbox",checked:m.includes(p.id),onChange:()=>M(p.id)})},{key:"lead_no",label:"Lead#"},{key:"customer_name",label:"Name"},{key:"lead_date",label:"Date",render:p=>e.jsxs("div",{className:"date-picker-container-normal",children:[e.jsx(O,{style:{marginRight:5}}),p.lead_date?V(p.lead_date).format("DD MMM, YYYY"):"-"]})},{key:"city",label:"City"},{key:"lead_type",label:"Type"},{key:"assigned_to",label:"Assigned To",render:p=>e.jsx("span",{children:p.assigned_to||"Unassigned"})},{key:"follow_up_date",label:"Follow Up",render:p=>e.jsxs("div",{className:"date-picker-container",children:[e.jsx(O,{style:{marginRight:5}}),p.follow_up_date?V(p.follow_up_date).format("DD MMM, YYYY"):"-"]})},{key:"actions",label:"",render:p=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>A(p),className:"btn-view",children:e.jsx(ee,{})}),e.jsx("button",{onClick:()=>v(p),className:"btn-edit",children:e.jsx(H,{})}),p.lead_status==="Quotations"&&e.jsx("button",{onClick:()=>o(p),className:"btn-convert",children:"Convert to Customer"})]})}];return e.jsxs("div",{children:[e.jsxs("div",{className:"header-container",children:[e.jsx("div",{className:"header-container-left",children:e.jsx("h1",{className:"page-heading",children:"Leads with quotes"})}),e.jsxs("div",{className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(se,{className:"search-icon"}),e.jsx("input",{className:"search-bar",value:j,onChange:p=>x(p.target.value)})]}),e.jsx("button",{onClick:S,className:"delete-button",children:e.jsx(q,{})})]})]}),c?e.jsx("div",{children:"Loading..."}):s.length===0?e.jsx("div",{children:"No records found"}):e.jsx(W,{data:d,headers:B.map(p=>({...p,label:F(p)})),handleSort:E,sortBy:y,sortDesc:n}),e.jsx(J,{currentPage:a,totalPages:t,onPageChange:L}),e.jsx(R,{isOpen:l,onClose:()=>N(!1),title:"Edit Lead",children:i&&e.jsx(de,{lead:i,onClose:()=>N(!1),onUpdate:$})}),e.jsx(R,{isOpen:h,onClose:()=>C(!1),title:"Lead Details",children:i&&e.jsx(xe,{lead:i,onClose:()=>C(!1)})})]})},ke=()=>e.jsx("div",{children:e.jsx(fe,{})});export{ke as default};

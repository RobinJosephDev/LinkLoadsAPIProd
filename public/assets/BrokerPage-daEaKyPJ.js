import{r as b,j as e,S as k,b as N}from"./index-DsiLbZ9r.js";import{b as G,R as H,a as J,T as K,M as R}from"./Modal-Dy5-4all.js";import{z as h,P as W}from"./Pagination-rW2CcH_q.js";/* empty css             */import{u as Y}from"./useGoogleAutocomplete--4rnTPXT.js";import X from"./purify.es-Ci5xwkH_.js";import{o as ee,R as re}from"./EyeOutlined-B8J0i9Xp.js";import{R as te}from"./MailOutlined-ByH_xwX4.js";const ae=h.object({broker_name:h.string().min(1,"Name is required").max(200,"Name cannot exceed 200 characters").regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed"),broker_address:h.string().max(255,"Street cannot be more than 255 characters").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),broker_city:h.string().max(200,"City cannot be more than 200 characters").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),broker_state:h.string().max(200,"State cannot be more than 200 characters").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),broker_country:h.string().max(100,"Country cannot be more than 100 characters").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),broker_postal:h.string().max(20,"Postal Code cannot be more than 20 characters").regex(/^[0-9a-zA-Z\s-]*$/,"Invalid postal code format").optional(),broker_email:h.string().max(255,"Email cannot be more than 255 characters").email("Invalid email format").optional(),broker_phone:h.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),broker_ext:h.string().regex(/^\+?[0-9]{0,10}$/,"Invalid extension").optional(),broker_fax:h.string().max(20,"Fax exceed 20 characters").regex(/^[0-9-+()\s]*$/,"Invalid fax format").optional()}),se=({broker:r,setBroker:c})=>{const[l,i]=b.useState({}),f=Y(o=>{const t=n=>{var m,d;return((d=(m=o.address_components)==null?void 0:m.find(x=>x.types.includes(n)))==null?void 0:d.long_name)||""};c(n=>({...n,broker_address:`${t("street_number")} ${t("route")}`.trim(),broker_city:t("locality"),broker_state:t("administrative_area_level_1"),broker_country:t("country"),broker_postal:t("postal_code")}))}),u=(o,t)=>{let n="";const m={...r,[o]:t},d=ae.safeParse(m);if(!d.success){const x=d.error.errors.find(_=>_.path[0]===o);n=x?x.message:""}i(x=>({...x,[o]:n})),c(m)},j=[{label:"Name",key:"broker_name",placeholder:"Enter broker name"},{label:"Street",key:"broker_address",placeholder:"123 Main St"},{label:"City",key:"broker_city",placeholder:"Enter city"},{label:"State",key:"broker_state",placeholder:"Enter state"},{label:"Country",key:"broker_country",placeholder:"Enter country"},{label:"Postal Code",key:"broker_postal",placeholder:"12345"},{label:"Email",key:"broker_email",type:"email",placeholder:"example@email.com"},{label:"Phone",key:"broker_phone",placeholder:"(123) 456-7890"},{label:"Ext",key:"broker_ext",placeholder:"Enter extension"},{label:"Fax",key:"broker_fax",placeholder:"(123) 456-7890"}];return e.jsx("fieldset",{children:e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:j.map(({label:o,key:t,type:n,placeholder:m})=>e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:t,children:[o," ",t==="broker_name"&&e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:t,type:n||"text",value:r[t]||"",onChange:d=>u(t,d.target.value),ref:t==="broker_address"?f:void 0,placeholder:m}),l[t]&&e.jsx("span",{className:"error",style:{color:"red"},children:l[t]})]},t))})})},q="https://linkloadsapiprod.onrender.com/api",oe=(r,c)=>{const[l,i]=b.useState({id:0,broker_name:"",broker_address:"",broker_city:"",broker_state:"",broker_country:"",broker_postal:"",broker_email:"",broker_phone:"",broker_ext:"",broker_fax:"",created_at:"",updated_at:""}),g=()=>!!l.broker_name,f=async j=>{if(j.preventDefault(),!g()){k.fire("Validation Error","Please fill in all required fields.","error");return}try{let o;const t=localStorage.getItem("token");if(!t){k.fire("Error","No token found","error");return}const n={Authorization:`Bearer ${t}`};l.id?(o=await N.put(`${q}/broker/${l.id}`,l,{headers:n}),k.fire("Success!","Broker details updated.","success")):(o=await N.post(`${q}/broker`,l,{headers:n}),k.fire("Success!","Broker added successfully.","success")),u(),c()}catch(o){console.error("Error saving/updating broker:",o.response?o.response.data:o.message),k.fire("Error","An error occurred while saving/updating the broker.","error")}},u=()=>{i({id:0,broker_name:"",broker_address:"",broker_city:"",broker_state:"",broker_country:"",broker_postal:"",broker_email:"",broker_phone:"",broker_ext:"",broker_fax:"",created_at:"",updated_at:""})};return{broker:l,setBroker:i,handleSubmit:f}},ne=({onClose:r,onSuccess:c})=>{const{broker:l,setBroker:i,handleSubmit:g}=oe(r,c);return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:g,className:"form-main",children:[e.jsx(se,{broker:l,setBroker:i}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Add Broker"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:r,children:"Cancel"})]})]})})},le=({broker:r,onUpdate:c,onClose:l})=>{const[i,g]=b.useState({id:0,broker_name:"",broker_address:"",broker_city:"",broker_state:"",broker_country:"",broker_postal:"",broker_email:"",broker_phone:"",broker_ext:"",broker_fax:"",created_at:"",updated_at:""}),f="https://linkloadsapiprod.onrender.com/api";b.useEffect(()=>{r&&g({id:r.id||0,broker_name:r.broker_name||"",broker_address:r.broker_address||"",broker_city:r.broker_city||"",broker_state:r.broker_state||"",broker_country:r.broker_country||"",broker_postal:r.broker_postal||"",broker_email:r.broker_email||"",broker_phone:r.broker_phone||"",broker_ext:r.broker_ext||"",broker_fax:r.broker_fax||"",created_at:r.created_at||"",updated_at:r.updated_at||""})},[r]);const u=()=>!!i.broker_name;return{formBroker:i,setFormBroker:g,updateBroker:async()=>{var o;if(!u()){k.fire("Validation Error","Please fill in all required fields.","error");return}try{const t=localStorage.getItem("token");if(!t){k.fire({icon:"error",title:"Unauthorized",text:"You are not logged in. Please log in again."});return}const n=await N.put(`${f}/broker/${i.id}`,i,{headers:{Authorization:`Bearer ${t}`}});k.fire({icon:"success",title:"Success!",text:"Broker details updated."}),c(n.data),l()}catch(t){console.error("Error updating broker:",t),k.fire({icon:"error",title:"Oops...",text:((o=t.response)==null?void 0:o.status)===401?"Unauthorized. Please log in again.":"Failed to update broker."})}}}},ie=h.object({broker_name:h.string().min(1,"Name is required").max(200).regex(/^[a-zA-Z0-9\s.,'-]+$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed"),broker_address:h.string().max(255,"Street cannot be more than 255 characters").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),broker_city:h.string().max(200,"City cannot be more than 200 characters").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),broker_state:h.string().max(200,"State cannot be more than 200 characters").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),broker_country:h.string().max(100,"Country cannot be more than 100 characters").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),broker_postal:h.string().max(20,"Postal Code cannot be more than 20 characters").regex(/^[0-9a-zA-Z\s-]*$/,"Invalid postal code format").optional(),broker_email:h.string().max(255,"Email cannot be more than 255 characters").email("Invalid email format").optional(),broker_phone:h.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),broker_ext:h.string().regex(/^\+?[0-9]{0,10}$/,"Invalid extension").optional(),broker_fax:h.string().max(20,"Fax exceed 20 characters").regex(/^[0-9-+()\s]*$/,"Invalid fax format").optional()}),ce=({formBroker:r,setFormBroker:c})=>{const[l,i]=b.useState({}),f=Y(o=>{const t=n=>{var m,d;return((d=(m=o.address_components)==null?void 0:m.find(x=>x.types.includes(n)))==null?void 0:d.long_name)||""};c(n=>({...n,broker_address:`${t("street_number")} ${t("route")}`.trim(),broker_city:t("locality"),broker_state:t("administrative_area_level_1"),broker_country:t("country"),broker_postal:t("postal_code")}))}),u=(o,t)=>{var d;const n=X.sanitize(t.trim());c(x=>({...x,[o]:n}));const m=ie.safeParse({...r,[o]:n});if(m.success)i(x=>({...x,[o]:""}));else{const x=((d=m.error.errors.find(_=>_.path[0]===o))==null?void 0:d.message)||"";i(_=>({..._,[o]:x}))}},j=[{label:"Name",key:"broker_name"},{label:"Street",key:"broker_address"},{label:"City",key:"broker_city"},{label:"State",key:"broker_state"},{label:"Country",key:"broker_country"},{label:"Postal Code",key:"broker_postal"},{label:"Email",key:"broker_email",type:"email"},{label:"Phone",key:"broker_phone"},{label:"Ext",key:"broker_ext"},{label:"Fax",key:"broker_fax"}];return e.jsx("fieldset",{children:e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:j.map(({label:o,key:t,type:n})=>e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:t,children:[o," ",t==="broker_name"&&e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{id:t,type:n||"text",value:r[t]||"",onChange:m=>u(t,m.target.value),ref:t==="broker_address"?f:void 0}),l[t]&&e.jsx("span",{className:"error",style:{color:"red"},children:l[t]})]},t))})})},de=({broker:r,onClose:c,onUpdate:l})=>{const{formBroker:i,setFormBroker:g,updateBroker:f}=le({broker:r,onUpdate:l,onClose:c});return e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:u=>{u.preventDefault(),f()},className:"form-main",children:[e.jsx(ce,{formBroker:i,setFormBroker:g}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Save Changes"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:c,children:"Cancel"})]})]})})},be=({formBroker:r})=>e.jsxs("fieldset",{children:[e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Name"}),e.jsx("span",{children:(r==null?void 0:r.broker_name)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Street"}),e.jsx("span",{children:(r==null?void 0:r.broker_address)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"City"}),e.jsx("span",{children:(r==null?void 0:r.broker_city)||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"State"}),e.jsx("span",{children:(r==null?void 0:r.broker_state)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Country"}),e.jsx("span",{children:(r==null?void 0:r.broker_country)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Postal Code"}),e.jsx("span",{children:(r==null?void 0:r.broker_postal)||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Email"}),e.jsx("span",{children:(r==null?void 0:r.broker_email)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Phone"}),e.jsx("span",{children:(r==null?void 0:r.broker_phone)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Phone Extension"}),e.jsx("span",{children:(r==null?void 0:r.broker_ext)||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Fax"}),e.jsx("span",{children:(r==null?void 0:r.broker_fax)||"N/A"})]})]})]}),Q={id:0,broker_name:"",broker_address:"",broker_city:"",broker_state:"",broker_country:"",broker_postal:"",broker_email:"",broker_phone:"",broker_ext:"",broker_fax:"",created_at:"",updated_at:""},he=({broker:r,onClose:c})=>{const[l,i]=b.useState(Q);return b.useEffect(()=>{i(r??Q)},[r]),e.jsx("div",{className:"form-container",children:e.jsxs("form",{className:"form-main",children:[e.jsx(be,{formBroker:l}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"button",className:"btn-cancel",onClick:c,style:{padding:"9px 15px"},children:"Cancel"})})]})})},L="https://linkloadsapiprod.onrender.com/api",me=()=>{const[r,c]=b.useState([]),[l,i]=b.useState(!0),[g,f]=b.useState(""),[u,j]=b.useState("created_at"),[o,t]=b.useState(!0),[n,m]=b.useState(1),[d,x]=b.useState(null),[_,v]=b.useState([]),[V,P]=b.useState(!1),[Z,T]=b.useState(!1),[I,S]=b.useState(!1),[F,C]=b.useState(!1),[E,M]=b.useState(null),[A,$]=b.useState(10),O=async()=>{try{const a=localStorage.getItem("token");if(!a)throw new Error("No token found");i(!0);const{data:p}=await N.get(`${L}/broker`,{headers:{Authorization:`Bearer ${a}`}});c(p)}catch(a){console.error("Error loading brokers:",a),B(a)}finally{i(!1)}};b.useEffect(()=>{O()},[]);const B=a=>{var p;((p=a.response)==null?void 0:p.status)===401&&k.fire({icon:"error",title:"Unauthorized",text:"You need to log in to access this resource."})},z=r.filter(a=>Object.values(a).some(p=>p&&p.toString().toLowerCase().includes(g.toLowerCase()))),w=z.sort((a,p)=>{let y=a[u]||"",D=p[u]||"";return o?D.toString().localeCompare(y.toString()):y.toString().localeCompare(D.toString())}).slice((n-1)*A,n*A),s=Math.ceil(z.length/A);return{fetchBrokers:O,brokers:r,setSelectedBrokers:v,loading:l,searchQuery:g,setSearchQuery:f,sortBy:u,sortDesc:o,paginatedData:w,totalPages:s,currentPage:n,handlePageChange:a=>{m(a)},handleSort:a=>{u===a?t(!o):(j(a),t(!1))},selectedBrokers:_,toggleSelectAll:()=>{_.length===w.length?v([]):v(w.map(a=>a.id).filter(a=>a!==void 0))},toggleSelect:a=>{v(p=>p.includes(a)?p.filter(y=>y!==a):[...p,a])},deleteSelected:async()=>{if(!_.length){k.fire({icon:"warning",title:"No record selected",text:"Please select a record to delete."});return}if((await k.fire({title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete selected!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const p=localStorage.getItem("token");if(!p)throw new Error("No token found");await Promise.all(_.map(y=>N.delete(`${L}/broker/${y}`,{headers:{Authorization:`Bearer ${p}`}}))),c(y=>y.filter(D=>!_.includes(D.id))),v([]),k.fire("Deleted!","The selected brokers have been removed.","success")}catch(p){console.error("Error deleting selected brokers:",p),k.fire({icon:"error",title:"Error!",text:"Failed to delete selected brokers."})}},isEditModalOpen:V,isAddModalOpen:Z,isViewModalOpen:I,isEmailModalOpen:F,setEditModalOpen:P,setAddModalOpen:T,setViewModalOpen:S,setEmailModalOpen:C,emailData:E,setEmailData:M,sendEmails:async()=>{if(_.length===0){k.fire({icon:"warning",title:"No brokers selected",text:"Please select a broker to send an email to."});return}try{const a=localStorage.getItem("token");if(!a)throw new Error("No token found");await N.post(`${L}/email`,{ids:_,...E,module:"brokers"},{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}),k.fire("Success!","Email sent.","success"),C(!1),v([])}catch(a){console.error("Error sending email:",a),k.fire("Error!","Failed to send email.","error")}},selectedBroker:d,openEditModal:a=>{x(a),P(!0)},openViewModal:a=>{x(a),S(!0)},updateBroker:a=>{c(p=>p.map(y=>y.id===a.id?{...y,...a}:y))}}},pe=()=>{const{fetchBrokers:r,brokers:c,loading:l,searchQuery:i,setSearchQuery:g,sortBy:f,sortDesc:u,paginatedData:j,totalPages:o,currentPage:t,handlePageChange:n,handleSort:m,selectedBrokers:d,toggleSelectAll:x,toggleSelect:_,deleteSelected:v,isEditModalOpen:V,isAddModalOpen:P,isViewModalOpen:Z,isEmailModalOpen:T,setEditModalOpen:I,setAddModalOpen:S,setViewModalOpen:F,setEmailModalOpen:C,emailData:E,setEmailData:M,sendEmails:A,selectedBroker:$,openEditModal:O,openViewModal:B,updateBroker:z}=me(),U=s=>s.key==="checkbox"||s.key==="actions"?s.label:e.jsxs("div",{className:"sortable-header",onClick:()=>m(s.key),children:[s.label,e.jsx("span",{className:"sort-icon",children:f===s.key?u?"▼":"▲":"▼"})]}),w=[{key:"checkbox",label:e.jsx("input",{type:"checkbox",onChange:x,checked:d.length===j.length&&j.length>0}),render:s=>e.jsx("input",{type:"checkbox",checked:d.includes(s.id),onChange:()=>_(s.id)})},{key:"broker_name",label:"Name",render:s=>s.broker_name||e.jsx("span",{children:"-"})},{key:"broker_city",label:"City",render:s=>s.broker_city||e.jsx("span",{children:"-"})},{key:"broker_state",label:"State",render:s=>s.broker_state||e.jsx("span",{children:"-"})},{key:"broker_email",label:"Email",render:s=>s.broker_email||e.jsx("span",{children:"-"})},{key:"broker_phone",label:"Phone",render:s=>s.broker_phone||e.jsx("span",{children:"-"})},{key:"broker_fax",label:"Fax",render:s=>s.broker_fax||e.jsx("span",{children:"-"})},{key:"actions",label:"",render:s=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>B(s),className:"btn-view",children:e.jsx(ee,{})}),e.jsx("button",{onClick:()=>O(s),className:"btn-edit",children:e.jsx(G,{})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{className:"header-container",children:[e.jsx("div",{className:"header-container-left",children:e.jsx("h1",{className:"page-heading",children:"Brokers"})}),e.jsxs("div",{className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(re,{className:"search-icon"}),e.jsx("input",{className:"search-bar",value:i,onChange:s=>g(s.target.value)})]}),e.jsxs("button",{onClick:()=>S(!0),className:"add-button",children:[e.jsx(H,{})," New"]})]})]}),d.length>0&&e.jsxs("div",{className:"selection-banner",children:[e.jsxs("span",{children:[d.length," item",d.length>1?"s":""," selected"]}),e.jsxs("button",{onClick:()=>C(!0),className:"send-email-button",disabled:d.length===0,children:[e.jsx(te,{}),"  Send Email"]}),e.jsxs("button",{className:"text-delete-btn",onClick:v,children:[e.jsx(J,{}),"  Delete"]})]}),l?e.jsx("div",{children:"Loading..."}):c.length===0?e.jsx("div",{className:"no-record",children:"No records found"}):e.jsx(K,{data:j,headers:w.map(s=>({...s,label:U(s)})),handleSort:m,sortBy:f,sortDesc:u}),e.jsx(W,{currentPage:t,totalPages:o,onPageChange:n}),e.jsx(R,{isOpen:V,title:"Edit Broker",onClose:()=>I(!1),children:$&&e.jsx(de,{broker:$,onUpdate:z,onClose:()=>I(!1)})}),e.jsxs(R,{isOpen:P,onClose:()=>S(!1),title:"Add Broker",children:[e.jsx(ne,{onClose:()=>S(!1),onSuccess:r})," "]}),e.jsx(R,{isOpen:T,onClose:()=>C(!1),title:"Send Email",children:e.jsxs("div",{className:"email-modal",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"subject",children:"Subject:"}),e.jsx("input",{type:"text",placeholder:"Subject",onChange:s=>M({...E,subject:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",children:"Content:"}),e.jsx("textarea",{placeholder:"Content",onChange:s=>M({...E,content:s.target.value})})]}),e.jsx("button",{type:"submit",onClick:A,children:"Send"})]})}),e.jsx(R,{isOpen:Z,onClose:()=>F(!1),title:"Broker Details",children:$&&e.jsx(he,{broker:$,onClose:()=>F(!1)})})]})},Ie=()=>e.jsx("div",{children:e.jsx(pe,{})});export{Ie as default};

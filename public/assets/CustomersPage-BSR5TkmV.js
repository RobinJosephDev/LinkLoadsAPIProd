import{r as _,j as e,b as C,S as E}from"./index-CShLHsUt.js";import{z as d,R as F,a as D,b as se,T as te,P as ae,M}from"./Pagination-2Q04ZmxJ.js";/* empty css             */import $ from"./purify.es-Ci5xwkH_.js";import{u as V}from"./useGoogleAutocomplete-C2ALqIRo.js";import{o as re,R as ne}from"./EyeOutlined-B28M-sP9.js";import{R as le}from"./MailOutlined-O_E7qy0n.js";const H=["Manufacturer","Trader","Distributor","Retailer","Freight Forwarder"],ce=d.object({cust_name:d.string().min(1,"Customer is required").max(200,"Customer name cannot exceed 200 characters").regex(/^[a-zA-Z0-9\s.,'"-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed"),cust_ref_no:d.string().min(1,"Customer Ref. No is required").max(100,"Customer Ref. No cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'"-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed"),cust_type:d.enum(H,{errorMap:()=>({message:"Invalid customer type"})}),cust_website:d.string().url("Invalid website URL format").max(150,"Website URL cannot exceed 150 characters").optional(),cust_email:d.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),cust_contact_no:d.string().max(30,"Contact no cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),cust_contact_no_ext:d.string().max(10,"Phone Ext cannot exceed 10 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and hyphens allowed").optional(),cust_tax_id:d.string().max(20,"Tax ID cannot exceed 20 characters").regex(/^[a-zA-Z0-9\s_/.-]*$/,"Only letters, numbers, dashes, underscores, slashes, and spaces allowed").optional()}),ie=[{key:"cust_website",label:"Website",placeholder:"Enter website",type:"text"},{key:"cust_email",label:"Email",placeholder:"Enter email",type:"text"},{key:"cust_contact_no",label:"Contact no",placeholder:"Enter contact no",type:"text"},{key:"cust_contact_no_ext",label:"Extension",placeholder:"Enter contact extension",type:"text"},{key:"cust_tax_id",label:"Tax id",placeholder:"Enter tax id",type:"text"}],oe=({formCustomer:s,setFormCustomer:h})=>{const[u,m]=_.useState({}),[o,g]=_.useState([]),[f,y]=_.useState([]),p="http://127.0.0.1:8000/api";_.useEffect(()=>{(async()=>{try{const r=localStorage.getItem("token"),n=await C.get(`${p}/customer`,{headers:{Authorization:`Bearer ${r}`}});if(!n||!n.data){console.error("API response is undefined or invalid:",n);return}console.log("Fetched customers:",n.data);const a=n.data.map(c=>({value:c.cust_name,label:c.cust_name,refNo:c.cust_ref_no}));g(a)}catch(r){console.error("Error fetching customers:",r)}})()},[]),_.useEffect(()=>{if(s.cust_name){const t=o.find(r=>r.value===s.cust_name);y(t?[{value:t.refNo,label:t.refNo}]:[])}else y([])},[s.cust_name,o]);const l=(t,r)=>{let n=r,a="";const c={...s,[t]:n},i=ce.safeParse(c);if(!i.success){const x=i.error.errors.find(j=>j.path[0]===t);a=x?x.message:""}m(x=>({...x,[t]:a})),h(c)};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Customer Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"customer",children:["Customer ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"quote_customer",value:s.cust_name||"",onChange:t=>l("cust_name",t.target.value),onBlur:()=>l("cust_name",s.cust_name||""),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a customer"}),o.length>0?o.map((t,r)=>e.jsx("option",{value:t.value,children:t.label},`${t.refNo}-${r}`)):e.jsx("option",{disabled:!0,children:"No customers found"})]}),u.cust_name&&e.jsx("span",{className:"error",style:{color:"red"},children:u.cust_name})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{htmlFor:"customerRefNo",children:["Customer Ref. No ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"quote_customer_ref_no",value:s.cust_ref_no||"",onChange:t=>l("cust_ref_no",t.target.value),onBlur:()=>l("cust_ref_no",s.cust_ref_no||""),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select a reference number"}),f.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),u.cust_ref_no&&e.jsx("span",{className:"error",style:{color:"red"},children:u.cust_ref_no})]}),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsxs("label",{htmlFor:"loadType",children:["Customer Type ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs("select",{id:"loadType",value:s.cust_type,onChange:t=>h(r=>({...r,cust_type:t.target.value})),children:[e.jsx("option",{value:"",disabled:!0,children:"Select..."}),H.map(t=>e.jsx("option",{value:t,children:t},t))]}),u.load_type&&e.jsx("span",{className:"error",style:{color:"red"},children:u.load_type})]}),ie.map(({key:t,label:r,placeholder:n,type:a})=>e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsx("label",{htmlFor:t,children:r}),e.jsx("input",{type:a,id:t,placeholder:n,value:String(s[t]||""),onChange:c=>l(t,c.target.value)}),u[t]&&e.jsx("span",{className:"error",style:{color:"red"},children:u[t]})]},t))]})]})},de=d.object({cust_primary_address:d.string().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),cust_primary_city:d.string().max(200,"City name is too long").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),cust_primary_state:d.string().max(200,"Invalid state").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),cust_primary_country:d.string().max(100,"Invalid country").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),cust_primary_postal:d.string().max(20,"Postal code cannot exceed 20 characters").regex(/^[a-zA-Z0-9\s-]*$/,"Invalid postal code").optional(),cust_primary_unit_no:d.string().max(30,"Unit No cannot exceed 30 characters").regex(/^[a-zA-Z0-9#/\s-]*$/,"Only letters, numbers, #, hyphens, slashes, and spaces allowed").optional()});function ue({formCustomer:s,setFormCustomer:h}){const[u,m]=_.useState({}),g=V(p=>{const l=t=>{var r,n;return((n=(r=p.address_components)==null?void 0:r.find(a=>a.types.includes(t)))==null?void 0:n.long_name)||""};h(t=>({...t,cust_primary_address:`${l("street_number")} ${l("route")}`.trim(),cust_primary_city:l("locality"),cust_primary_state:l("administrative_area_level_1"),cust_primary_country:l("country"),cust_primary_postal:l("postal_code")}))}),f=(p,l)=>{const t=$.sanitize(l);let r="";const n={...s,[p]:t},a=de.safeParse(n);if(!a.success){const c=a.error.errors.find(i=>i.path[0]===p);r=c?c.message:""}m(c=>({...c,[p]:r})),h(n)},y=[{label:"Street",key:"cust_primary_address",placeholder:"Enter street address"},{label:"City",key:"cust_primary_city",placeholder:"Enter city name"},{label:"State",key:"cust_primary_state",placeholder:"Enter state"},{label:"Country",key:"cust_primary_country",placeholder:"Enter country"},{label:"Postal Code",key:"cust_primary_postal",placeholder:"Enter postal code"},{label:"Unit No.",key:"cust_primary_unit_no",placeholder:"Enter Unit No."}];return e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Primary Address"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:y.map(({label:p,key:l,placeholder:t})=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:l,children:p}),e.jsx("input",{type:"text",id:l,placeholder:t,value:s[l]||"",onChange:r=>f(l,r.target.value),ref:l==="cust_primary_address"?g:void 0}),u[l]&&e.jsx("span",{className:"error",style:{color:"red"},children:u[l]})]},l))})]})}const me=d.object({cust_mailing_address:d.string().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),cust_mailing_city:d.string().max(200,"City name is too long").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),cust_mailing_state:d.string().max(200,"Invalid state").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),cust_mailing_country:d.string().max(100,"Invalid country").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),cust_mailing_postal:d.string().max(20,"Postal code cannot exceed 20 characters").regex(/^[a-zA-Z0-9\s-]*$/,"Invalid postal code").optional(),cust_mailing_unit_no:d.string().max(30,"Unit No cannot exceed 30 characters").regex(/^[a-zA-Z0-9#/\s-]*$/,"Only letters, numbers, #, hyphens, slashes, and spaces allowed").optional()});function pe({formCustomer:s,setFormCustomer:h}){const[u,m]=_.useState({}),[o,g]=_.useState(!1);_.useEffect(()=>{if(!o&&y.current){const r=new window.google.maps.places.Autocomplete(y.current,{types:["address"]});r.addListener("place_changed",()=>{const n=r.getPlace();f(n)})}},[o]);const f=r=>{const n=a=>{var c,i;return((i=(c=r.address_components)==null?void 0:c.find(x=>x.types.includes(a)))==null?void 0:i.long_name)||""};h(a=>({...a,cust_mailing_address:`${n("street_number")} ${n("route")}`.trim(),cust_mailing_city:n("locality"),cust_mailing_state:n("administrative_area_level_1"),cust_mailing_country:n("country"),cust_mailing_postal:n("postal_code")}))},y=V(f),p=(r,n)=>{const a=$.sanitize(n);let c="";const i={...s,[r]:a},x=me.safeParse(i);if(!x.success){const j=x.error.errors.find(S=>S.path[0]===r);c=j?j.message:""}m(j=>({...j,[r]:c})),h(i)},l=async r=>{const n=r.target.checked;g(n),h(a=>({...a,cust_mailing_address:n?a.cust_primary_address:"",cust_mailing_city:n?a.cust_primary_city:"",cust_mailing_state:n?a.cust_primary_state:"",cust_mailing_country:n?a.cust_primary_country:"",cust_mailing_postal:n?a.cust_primary_postal:"",cust_mailing_unit_no:n?a.cust_primary_unit_no:""}));try{const a=await fetch("/api/update-vendor",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({sameAsPrimary:n})});if(!a.ok)throw new Error("Failed to update the database");const c=await a.json();console.log("Update successful:",c)}catch(a){console.error("Error updating the database:",a)}},t=[{label:"Street",key:"cust_mailing_address",placeholder:"Enter street address"},{label:"City",key:"cust_mailing_city",placeholder:"Enter city name"},{label:"State",key:"cust_mailing_state",placeholder:"Enter state"},{label:"Country",key:"cust_mailing_country",placeholder:"Enter country"},{label:"Postal Code",key:"cust_mailing_postal",placeholder:"Enter postal code"},{label:"Unit No.",key:"cust_mailing_unit_no",placeholder:"Enter Unit No."}];return e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Mailing Address"}),e.jsx("hr",{}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",id:"sameAsPrimary",checked:o,onChange:l,style:{transform:"scale(1.1)",cursor:"pointer",margin:0}}),e.jsx("label",{htmlFor:"sameAsPrimary",style:{margin:0,whiteSpace:"nowrap"},children:"Same as Primary Address"})]}),!o&&e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:t.map(({label:r,key:n,placeholder:a})=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:n,children:r}),e.jsx("input",{type:"text",id:n,placeholder:a,value:s[n]||"",onChange:c=>p(n,c.target.value),ref:n==="cust_mailing_address"?y:void 0}),u[n]&&e.jsx("span",{className:"error",style:{color:"red"},children:u[n]})]},n))})]})}const Q=d.object({cust_ap_name:d.string().max(200,"Name cannot exceed 200 characters").regex(/^[a-zA-Z0-9\s.,'"-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),cust_ap_address:d.string().max(255,"Address is too long").regex(/^[a-zA-Z0-9\s,.'-]*$/,"Invalid street format").optional(),cust_ap_city:d.string().max(200,"City name is too long").regex(/^[a-zA-Z\s.'-]*$/,"Invalid city format").optional(),cust_ap_state:d.string().max(200,"Invalid state").regex(/^[a-zA-Z\s.'-]*$/,"Invalid state format").optional(),cust_ap_country:d.string().max(100,"Invalid country").regex(/^[a-zA-Z\s.'-]*$/,"Invalid country format").optional(),cust_ap_postal:d.string().max(20,"Postal code cannot exceed 20 characters").regex(/^[a-zA-Z0-9-\s]*$/,"Invalid postal code").optional(),cust_ap_unit_no:d.string().max(30,"Unit No cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid Unit No format").optional(),cust_ap_email:d.string().max(255,"Email cannot exceed 255 characters").email("Invalid email format").optional(),cust_ap_phone:d.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),cust_ap_phone_ext:d.string().max(10,"Phone Ext cannot exceed 10 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and hyphens allowed").optional(),cust_ap_fax:d.string().max(30,"Fax cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid fax format").optional()}),xe=({formCustomer:s,setFormCustomer:h})=>{const[u,m]=_.useState({}),[o,g]=_.useState(!1);_.useEffect(()=>{if(!o&&y.current){const t=new window.google.maps.places.Autocomplete(y.current,{types:["address"]});t.addListener("place_changed",()=>{const r=t.getPlace();f(r)})}},[o]);const f=t=>{if(!t.address_components)return;const r=n=>{var a,c;return((c=(a=t.address_components)==null?void 0:a.find(i=>i.types.includes(n)))==null?void 0:c.long_name)||""};h(n=>({...n,cust_ap_address:`${r("street_number")} ${r("route")}`.trim(),cust_ap_city:r("locality"),cust_ap_state:r("administrative_area_level_1"),cust_ap_country:r("country"),cust_ap_postal:r("postal_code")}))},y=V(f),p=(t,r)=>{const n=$.sanitize(r);let a="";const c={...s,[t]:n};if(t in Q.shape){const i=Q.safeParse(c);if(!i.success){const x=i.error.errors.find(j=>j.path[0]===t);a=x?x.message:""}}m(i=>({...i,[t]:a})),h(c)},l=[{label:"Street",key:"cust_ap_address",placeholder:"Enter street address"},{label:"City",key:"cust_ap_city",placeholder:"Enter city name"},{label:"State",key:"cust_ap_state",placeholder:"Enter state"},{label:"Country",key:"cust_ap_country",placeholder:"Enter country"},{label:"Postal Code",key:"cust_ap_postal",placeholder:"Enter postal code"},{label:"Unit No.",key:"cust_ap_unit_no",placeholder:"Enter Unit No."},{label:"Email",key:"cust_ap_email",placeholder:"Enter email id"},{label:"Phone",key:"cust_ap_phone",placeholder:"Enter phone no"},{label:"Phone ext",key:"cust_ap_phone_ext",placeholder:"Enter phone ext"},{label:"Fax",key:"cust_ap_fax",placeholder:"Enter fax"}];return e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Account Payable"}),e.jsx("hr",{}),e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:l.map(({label:t,key:r,placeholder:n})=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:r,children:t}),e.jsx("input",{type:"text",id:r,placeholder:n,value:s[r]||"",onChange:a=>p(r,a.target.value),ref:r==="cust_ap_address"?y:void 0}),u[r]&&e.jsx("span",{className:"error",style:{color:"red"},children:u[r]})]},r))})]})},he=d.object({cust_broker_name:d.string().max(200,"Broker name cannot exceed 200 characters").regex(/^[a-zA-Z0-9\s.,'"-]+$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),cust_bkp_notes:d.string().max(500,"Notes cannot exceed 500 characters").regex(/^[a-zA-Z0-9\s.,'"-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional(),cust_bkspl_notes:d.string().max(500,"Special notes By cannot exceed 100 characters").regex(/^[a-zA-Z0-9\s.,'"-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional()}),_e=[{key:"cust_bkp_notes",label:"Payment notes",placeholder:"Enter Payment notes",type:"textarea"},{key:"cust_bkspl_notes",label:"Special notes for confirmation doc",placeholder:"Enter Special notes for confirmation doc",type:"textarea"}],ge=({formCustomer:s,setFormCustomer:h})=>{const[u,m]=_.useState({}),[o,g]=_.useState([]),f="http://127.0.0.1:8000/api";_.useEffect(()=>{(async()=>{try{const l=localStorage.getItem("token"),t=await C.get(`${f}/broker`,{headers:{Authorization:`Bearer ${l}`}});if(!t||!t.data){console.error("API response is undefined or invalid:",t);return}console.log("Fetched brokers:",t.data);const r=t.data.map(n=>({value:n.broker_name,label:n.broker_name}));g(r),r.length>0&&h(n=>({...n,broker_name:r[0].value}))}catch(l){console.error("Error fetching brokers:",l)}})()},[]),_.useEffect(()=>{if(s.cust_broker_name){const p=o.find(l=>l.value===s.cust_broker_name);p&&h(l=>({...l,broker:p.value}))}},[s.cust_broker_name,o]);const y=(p,l)=>{let t=l,r="";const n={...s,[p]:t},a=he.safeParse(n);if(!a.success){const c=a.error.errors.find(i=>i.path[0]===p);r=c?c.message:""}m(c=>({...c,[p]:r})),h(n)};return e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Customer Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsx("label",{htmlFor:"customer",children:"Broker"}),e.jsxs("select",{id:"quote_customer",value:s.cust_broker_name||"",onChange:p=>y("cust_broker_name",p.target.value),onBlur:()=>y("cust_broker_name",s.cust_broker_name||""),required:!0,children:[e.jsx("option",{value:"",children:"Select a broker"}),o.length>0?o.map((p,l)=>e.jsx("option",{value:p.value,children:p.label},`${p.value}-${l}`)):e.jsx("option",{disabled:!0,children:"No customers found"})]}),u.customer&&e.jsx("span",{className:"error",style:{color:"red"},children:u.customer})]}),_e.map(({key:p,label:l,placeholder:t,type:r})=>e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsx("label",{htmlFor:p,children:l}),r==="textarea"?e.jsx("textarea",{id:p,name:p,value:String(s[p]||""),onChange:n=>y(p,n.target.value),placeholder:t,rows:4}):e.jsx("input",{type:r,id:p,placeholder:t,value:String(s[p]||""),onChange:n=>y(p,n.target.value)}),u[p]&&e.jsx("span",{className:"error",style:{color:"red"},children:u[p]})]},p))]})]})},G=["Approved","Not Approved"],W="http://127.0.0.1:8000/api".trim()||"http://127.0.0.1:8000/api",fe=d.object({cust_credit_status:d.enum(G,{errorMap:()=>({message:"Invalid equipment type"})}).optional(),cust_credit_appd:d.string().optional(),cust_credit_expd:d.string().optional(),cust_credit_mop:d.string().max(100,"Mode of payment must be at most 100 characters long").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),cust_credit_currency:d.string().max(10,"Currency must be at most 10 characters long").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers, and dashes allowed").optional(),cust_credit_application:d.boolean().optional(),cust_credit_terms:d.string().max(100,"Terms must be at most 100 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers,spaces, apostrophes, periods, commas, and hyphens allowed").optional(),cust_credit_limit:d.string().max(100,"Limit must be at most 100 characters long").regex(/^\d*$/,"Limit must be numeric").optional(),cust_credit_notes:d.string().max(500,"Notes cannot exceed 500 characters").regex(/^[a-zA-Z0-9\s.,'-]*$/,"Only letters, numbers, spaces, apostrophes, periods, commas, and hyphens allowed").optional()});function ye({formCustomer:s,setFormCustomer:h}){const[u,m]=_.useState({}),[o,g]=_.useState(!1),f=(l,t)=>{let r=typeof t=="boolean"?t:$.sanitize(t),n="";const a={...s,[l]:r},c=fe.safeParse(a);if(!c.success){const i=c.error.errors.find(x=>x.path[0]===l);n=i?i.message:""}m(i=>({...i,[l]:n})),h(a)},y=async(l,t)=>{var c;const r=(c=l.target.files)==null?void 0:c[0];if(!r)return;const n=new FormData;n.append(t,r);const a=localStorage.getItem("token");try{const x=await(await fetch(`${W}/upload`,{method:"POST",headers:{Authorization:`Bearer ${a}`},body:n})).json();if(console.log("Full Upload Response:",x),x&&x.files&&x.files[t])if(console.log("File data:",x.files[t]),x.files[t].fileUrl){const j=W.replace("/api",""),S=x.files[t].fileUrl.startsWith("http")?x.files[t].fileUrl:`${j}${x.files[t].fileUrl}`;h(k=>({...k,[t]:S,[`${t}_name`]:x.files[t].fileName}))}else console.error("File URL not found in response:",x),alert("File upload failed: No file URL returned.");else console.error("Unexpected response structure:",x),alert("File upload failed: Unexpected response format.")}catch(i){console.error("Error uploading file:",i),alert("Network error during file upload.")}finally{g(!1)}},p=[{key:"cust_credit_appd",label:"Approval date",type:"date"},{key:"cust_credit_expd",label:"Expiry date",type:"date"},{key:"cust_credit_mop",label:"Mode of Payment",type:"text",placeholder:"Enter mode of payment"},{key:"cust_credit_currency",label:"Currency",type:"text",placeholder:"Enter Currency"},{key:"cust_credit_application",label:"Credit Application",type:"boolean"},{key:"cust_credit_terms",label:"Terms",type:"text",placeholder:"Enter credit terms"},{key:"cust_credit_limit",label:"Limit",type:"text",placeholder:"Enter credit limit"},{key:"cust_credit_notes",label:"Notes",type:"textarea",placeholder:"Enter notes"}];return e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Customer Credit"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-grid",style:{display:"grid",gap:"1rem",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))"},children:[e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsx("label",{htmlFor:"credStatus",children:"Credit Status"}),e.jsxs("select",{id:"credStatus",value:s.cust_credit_status,onChange:l=>h(t=>({...t,cust_credit_status:l.target.value})),children:[e.jsx("option",{value:"",children:"Select..."}),G.map(l=>e.jsx("option",{value:l,children:l},l))]}),u.cust_credit_status&&e.jsx("span",{className:"error",style:{color:"red"},children:u.cust_credit_status})]}),p.map(({label:l,key:t,placeholder:r,type:n})=>e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[n==="boolean"?e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("input",{type:"checkbox",id:t,checked:!!s[t],onChange:a=>{const c=a.target.checked;h(i=>({...i,[t]:c}))},style:{transform:"scale(1.1)",cursor:"pointer",margin:0}}),e.jsx("label",{htmlFor:t,style:{margin:0,whiteSpace:"nowrap"},children:l})]}):n==="textarea"?e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsx("label",{htmlFor:t,children:l}),e.jsx("textarea",{id:t,name:t,value:String(s[t]||""),onChange:a=>f(t,a.target.value),placeholder:r,rows:4})]}):e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsx("label",{htmlFor:t,children:l}),e.jsx("input",{id:t,type:n,value:String(s[t]||""),onChange:a=>f(t,a.target.value),placeholder:r})]}),u[t]&&e.jsx("span",{className:"error",style:{color:"red"},children:u[t]})]},t)),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsx("label",{htmlFor:"shipBrokAggmt",children:"Shipper Broker Agreement"}),e.jsx("input",{type:"file",onChange:l=>y(l,"cust_sbk_agreement")}),typeof s.cust_sbk_agreement=="string"&&s.cust_sbk_agreement&&e.jsx("div",{children:e.jsx("a",{href:s.cust_sbk_agreement,target:"_blank",rel:"noopener noreferrer",children:"Download Shipper Broker Agreement"})}),o&&e.jsx("p",{children:"Uploading..."})]}),e.jsxs("div",{className:"form-group",style:{flex:"1 1 45%"},children:[e.jsx("label",{htmlFor:"credAggmt",children:"Credit Agreement"}),e.jsx("input",{type:"file",onChange:l=>y(l,"cust_credit_agreement")}),typeof s.cust_credit_agreement=="string"&&s.cust_credit_agreement&&e.jsx("div",{children:e.jsx("a",{href:s.cust_credit_agreement,target:"_blank",rel:"noopener noreferrer",children:"Download Credit Agreement"})}),o&&e.jsx("p",{children:"Uploading..."})]})]})]})}const je=d.object({name:d.string().max(200,"Name must be at most 200 characters").regex(/^[a-zA-Z\s.,'-]+$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional(),phone:d.string().max(30,"Phone cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid phone format").optional(),ext:d.string().max(10,"Extension cannot exceed 10 characters").regex(/^[a-zA-Z0-9-]*$/,"Only letters, numbers and hyphens allowed").optional(),email:d.string().max(255,"Email must be at most 255 characters").email("Invalid email format").optional(),fax:d.string().max(30,"Fax cannot exceed 30 characters").regex(/^[0-9-+()\s]*$/,"Invalid fax format").optional(),designation:d.string().max(100,"Designation must be at most 100 characters").regex(/^[a-zA-Z\s.,'-]+$/,"Only letters, spaces, apostrophes, periods,commas and hyphens allowed").optional()}),be=({cust_contact:s,index:h,handleContactChange:u,handleRemoveContact:m,onAddContact:o})=>{const g=s[h]??{},[f,y]=_.useState({}),p=_.useCallback((t,r)=>{const n=$.sanitize(r);let a="";const c={...g,[t]:n},i=je.safeParse(c);if(!i.success){const x=i.error.errors.find(j=>j.path[0]===t);a=x?x.message:""}y(x=>({...x,[t]:a})),u(h,c)},[g,u,h]),l=[{label:"Name",key:"name",type:"text",placeholder:"Enter name"},{label:"Phone",key:"phone",type:"tel",placeholder:"Enter phone"},{label:"Extension",key:"ext",type:"text",placeholder:"Enter extension"},{label:"Email",key:"email",type:"email",placeholder:"Enter email"},{label:"Fax",key:"fax",type:"text",placeholder:"Enter fax"},{label:"Designation",key:"designation",type:"text",placeholder:"Enter designation"}];return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{className:"form-grid",style:{display:"grid",gap:"10px",gridTemplateColumns:"repeat(6, 1fr)",flex:1},children:l.map(({label:t,key:r,type:n,placeholder:a})=>e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`${r}-${h}`,children:t}),e.jsx("input",{id:`${r}-${h}`,type:n,name:r,value:g[r]||"",onChange:c=>p(r,c.target.value),placeholder:a}),f[r]&&e.jsx("span",{className:"error",style:{color:"red"},children:f[r]})]},r))}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:o,className:"add-button",children:e.jsx(F,{})}),e.jsx("button",{type:"button",onClick:()=>m(h),className:"delete-button",children:e.jsx(D,{})})]})]})},K=["Van","Reefer","Flatbed","Triaxle","Maxi","Btrain","Roll tite"],ve=d.object({equipments:d.enum(K,{errorMap:()=>({message:"Invalid equipment type"})}).optional()}),Ne=({equipments:s,index:h,handleEquipmentChange:u,handleRemoveEquipment:m,onAddEquipment:o})=>{const g=s[h]??{},[f,y]=_.useState({}),p=_.useCallback((l,t)=>{const r=$.sanitize(t);let n="";const a={...g,[l]:r},c=ve.safeParse(a);if(!c.success){const i=c.error.errors.find(x=>x.path[0]===l);n=i?i.message:""}y(i=>({...i,[l]:n})),u(h,a)},[g,u,h]);return e.jsxs("fieldset",{className:"form-section",style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsxs("div",{className:"form-group",style:{display:"flex",flexDirection:"column"},children:[e.jsx("label",{htmlFor:`equipment-${h}`,children:"Equipment Type"}),e.jsxs("select",{id:`equipment-${h}`,name:"equipment",value:g.equipment||"",onChange:l=>p("equipment",l.target.value),style:{width:"180px",padding:"8px"},children:[e.jsx("option",{value:"",children:"Select Equipment"}),K.map(l=>e.jsx("option",{value:l,children:l},l))]}),f.type&&e.jsx("span",{className:"error",style:{color:"red"},children:f.type})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0px"},children:[e.jsx("button",{type:"button",onClick:o,className:"add-button",children:e.jsx(F,{})}),e.jsx("button",{type:"button",onClick:()=>m(h),className:"delete-button",children:e.jsx(D,{})})]})]})},Y="http://127.0.0.1:8000/api",Ae=(s,h,u)=>{const[m,o]=_.useState({id:0,cust_type:"",cust_name:"",cust_ref_no:"",cust_website:"",cust_email:"",cust_contact_no:"",cust_contact_no_ext:"",cust_tax_id:"",cust_primary_address:"",cust_primary_city:"",cust_primary_state:"",cust_primary_country:"",cust_primary_postal:"",cust_primary_unit_no:"",cust_mailing_address:"",cust_mailing_city:"",cust_mailing_state:"",cust_mailing_country:"",cust_mailing_postal:"",cust_mailing_unit_no:"",sameAsPrimary:!1,cust_ap_name:"",cust_ap_address:"",cust_ap_city:"",cust_ap_state:"",cust_ap_country:"",cust_ap_postal:"",cust_ap_unit_no:"",cust_ap_email:"",cust_ap_phone:"",cust_ap_phone_ext:"",cust_ap_fax:"",cust_broker_name:"",cust_bkp_notes:"",cust_bkspl_notes:"",cust_credit_status:"",cust_credit_mop:"",cust_credit_currency:"",cust_credit_appd:"",cust_credit_expd:"",cust_credit_terms:0,cust_credit_limit:0,cust_credit_application:!1,cust_credit_agreement:"",cust_sbk_agreement:"",cust_credit_notes:"",cust_contact:[],cust_equipment:[],created_at:"",updated_at:""});_.useEffect(()=>{if(s){const a=Array.isArray(s.cust_contact)?s.cust_contact:JSON.parse(s.cust_contact||"[]"),c=Array.isArray(s.cust_equipment)?s.cust_equipment:JSON.parse(s.cust_equipment||"[]"),i={...s,cust_contact:a.length>0?a:[],cust_equipment:c.length>0?c:[]};o(i)}},[s]);const g=()=>!!m.cust_name&&!!m.cust_ref_no;return{formCustomer:m,setFormCustomer:o,updateCustomer:async()=>{if(!g()){E.fire("Validation Error","Please fill in all required fields.","error");return}try{const a=localStorage.getItem("token");if(!a){E.fire({icon:"error",title:"Unauthorized",text:"You are not logged in. Please log in again."});return}const c={Authorization:`Bearer ${a}`},i=new FormData;Object.keys(m).forEach(j=>{const S=m[j];j==="cust_credit_application"?i.append(j,S?"1":"0"):j!=="cust_credit_agreement"&&j!=="cust_sbk_agreement"&&i.append(j,String(S||""))}),m.cust_credit_agreement&&m.cust_credit_agreement instanceof File&&i.append("cust_credit_agreement",m.cust_credit_agreement),m.cust_sbk_agreement&&m.cust_sbk_agreement instanceof File&&i.append("cust_sbk_agreement",m.cust_sbk_agreement);const x=m.id?await C.put(`${Y}/customer/${m.id}`,m,{headers:c}):await C.post(`${Y}/customer`,m,{headers:c});E.fire(m.id?"Success!":"Saved!","Customer updated successfully.","success"),u(x.data),h()}catch(a){console.error("Error saving/updating customer:",a.response?a.response.data:a.message),E.fire("Error","An error occurred while processing the customer.","error")}},handleAddContact:()=>{o(a=>a&&{...a,cust_contact:[...a.cust_contact,{name:"",phone:"",ext:"",email:"",fax:"",designation:""}]})},handleContactChange:(a,c)=>{o(i=>i&&{...i,cust_contact:i.cust_contact.map((x,j)=>j===a?c:x)})},handleAddEquipment:()=>{o(a=>a&&{...a,cust_equipment:[...a.cust_equipment,{equipment:""}]})},handleEquipmentChange:(a,c)=>{o(i=>i&&{...i,cust_equipment:i.cust_equipment.map((x,j)=>j===a?c:x)})},handleRemoveContact:a=>{o(c=>c&&{...c,cust_contact:c.cust_contact.filter((i,x)=>x!==a)})},handleRemoveEquipment:a=>{o(c=>c&&{...c,cust_equipment:c.cust_equipment.filter((i,x)=>x!==a)})}}},Ee=({customer:s,onClose:h,onUpdate:u})=>{const{formCustomer:m,setFormCustomer:o,updateCustomer:g,handleAddContact:f,handleContactChange:y,handleAddEquipment:p,handleEquipmentChange:l,handleRemoveContact:t,handleRemoveEquipment:r}=Ae(s,h,u);return console.log("Form customer:",m),e.jsx("div",{className:"form-container",children:e.jsxs("form",{onSubmit:n=>{n.preventDefault(),g()},className:"form-main",children:[e.jsx(oe,{formCustomer:m,setFormCustomer:o}),e.jsx(ue,{formCustomer:m,setFormCustomer:o}),e.jsx(pe,{formCustomer:m,setFormCustomer:o}),e.jsx(xe,{formCustomer:m,setFormCustomer:o}),e.jsx(ge,{formCustomer:m,setFormCustomer:o}),e.jsx(ye,{formCustomer:m,setFormCustomer:o}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",children:[m.cust_contact.map((n,a)=>e.jsx(be,{cust_contact:m.cust_contact,index:a,onAddContact:f,handleRemoveContact:t,handleContactChange:y},a)),m.cust_contact.length===0&&e.jsx("button",{type:"button",onClick:f,className:"add-button",children:e.jsx(F,{})})]})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Equipments"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",children:[m.cust_equipment.map((n,a)=>e.jsx(Ne,{equipments:m.cust_equipment,index:a,onAddEquipment:p,handleEquipmentChange:l,handleRemoveEquipment:r},a)),m.cust_equipment.length===0&&e.jsx("button",{type:"button",onClick:p,className:"add-button",children:e.jsx(F,{})})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-submit",children:"Save"}),e.jsx("button",{type:"button",className:"btn-cancel",onClick:h,children:"Cancel"})]})]})})},Se=({formCustomer:s})=>e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Customer Information"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Customer Type"}),e.jsx("div",{children:s.cust_type})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Customer Name"}),e.jsx("div",{children:s.cust_name})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Customer Ref No."}),e.jsx("div",{children:s.cust_ref_no})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Website"}),e.jsx("div",{children:s.cust_website})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:s.cust_email})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Contact No"}),e.jsx("div",{children:s.cust_contact_no})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Contact No Ext"}),e.jsx("div",{children:s.cust_contact_no_ext})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Tax ID"}),e.jsx("div",{children:s.cust_tax_id})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("div",{})," "]})]})]});function we({formCustomer:s}){return e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Accounts Payable"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:s.cust_ap_name})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Street"}),e.jsx("div",{children:s.cust_ap_address})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"City"}),e.jsx("div",{children:s.cust_ap_city})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"State"}),e.jsx("div",{children:s.cust_ap_state})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Country"}),e.jsx("div",{children:s.cust_ap_country})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Postal Code"}),e.jsx("div",{children:s.cust_ap_postal})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Unit No"}),e.jsx("div",{children:s.cust_ap_unit_no})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:s.cust_ap_email})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:s.cust_ap_phone})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Phone Ext"}),e.jsx("div",{children:s.cust_ap_phone_ext})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Fax"}),e.jsx("div",{children:s.cust_ap_fax})]})]})]})}const Ce=({formCustomer:s})=>e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Primary Address"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Street"}),e.jsx("div",{children:s.cust_primary_address})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"City"}),e.jsx("div",{children:s.cust_primary_city})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"State"}),e.jsx("div",{children:s.cust_primary_state})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Country"}),e.jsx("div",{children:s.cust_primary_country})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Postal Code"}),e.jsx("div",{children:s.cust_primary_postal})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Unit No"}),e.jsx("div",{children:s.cust_primary_unit_no})]})]})]}),ke=({formCustomer:s})=>e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Mailing Address"}),e.jsx("hr",{}),!s.sameAsPrimary&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Street"}),e.jsx("div",{children:s.cust_mailing_address})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"City"}),e.jsx("div",{children:s.cust_mailing_city})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"State"}),e.jsx("div",{children:s.cust_mailing_state})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Country"}),e.jsx("div",{children:s.cust_mailing_country})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Postal Code"}),e.jsx("div",{children:s.cust_mailing_postal})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Unit No"}),e.jsx("div",{children:s.cust_mailing_unit_no})]})]})]})]}),Pe=({formCustomer:s})=>e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Custom Broker"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Broker"}),e.jsx("div",{children:s.cust_broker_name||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Payment Notes"}),e.jsx("div",{children:s.cust_bkp_notes||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Special Notes for Confirmation Doc"}),e.jsx("div",{children:s.cust_bkspl_notes||"N/A"})]})]})]}),$e=({formCustomer:s})=>{const h=(u,m)=>{if(u){let o;if(typeof u=="string")try{o=JSON.parse(u)}catch{return e.jsx("div",{children:e.jsxs("a",{href:u,target:"_blank",rel:"noopener noreferrer",children:["Download ",m]})})}else o=u;if(o!=null&&o.url)return e.jsx("div",{children:e.jsxs("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",children:["Download ",m,": ",o.name]})})}return null};return e.jsxs("fieldset",{children:[e.jsx("legend",{children:"Customer Credit"}),e.jsx("hr",{}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Credit Status"}),e.jsx("div",{children:s.cust_credit_status||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Mode of Payment"}),e.jsx("div",{children:s.cust_credit_mop||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Currency"}),e.jsx("div",{children:s.cust_credit_currency||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Approval Date"}),e.jsx("div",{children:s.cust_credit_appd||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Expiry Date"}),e.jsx("div",{children:s.cust_credit_expd||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Terms (Days)"}),e.jsx("div",{children:s.cust_credit_terms||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Limit"}),e.jsx("div",{children:s.cust_credit_limit||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Credit Application"}),e.jsx("div",{children:s.cust_credit_application?"Yes":"No"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Credit Agreement"}),h(s.cust_credit_agreement,"Credit Agreement")]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Shipper Broker Agreement"}),h(s.cust_sbk_agreement,"Shipper Broker Agreement")]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Notes"}),e.jsx("div",{children:s.cust_credit_notes||"N/A"})]})]})]})},Ie=({contact:s={}})=>e.jsxs("fieldset",{className:"form-section",children:[e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:s.name||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Contact No"}),e.jsx("div",{children:s.phone||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Contact No Ext"}),e.jsx("div",{children:s.ext||"N/A"})]})]}),e.jsxs("div",{className:"form-row",style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:s.email||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Fax"}),e.jsx("div",{children:s.fax||"N/A"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Designation"}),e.jsx("div",{children:s.designation||"N/A"})]})]})]}),qe=({equipment:s={},index:h})=>e.jsx("fieldset",{className:"form-section",children:e.jsx("div",{className:"contact-form",children:e.jsx("div",{className:"form-row",style:{display:"flex",gap:"1rem"},children:e.jsxs("div",{className:"form-group",style:{flex:1,width:"23.3rem"},children:[e.jsx("label",{children:"Equipment Type"}),e.jsx("div",{children:s.equipment||"N/A"})]})})})}),ze=({customer:s,onClose:h})=>{const[u,m]=_.useState({id:0,cust_type:"",cust_name:"",cust_ref_no:"",cust_website:"",cust_email:"",cust_contact_no:"",cust_contact_no_ext:"",cust_tax_id:"",cust_primary_address:"",cust_primary_city:"",cust_primary_state:"",cust_primary_country:"",cust_primary_postal:"",cust_primary_unit_no:"",sameAsPrimary:!1,cust_mailing_address:"",cust_mailing_city:"",cust_mailing_state:"",cust_mailing_country:"",cust_mailing_postal:"",cust_mailing_unit_no:"",cust_ap_name:"",cust_ap_address:"",cust_ap_city:"",cust_ap_state:"",cust_ap_country:"",cust_ap_postal:"",cust_ap_unit_no:"",cust_ap_email:"",cust_ap_phone:"",cust_ap_phone_ext:"",cust_ap_fax:"",cust_broker_name:"",cust_bkp_notes:"",cust_bkspl_notes:"",cust_credit_status:"",cust_credit_mop:"",cust_credit_appd:"",cust_credit_expd:"",cust_credit_terms:0,cust_credit_limit:0,cust_credit_notes:"",cust_credit_application:!1,cust_credit_currency:"",cust_sbk_agreement:"",cust_credit_agreement:"",cust_contact:[],cust_equipment:[],created_at:"",updated_at:""});return _.useEffect(()=>{s&&m(o=>({...o,...s,cust_contact:Array.isArray(s.cust_contact)?s.cust_contact:JSON.parse(s.cust_contact||"[]"),cust_equipment:Array.isArray(s.cust_equipment)?s.cust_equipment:JSON.parse(s.cust_equipment||"[]")}))},[s]),e.jsx("div",{className:"form-container",children:e.jsxs("form",{className:"form-main",children:[e.jsx(Se,{formCustomer:u}),e.jsx(Ce,{formCustomer:u}),e.jsx(ke,{formCustomer:u}),e.jsx(we,{formCustomer:u}),e.jsx(Pe,{formCustomer:u}),e.jsx($e,{formCustomer:u}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Contacts"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:u.cust_contact.map((o,g)=>e.jsx(Ie,{contact:o,index:g},g))})]}),e.jsxs("fieldset",{className:"form-section",children:[e.jsx("legend",{children:"Equipments"}),e.jsx("hr",{}),e.jsx("div",{className:"form-row",children:u.cust_equipment.map((o,g)=>e.jsx(qe,{equipment:o,index:g},g))})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"button",className:"btn-cancel",onClick:h,style:{padding:"9px 15px"},children:"Cancel"})})]})})},Z="http://127.0.0.1:8000/api",Fe=()=>{const[s,h]=_.useState([]),[u,m]=_.useState(!0),[o,g]=_.useState(""),[f,y]=_.useState("created_at"),[p,l]=_.useState(!0),[t,r]=_.useState(1),[n,a]=_.useState(null),[c,i]=_.useState(!1),[x,j]=_.useState([]),[S,k]=_.useState(!1),[O,I]=_.useState(!1),[q,z]=_.useState({subject:"",content:""}),[P,L]=_.useState(10);_.useEffect(()=>{(async()=>{try{const v=localStorage.getItem("token");if(!v)throw new Error("No token found");m(!0);const{data:A}=await C.get(`${Z}/customer`,{headers:{Authorization:`Bearer ${v}`}});h(A)}catch(v){console.error("Error loading customers:",v),R(v)}finally{m(!1)}})()},[]);const R=b=>{var v;((v=b.response)==null?void 0:v.status)===401&&(E.fire({icon:"error",title:"Unauthorized",text:"You need to log in to access this resource."}),window.location.href="/login")},U=b=>{h(v=>v.map(A=>A.id===b.id?{...A,...b}:A))},T=()=>{x.length===B.length?j([]):j(B.map(b=>b.id))},N=b=>{j(v=>v.includes(b)?v.filter(A=>A!==b):[...v,b])},X=async()=>{if(x.length===0){E.fire({icon:"warning",title:"No record selected",text:"Please select a record to delete."});return}if((await E.fire({title:"Are you sure?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete selected!",cancelButtonText:"No, cancel!"})).isConfirmed)try{const v=localStorage.getItem("token");if(!v)throw new Error("No token found");await Promise.all(x.map(A=>C.delete(`${Z}/customer/${A}`,{headers:{Authorization:`Bearer ${v}`}}))),h(A=>A.filter(w=>!x.includes(w.id))),j([]),E.fire("Deleted!","Selected customers have been deleted.","success")}catch(v){console.error("Error deleting customers:",v),E.fire({icon:"error",title:"Error!",text:"Failed to delete selected customers."})}},J=s.filter(b=>Object.values(b).some(v=>v!=null&&v.toString().toLowerCase().includes(o.toLowerCase()))),B=J.sort((b,v)=>{let A=b[f]??"",w=v[f]??"";return typeof A=="string"&&typeof w=="string"?p?w.localeCompare(A):A.localeCompare(w):typeof A=="number"&&typeof w=="number"?p?w-A:A-w:0}).slice((t-1)*P,t*P),ee=Math.ceil(J.length/P);return{customers:s,loading:u,searchQuery:o,setSearchQuery:g,sortBy:f,sortDesc:p,selectedCustomers:x,paginatedData:B,totalPages:ee,currentPage:t,setCurrentPage:r,isEditModalOpen:c,isEmailModalOpen:S,isViewModalOpen:O,selectedCustomer:n,setEditModalOpen:i,setViewModalOpen:I,setEmailModalOpen:k,toggleSelectAll:T,toggleSelect:N,deleteSelected:X,openEditModal:b=>{a(b),i(!0)},emailData:q,setEmailData:z,sendEmails:async()=>{if(x.length===0){E.fire({icon:"warning",title:"No customers selected",text:"Please select customers to send emails to."});return}try{const b=localStorage.getItem("token");if(!b)throw new Error("No token found");await C.post(`${Z}/email`,{ids:x,...q,module:"customers"},{headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"}}),E.fire("Success!","Emails have been sent.","success"),k(!1),j([])}catch(b){console.error("Error sending emails:",b),E.fire("Error!","Failed to send emails.","error")}},openViewModal:b=>{a(b),I(!0)},rowsPerPage:P,handleSort:b=>{f===b?l(!p):(y(b),l(!1))},updateCustomer:U,handlePageChange:b=>{r(b)}}},Oe=()=>{const{customers:s,loading:h,searchQuery:u,setSearchQuery:m,sortBy:o,sortDesc:g,selectedCustomers:f,paginatedData:y,totalPages:p,currentPage:l,isEditModalOpen:t,isEmailModalOpen:r,isViewModalOpen:n,selectedCustomer:a,setEditModalOpen:c,setViewModalOpen:i,setEmailModalOpen:x,toggleSelectAll:j,toggleSelect:S,deleteSelected:k,openEditModal:O,sendEmails:I,openViewModal:q,handleSort:z,updateCustomer:P,handlePageChange:L}=Fe(),R=N=>N.key==="checkbox"||N.key==="actions"?N.label:e.jsxs("div",{className:"sortable-header",onClick:()=>z(N.key),children:[N.label,e.jsx("span",{className:"sort-icon",children:o===N.key?g?"▼":"▲":"▼"})]}),U=[{key:"checkbox",label:e.jsx("input",{type:"checkbox",onChange:j,checked:f.length===y.length&&y.length>0}),render:N=>e.jsx("input",{type:"checkbox",checked:f.includes(N.id),onChange:()=>S(N.id)})},{key:"cust_name",label:"Name"},{key:"cust_type",label:"Type"},{key:"cust_email",label:"Email"},{key:"cust_contact_no",label:"Contact No"},{key:"cust_primary_city",label:"Primary City"},{key:"cust_primary_state",label:"Primary State"},{key:"cust_primary_country",label:"Primary Country"},{key:"cust_credit_status",label:"Status",render:N=>e.jsx("span",{className:`badge ${T(N.cust_credit_status)}`,children:N.cust_credit_status})},{key:"actions",label:"",render:N=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>q(N),className:"btn-view",children:e.jsx(re,{})}),e.jsx("button",{onClick:()=>O(N),className:"btn-edit",children:e.jsx(se,{})})]})}],T=N=>{switch(N){case"Approved":return"badge-product";case"Not Approved":return"badge-lanes";default:return"badge-default"}};return e.jsxs("div",{children:[e.jsxs("div",{className:"header-container",children:[e.jsx("div",{className:"header-container-left",children:e.jsx("div",{className:"header-actions",children:e.jsx("h1",{className:"page-heading",children:"Customers"})})}),e.jsxs("div",{className:"search-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(ne,{className:"search-icon"}),e.jsx("input",{className:"search-bar",value:u,onChange:N=>m(N.target.value)})]}),e.jsx("button",{onClick:()=>x(!0),className:"send-email-button",disabled:f.length===0,children:e.jsx(le,{})}),e.jsx("button",{onClick:k,className:"delete-button",children:e.jsx(D,{})})]})]}),h?e.jsx("div",{children:"Loading..."}):s.length===0?e.jsx("div",{children:"No records found"}):e.jsx(te,{data:y,headers:U.map(N=>({...N,label:R(N)})),handleSort:z,sortBy:o,sortDesc:g}),e.jsx(ae,{currentPage:l,totalPages:p,onPageChange:L}),e.jsx(M,{isOpen:t,onClose:()=>c(!1),title:"Edit Customer",children:a&&e.jsx(Ee,{customer:a,onClose:()=>c(!1),onUpdate:P})}),e.jsx(M,{isOpen:n,onClose:()=>i(!1),title:"Customer Details",children:a&&e.jsx(ze,{customer:a,onClose:()=>i(!1)})}),e.jsx(M,{isOpen:r,onClose:()=>x(!1),title:"Send Email",children:e.jsx("button",{onClick:I,children:"Send"})})]})},He=()=>e.jsx("div",{children:e.jsx(Oe,{})});export{He as default};
